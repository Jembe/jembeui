(()=>{function e(e){return e&&e.__esModule?e.default:e}!function(e){if(null!=e)document.cookie=`jembeuiTimezone=${e};`;else{const t=document.cookie.split("; ").find((e=>e.trim().startsWith("jembeuiTimezone=")));(void 0!==t?t.trim().split("=")[1]:null)!==(e=Intl.DateTimeFormat().resolvedOptions().timeZone)&&(document.cookie=`jembeuiTimezone=${e};`)}}();var t,n={};function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(e){return e[e.length-1]}function s(e,...t){return t.forEach((t=>{e.includes(t)||e.push(t)})),e}function o(e,t){return e?e.split(t):[]}function a(e,t,n){return(void 0===t||e>=t)&&(void 0===n||e<=n)}function l(e,t,n){return e<t?t:e>n?n:e}function c(e,t,n={},i=0,r=""){r+=`<${Object.keys(n).reduce(((e,t)=>{let r=n[t];return"function"==typeof r&&(r=r(i)),`${e} ${t}="${r}"`}),e)}></${e}>`;const s=i+1;return s<t?c(e,t,n,s,r):r}function d(e){return e.replace(/>\s+/g,">").replace(/\s+</,"<")}function h(e){return new Date(e).setHours(0,0,0,0)}function p(){return(new Date).setHours(0,0,0,0)}function u(...e){switch(e.length){case 0:return p();case 1:return h(e[0])}const t=new Date(0);return t.setFullYear(...e),t.setHours(0,0,0,0)}function f(e,t){const n=new Date(e);return n.setDate(n.getDate()+t)}function m(e,t){const n=new Date(e),i=n.getMonth()+t;let r=i%12;r<0&&(r+=12);const s=n.setMonth(i);return n.getMonth()!==r?n.setDate(0):s}function g(e,t){const n=new Date(e),i=n.getMonth(),r=n.setFullYear(n.getFullYear()+t);return 1===i&&2===n.getMonth()?n.setDate(0):r}function y(e,t){return(e-t+7)%7}function w(e,t,n=0){const i=new Date(e).getDay();return f(e,y(t,n)-y(i,n))}function v(e){const t=w(e,4,1),n=w(new Date(t).setMonth(0,4),4,1);return Math.round((t-n)/6048e5)+1}function b(e,t){const n=new Date(e).getFullYear();return Math.floor(n/t)*t}function k(e,t,n){if(1!==t&&2!==t)return e;const i=new Date(e);return 1===t?n?i.setMonth(i.getMonth()+1,0):i.setDate(1):n?i.setFullYear(i.getFullYear()+1,0,0):i.setMonth(0,1),i.setHours(0,0,0,0)}t=function(){var e,t,n={version:"0.2.0"},i=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function r(e,t,n){return e<t?t:e>n?n:e}function s(e){return 100*(-1+e)}n.configure=function(e){var t,n;for(t in e)void 0!==(n=e[t])&&e.hasOwnProperty(t)&&(i[t]=n);return this},n.status=null,n.set=function(e){var t=n.isStarted();e=r(e,i.minimum,1),n.status=1===e?null:e;var l=n.render(!t),c=l.querySelector(i.barSelector),d=i.speed,h=i.easing;return l.offsetWidth,o((function(t){""===i.positionUsing&&(i.positionUsing=n.getPositioningCSS()),a(c,function(e,t,n){var r;return(r="translate3d"===i.positionUsing?{transform:"translate3d("+s(e)+"%,0,0)"}:"translate"===i.positionUsing?{transform:"translate("+s(e)+"%,0)"}:{"margin-left":s(e)+"%"}).transition="all "+t+"ms "+n,r}(e,d,h)),1===e?(a(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){a(l,{transition:"all "+d+"ms linear",opacity:0}),setTimeout((function(){n.remove(),t()}),d)}),d)):setTimeout(t,d)})),this},n.isStarted=function(){return"number"==typeof n.status},n.start=function(){n.status||n.set(0);var e=function(){setTimeout((function(){n.status&&(n.trickle(),e())}),i.trickleSpeed)};return i.trickle&&e(),this},n.done=function(e){return e||n.status?n.inc(.3+.5*Math.random()).set(1):this},n.inc=function(e){var t=n.status;return t?("number"!=typeof e&&(e=(1-t)*r(Math.random()*t,.1,.95)),t=r(t+e,0,.994),n.set(t)):n.start()},n.trickle=function(){return n.inc(Math.random()*i.trickleRate)},e=0,t=0,n.promise=function(i){return i&&"resolved"!==i.state()?(0===t&&n.start(),e++,t++,i.always((function(){0==--t?(e=0,n.done()):n.set((e-t)/e)})),this):this},n.render=function(e){if(n.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var t=document.createElement("div");t.id="nprogress",t.innerHTML=i.template;var r,o=t.querySelector(i.barSelector),l=e?"-100":s(n.status||0),d=document.querySelector(i.parent);return a(o,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),i.showSpinner||(r=t.querySelector(i.spinnerSelector))&&p(r),d!=document.body&&c(d,"nprogress-custom-parent"),d.appendChild(t),t},n.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(i.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&p(e)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var o=function(){var e=[];function t(){var n=e.shift();n&&n(t)}return function(n){e.push(n),1==e.length&&t()}}(),a=function(){var e=["Webkit","O","Moz","ms"],t={};function n(n){return n=n.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()})),t[n]||(t[n]=function(t){var n=document.body.style;if(t in n)return t;for(var i,r=e.length,s=t.charAt(0).toUpperCase()+t.slice(1);r--;)if((i=e[r]+s)in n)return i;return t}(n))}function i(e,t,i){t=n(t),e.style[t]=i}return function(e,t){var n,r,s=arguments;if(2==s.length)for(n in t)void 0!==(r=t[n])&&t.hasOwnProperty(n)&&i(e,n,r);else i(e,s[1],s[2])}}();function l(e,t){return("string"==typeof e?e:h(e)).indexOf(" "+t+" ")>=0}function c(e,t){var n=h(e),i=n+t;l(n,t)||(e.className=i.substring(1))}function d(e,t){var n,i=h(e);l(e,t)&&(n=i.replace(" "+t+" "," "),e.className=n.substring(1,n.length-1))}function h(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function p(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return n},"function"==typeof define&&define.amd?define(t):n=t(),e(n).configure({showSpinner:!1}),function(){let t=0;updateProgressBar=()=>{t>0?e(n).start():e(n).done()},window.addEventListener("jembeStartUpdatePage",(()=>{t+=1,updateProgressBar()})),window.addEventListener("jembeUpdatePage",(e=>{e.detail.isXUpdate&&(t-=1),updateProgressBar()})),window.addEventListener("jembeUpdatePageError",(()=>{t-=1,updateProgressBar()}))}();const x=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,S=/[\s!-/:-@[-`{-~年月日]+/;let M={};const O={y:(e,t)=>new Date(e).setFullYear(parseInt(t,10)),m(e,t,n){const i=new Date(e);let r=parseInt(t,10)-1;if(isNaN(r)){if(!t)return NaN;const e=t.toLowerCase(),i=t=>t.toLowerCase().startsWith(e);if(r=n.monthsShort.findIndex(i),r<0&&(r=n.months.findIndex(i)),r<0)return NaN}return i.setMonth(r),i.getMonth()!==D(r)?i.setDate(0):i.getTime()},d:(e,t)=>new Date(e).setDate(parseInt(t,10))},C={d:e=>e.getDate(),dd:e=>T(e.getDate(),2),D:(e,t)=>t.daysShort[e.getDay()],DD:(e,t)=>t.days[e.getDay()],m:e=>e.getMonth()+1,mm:e=>T(e.getMonth()+1,2),M:(e,t)=>t.monthsShort[e.getMonth()],MM:(e,t)=>t.months[e.getMonth()],y:e=>e.getFullYear(),yy:e=>T(e.getFullYear(),2).slice(-2),yyyy:e=>T(e.getFullYear(),4)};function D(e){return e>-1?e%12:D(e+12)}function T(e,t){return e.toString().padStart(t,"0")}function N(e){if("string"!=typeof e)throw new Error("Invalid date format.");if(e in M)return M[e];const t=e.split(x),n=e.match(new RegExp(x,"g"));if(0===t.length||!n)throw new Error("Invalid date format.");const i=n.map((e=>C[e])),s=Object.keys(O).reduce(((e,t)=>(n.find((e=>"D"!==e[0]&&e[0].toLowerCase()===t))&&e.push(t),e)),[]);return M[e]={parser(e,t){const i=e.split(S).reduce(((e,t,i)=>{if(t.length>0&&n[i]){const r=n[i][0];"M"===r?e.m=t:"D"!==r&&(e[r]=t)}return e}),{});return s.reduce(((e,n)=>{const r=O[n](e,i[n],t);return isNaN(r)?e:r}),p())},formatter:(e,n)=>i.reduce(((i,r,s)=>i+`${t[s]}${r(e,n)}`),"")+r(t)}}function E(e,t,n){if(e instanceof Date||"number"==typeof e){const t=h(e);return isNaN(t)?void 0:t}if(e){if("today"===e)return p();if(t&&t.toValue){const i=t.toValue(e,t,n);return isNaN(i)?void 0:h(i)}return N(t).parser(e,n)}}function A(e,t,n){if(isNaN(e)||!e&&0!==e)return"";const i="number"==typeof e?new Date(e):e;return t.toDisplay?t.toDisplay(i,t,n):N(t).formatter(i,n)}const I=document.createRange();function R(e){return I.createContextualFragment(e)}function B(e){return e.parentElement||(e.parentNode instanceof ShadowRoot?e.parentNode.host:void 0)}function P(e){return e.getRootNode().activeElement===e}function $(e){"none"!==e.style.display&&(e.style.display&&(e.dataset.styleDisplay=e.style.display),e.style.display="none")}function L(e){"none"===e.style.display&&(e.dataset.styleDisplay?(e.style.display=e.dataset.styleDisplay,delete e.dataset.styleDisplay):e.style.display="")}function V(e){e.firstChild&&(e.removeChild(e.firstChild),V(e))}function z(e,t){V(e),t instanceof DocumentFragment?e.appendChild(t):"string"==typeof t?e.appendChild(R(t)):"function"==typeof t.forEach&&t.forEach((t=>{e.appendChild(t)}))}const F=new WeakMap,{addEventListener:H,removeEventListener:j}=EventTarget.prototype;function W(e,t){let n=F.get(e);n||(n=[],F.set(e,n)),t.forEach((e=>{H.call(...e),n.push(e)}))}function q(e){let t=F.get(e);t&&(t.forEach((e=>{j.call(...e)})),F.delete(e))}if(!Event.prototype.composedPath){const e=(t,n=[])=>{let i;return n.push(t),t.parentNode?i=t.parentNode:t.host?i=t.host:t.defaultView&&(i=t.defaultView),i?e(i,n):n};Event.prototype.composedPath=function(){return e(this.target)}}function J(e,t,n){const[i,...r]=e;return t(i)?i:i!==n&&"HTML"!==i.tagName&&0!==r.length?J(r,t,n):void 0}function K(e,t){const n="function"==typeof t?t:e=>e instanceof Element&&e.matches(t);return J(e.composedPath(),n,e.currentTarget)}const _={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}};var U={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,calendarWeeks:!1,clearBtn:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"»",orientation:"auto",pickLevel:0,prevArrow:"«",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayBtn:!1,todayBtnMode:0,todayHighlight:!1,updateOnBlur:!0,weekStart:0};const{language:Y,format:G,weekStart:X}=U;function Z(e,t){return e.length<6&&t>=0&&t<7?s(e,t):e}function Q(e){return(e+6)%7}function ee(e,t,n,i){const r=E(e,t,n);return void 0!==r?r:i}function te(e,t,n=3){const i=parseInt(e,10);return i>=0&&i<=n?i:t}function ne(e,t){const n=Object.assign({},e),r={},o=t.constructor.locales,a=t.rangeSideIndex;let{format:l,language:c,locale:d,maxDate:h,maxView:p,minDate:f,pickLevel:m,startView:g,weekStart:y}=t.config||{};if(n.language){let e;if(n.language!==c&&(o[n.language]?e=n.language:(e=n.language.split("-")[0],void 0===o[e]&&(e=!1))),delete n.language,e){c=r.language=e;const t=d||o[Y];d=Object.assign({format:G,weekStart:X},o[Y]),c!==Y&&Object.assign(d,o[c]),r.locale=d,l===t.format&&(l=r.format=d.format),y===t.weekStart&&(y=r.weekStart=d.weekStart,r.weekEnd=Q(d.weekStart))}}if(n.format){const e="function"==typeof n.format.toDisplay,t="function"==typeof n.format.toValue,i=x.test(n.format);(e&&t||i)&&(l=r.format=n.format),delete n.format}let w=m;void 0!==n.pickLevel&&(w=te(n.pickLevel,2),delete n.pickLevel),w!==m&&(w>m&&(void 0===n.minDate&&(n.minDate=f),void 0===n.maxDate&&(n.maxDate=h)),n.datesDisabled||(n.datesDisabled=[]),m=r.pickLevel=w);let v=f,b=h;if(void 0!==n.minDate){const e=u(0,0,1);v=null===n.minDate?e:ee(n.minDate,l,d,v),v!==e&&(v=k(v,m,!1)),delete n.minDate}if(void 0!==n.maxDate&&(b=null===n.maxDate?void 0:ee(n.maxDate,l,d,b),void 0!==b&&(b=k(b,m,!0)),delete n.maxDate),b<v?(f=r.minDate=b,h=r.maxDate=v):(f!==v&&(f=r.minDate=v),h!==b&&(h=r.maxDate=b)),n.datesDisabled&&(r.datesDisabled=n.datesDisabled.reduce(((e,t)=>{const n=E(t,l,d);return void 0!==n?s(e,k(n,m,a)):e}),[]),delete n.datesDisabled),void 0!==n.defaultViewDate){const e=E(n.defaultViewDate,l,d);void 0!==e&&(r.defaultViewDate=e),delete n.defaultViewDate}if(void 0!==n.weekStart){const e=Number(n.weekStart)%7;isNaN(e)||(y=r.weekStart=e,r.weekEnd=Q(e)),delete n.weekStart}if(n.daysOfWeekDisabled&&(r.daysOfWeekDisabled=n.daysOfWeekDisabled.reduce(Z,[]),delete n.daysOfWeekDisabled),n.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=n.daysOfWeekHighlighted.reduce(Z,[]),delete n.daysOfWeekHighlighted),void 0!==n.maxNumberOfDates){const e=parseInt(n.maxNumberOfDates,10);e>=0&&(r.maxNumberOfDates=e,r.multidate=1!==e),delete n.maxNumberOfDates}n.dateDelimiter&&(r.dateDelimiter=String(n.dateDelimiter),delete n.dateDelimiter);let S=p;void 0!==n.maxView&&(S=te(n.maxView,p),delete n.maxView),S=m>S?m:S,S!==p&&(p=r.maxView=S);let M=g;if(void 0!==n.startView&&(M=te(n.startView,M),delete n.startView),M<m?M=m:M>p&&(M=p),M!==g&&(r.startView=M),n.prevArrow){const e=R(n.prevArrow);e.childNodes.length>0&&(r.prevArrow=e.childNodes),delete n.prevArrow}if(n.nextArrow){const e=R(n.nextArrow);e.childNodes.length>0&&(r.nextArrow=e.childNodes),delete n.nextArrow}if(void 0!==n.disableTouchKeyboard&&(r.disableTouchKeyboard="ontouchstart"in document&&!!n.disableTouchKeyboard,delete n.disableTouchKeyboard),n.orientation){const e=n.orientation.toLowerCase().split(/\s+/g);r.orientation={x:e.find((e=>"left"===e||"right"===e))||"auto",y:e.find((e=>"top"===e||"bottom"===e))||"auto"},delete n.orientation}if(void 0!==n.todayBtnMode){switch(n.todayBtnMode){case 0:case 1:r.todayBtnMode=n.todayBtnMode}delete n.todayBtnMode}return Object.keys(n).forEach((e=>{void 0!==n[e]&&i(U,e)&&(r[e]=n[e])})),r}var ie=d('<div class="datepicker">\n  <div class="datepicker-picker">\n    <div class="datepicker-header">\n      <div class="datepicker-title"></div>\n      <div class="datepicker-controls">\n        <button type="button" class="%buttonClass% prev-btn"></button>\n        <button type="button" class="%buttonClass% view-switch"></button>\n        <button type="button" class="%buttonClass% next-btn"></button>\n      </div>\n    </div>\n    <div class="datepicker-main"></div>\n    <div class="datepicker-footer">\n      <div class="datepicker-controls">\n        <button type="button" class="%buttonClass% today-btn"></button>\n        <button type="button" class="%buttonClass% clear-btn"></button>\n      </div>\n    </div>\n  </div>\n</div>');var re=d(`<div class="days">\n  <div class="days-of-week">${c("span",7,{class:"dow"})}</div>\n  <div class="datepicker-grid">${c("span",42)}</div>\n</div>`);var se=d(`<div class="calendar-weeks">\n  <div class="days-of-week"><span class="dow"></span></div>\n  <div class="weeks">${c("span",6,{class:"week"})}</div>\n</div>`);class oe{constructor(e,t){Object.assign(this,t,{picker:e,element:R('<div class="datepicker-view"></div>').firstChild,selected:[]}),this.init(this.picker.datepicker.config)}init(e){void 0!==e.pickLevel&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}performBeforeHook(e,t,n){let i=this.beforeShow(new Date(n));switch(typeof i){case"boolean":i={enabled:i};break;case"string":i={classes:i}}if(i){if(!1===i.enabled&&(e.classList.add("disabled"),s(this.disabled,t)),i.classes){const n=i.classes.split(/\s+/);e.classList.add(...n),n.includes("disabled")&&s(this.disabled,t)}i.content&&z(e,i.content)}}}class ae extends oe{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,t=!0){if(t){const e=R(re).firstChild;this.dow=e.firstChild,this.grid=e.lastChild,this.element.appendChild(e)}super.init(e)}setOptions(e){let t;if(i(e,"minDate")&&(this.minDate=e.minDate),i(e,"maxDate")&&(this.maxDate=e.maxDate),e.datesDisabled&&(this.datesDisabled=e.datesDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,t=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),void 0!==e.todayHighlight&&(this.todayHighlight=e.todayHighlight),void 0!==e.weekStart&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,t=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,t=!0}if(void 0!==e.beforeShowDay&&(this.beforeShow="function"==typeof e.beforeShowDay?e.beforeShowDay:void 0),void 0!==e.calendarWeeks)if(e.calendarWeeks&&!this.calendarWeeks){const e=R(se).firstChild;this.calendarWeeks={element:e,dow:e.firstChild,weeks:e.lastChild},this.element.insertBefore(e,this.element.firstChild)}else this.calendarWeeks&&!e.calendarWeeks&&(this.element.removeChild(this.calendarWeeks.element),this.calendarWeeks=null);void 0!==e.showDaysOfWeek&&(e.showDaysOfWeek?(L(this.dow),this.calendarWeeks&&L(this.calendarWeeks.dow)):($(this.dow),this.calendarWeeks&&$(this.calendarWeeks.dow))),t&&Array.from(this.dow.children).forEach(((e,t)=>{const n=(this.weekStart+t)%7;e.textContent=this.dayNames[n],e.className=this.daysOfWeekDisabled.includes(n)?"dow disabled":"dow"}))}updateFocus(){const e=new Date(this.picker.viewDate),t=e.getFullYear(),n=e.getMonth(),i=u(t,n,1),r=w(i,this.weekStart,this.weekStart);this.first=i,this.last=u(t,n+1,0),this.start=r,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e,t&&(this.range=t.dates)}render(){this.today=this.todayHighlight?p():void 0,this.disabled=[...this.datesDisabled];const e=A(this.focused,this.switchLabelFormat,this.locale);if(this.picker.setViewSwitchLabel(e),this.picker.setPrevBtnDisabled(this.first<=this.minDate),this.picker.setNextBtnDisabled(this.last>=this.maxDate),this.calendarWeeks){const e=w(this.first,1,1);Array.from(this.calendarWeeks.weeks.children).forEach(((t,n)=>{t.textContent=v(f(e,7*n))}))}Array.from(this.grid.children).forEach(((e,t)=>{const n=e.classList,i=f(this.start,t),r=new Date(i),o=r.getDay();if(e.className=`datepicker-cell ${this.cellClass}`,e.dataset.date=i,e.textContent=r.getDate(),i<this.first?n.add("prev"):i>this.last&&n.add("next"),this.today===i&&n.add("today"),(i<this.minDate||i>this.maxDate||this.disabled.includes(i))&&n.add("disabled"),this.daysOfWeekDisabled.includes(o)&&(n.add("disabled"),s(this.disabled,i)),this.daysOfWeekHighlighted.includes(o)&&n.add("highlighted"),this.range){const[e,t]=this.range;i>e&&i<t&&n.add("range"),i===e&&n.add("range-start"),i===t&&n.add("range-end")}this.selected.includes(i)&&n.add("selected"),i===this.focused&&n.add("focused"),this.beforeShow&&this.performBeforeHook(e,i,i)}))}refresh(){const[e,t]=this.range||[];this.grid.querySelectorAll(".range, .range-start, .range-end, .selected, .focused").forEach((e=>{e.classList.remove("range","range-start","range-end","selected","focused")})),Array.from(this.grid.children).forEach((n=>{const i=Number(n.dataset.date),r=n.classList;i>e&&i<t&&r.add("range"),i===e&&r.add("range-start"),i===t&&r.add("range-end"),this.selected.includes(i)&&r.add("selected"),i===this.focused&&r.add("focused")}))}refreshFocus(){const e=Math.round((this.focused-this.start)/864e5);this.grid.querySelectorAll(".focused").forEach((e=>{e.classList.remove("focused")})),this.grid.children[e].classList.add("focused")}}function le(e,t){if(!e||!e[0]||!e[1])return;const[[n,i],[r,s]]=e;return n>t||r<t?void 0:[n===t?i:-1,r===t?s:12]}class ce extends oe{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,t=!0){t&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(R(c("span",12,{"data-month":e=>e})))),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),i(e,"minDate"))if(void 0===e.minDate)this.minYear=this.minMonth=this.minDate=void 0;else{const t=new Date(e.minDate);this.minYear=t.getFullYear(),this.minMonth=t.getMonth(),this.minDate=t.setDate(1)}if(i(e,"maxDate"))if(void 0===e.maxDate)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const t=new Date(e.maxDate);this.maxYear=t.getFullYear(),this.maxMonth=t.getMonth(),this.maxDate=u(this.maxYear,this.maxMonth+1,0)}this.isMinView?e.datesDisabled&&(this.datesDisabled=e.datesDisabled):this.datesDisabled=[],void 0!==e.beforeShowMonth&&(this.beforeShow="function"==typeof e.beforeShowMonth?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e.reduce(((e,t)=>{const n=new Date(t),i=n.getFullYear(),r=n.getMonth();return void 0===e[i]?e[i]=[r]:s(e[i],r),e}),{}),t&&t.dates&&(this.range=t.dates.map((e=>{const t=new Date(e);return isNaN(t)?void 0:[t.getFullYear(),t.getMonth()]})))}render(){this.disabled=this.datesDisabled.reduce(((e,t)=>{const n=new Date(t);return this.year===n.getFullYear()&&e.push(n.getMonth()),e}),[]),this.picker.setViewSwitchLabel(this.year),this.picker.setPrevBtnDisabled(this.year<=this.minYear),this.picker.setNextBtnDisabled(this.year>=this.maxYear);const e=this.selected[this.year]||[],t=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,i=this.year===this.maxYear,r=le(this.range,this.year);Array.from(this.grid.children).forEach(((s,o)=>{const a=s.classList,l=u(this.year,o,1);if(s.className=`datepicker-cell ${this.cellClass}`,this.isMinView&&(s.dataset.date=l),s.textContent=this.monthNames[o],(t||n&&o<this.minMonth||i&&o>this.maxMonth||this.disabled.includes(o))&&a.add("disabled"),r){const[e,t]=r;o>e&&o<t&&a.add("range"),o===e&&a.add("range-start"),o===t&&a.add("range-end")}e.includes(o)&&a.add("selected"),o===this.focused&&a.add("focused"),this.beforeShow&&this.performBeforeHook(s,o,l)}))}refresh(){const e=this.selected[this.year]||[],[t,n]=le(this.range,this.year)||[];this.grid.querySelectorAll(".range, .range-start, .range-end, .selected, .focused").forEach((e=>{e.classList.remove("range","range-start","range-end","selected","focused")})),Array.from(this.grid.children).forEach(((i,r)=>{const s=i.classList;r>t&&r<n&&s.add("range"),r===t&&s.add("range-start"),r===n&&s.add("range-end"),e.includes(r)&&s.add("selected"),r===this.focused&&s.add("focused")}))}refreshFocus(){this.grid.querySelectorAll(".focused").forEach((e=>{e.classList.remove("focused")})),this.grid.children[this.focused].classList.add("focused")}}class de extends oe{constructor(e,t){super(e,t)}init(e,t=!0){var n;t&&(this.navStep=10*this.step,this.beforeShowOption=`beforeShow${n=this.cellClass,[...n].reduce(((e,t,n)=>e+(n?t:t.toUpperCase())),"")}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(R(c("span",12)))),super.init(e)}setOptions(e){if(i(e,"minDate")&&(void 0===e.minDate?this.minYear=this.minDate=void 0:(this.minYear=b(e.minDate,this.step),this.minDate=u(this.minYear,0,1))),i(e,"maxDate")&&(void 0===e.maxDate?this.maxYear=this.maxDate=void 0:(this.maxYear=b(e.maxDate,this.step),this.maxDate=u(this.maxYear,11,31))),this.isMinView?e.datesDisabled&&(this.datesDisabled=e.datesDisabled):this.datesDisabled=[],void 0!==e[this.beforeShowOption]){const t=e[this.beforeShowOption];this.beforeShow="function"==typeof t?t:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),t=b(e,this.navStep),n=t+9*this.step;this.first=t,this.last=n,this.start=t-this.step,this.focused=b(e,this.step)}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e.reduce(((e,t)=>s(e,b(t,this.step))),[]),t&&t.dates&&(this.range=t.dates.map((e=>{if(void 0!==e)return b(e,this.step)})))}render(){this.disabled=this.datesDisabled.map((e=>new Date(e).getFullYear())),this.picker.setViewSwitchLabel(`${this.first}-${this.last}`),this.picker.setPrevBtnDisabled(this.first<=this.minYear),this.picker.setNextBtnDisabled(this.last>=this.maxYear),Array.from(this.grid.children).forEach(((e,t)=>{const n=e.classList,i=this.start+t*this.step,r=u(i,0,1);if(e.className=`datepicker-cell ${this.cellClass}`,this.isMinView&&(e.dataset.date=r),e.textContent=e.dataset.year=i,0===t?n.add("prev"):11===t&&n.add("next"),(i<this.minYear||i>this.maxYear||this.disabled.includes(i))&&n.add("disabled"),this.range){const[e,t]=this.range;i>e&&i<t&&n.add("range"),i===e&&n.add("range-start"),i===t&&n.add("range-end")}this.selected.includes(i)&&n.add("selected"),i===this.focused&&n.add("focused"),this.beforeShow&&this.performBeforeHook(e,i,r)}))}refresh(){const[e,t]=this.range||[];this.grid.querySelectorAll(".range, .range-start, .range-end, .selected, .focused").forEach((e=>{e.classList.remove("range","range-start","range-end","selected","focused")})),Array.from(this.grid.children).forEach((n=>{const i=Number(n.textContent),r=n.classList;i>e&&i<t&&r.add("range"),i===e&&r.add("range-start"),i===t&&r.add("range-end"),this.selected.includes(i)&&r.add("selected"),i===this.focused&&r.add("focused")}))}refreshFocus(){const e=Math.round((this.focused-this.start)/this.step);this.grid.querySelectorAll(".focused").forEach((e=>{e.classList.remove("focused")})),this.grid.children[e].classList.add("focused")}}function he(e,t){const n={date:e.getDate(),viewDate:new Date(e.picker.viewDate),viewId:e.picker.currentView.id,datepicker:e};e.element.dispatchEvent(new CustomEvent(t,{detail:n}))}function pe(e,t){const{minDate:n,maxDate:i}=e.config,{currentView:r,viewDate:s}=e.picker;let o;switch(r.id){case 0:o=m(s,t);break;case 1:o=g(s,t);break;default:o=g(s,t*r.navStep)}o=l(o,n,i),e.picker.changeFocus(o).render()}function ue(e){const t=e.picker.currentView.id;t!==e.config.maxView&&e.picker.changeView(t+1).render()}function fe(e){e.config.updateOnBlur?e.update({revert:!0}):e.refresh("input"),e.hide()}function me(e,t){const n=e.picker,i=new Date(n.viewDate),r=n.currentView.id,s=1===r?m(i,t-i.getMonth()):g(i,t-i.getFullYear());n.changeFocus(s).changeView(r-1).render()}function ge(e){const t=e.picker,n=p();if(1===e.config.todayBtnMode){if(e.config.autohide)return void e.setDate(n);e.setDate(n,{render:!1}),t.update()}t.viewDate!==n&&t.changeFocus(n),t.changeView(0).render()}function ye(e){e.setDate({clear:!0})}function we(e){ue(e)}function ve(e){pe(e,-1)}function be(e){pe(e,1)}function ke(e,t){const n=K(t,".datepicker-cell");if(!n||n.classList.contains("disabled"))return;const{id:i,isMinView:r}=e.picker.currentView;r?e.setDate(Number(n.dataset.date)):me(e,Number(1===i?n.dataset.month:n.dataset.year))}function xe(e){e.preventDefault()}const Se=["left","top","right","bottom"].reduce(((e,t)=>(e[t]=`datepicker-orient-${t}`,e)),{}),Me=e=>e?`${e}px`:e;function Oe(e,t){if(void 0!==t.title&&(t.title?(e.controls.title.textContent=t.title,L(e.controls.title)):(e.controls.title.textContent="",$(e.controls.title))),t.prevArrow){const n=e.controls.prevBtn;V(n),t.prevArrow.forEach((e=>{n.appendChild(e.cloneNode(!0))}))}if(t.nextArrow){const n=e.controls.nextBtn;V(n),t.nextArrow.forEach((e=>{n.appendChild(e.cloneNode(!0))}))}if(t.locale&&(e.controls.todayBtn.textContent=t.locale.today,e.controls.clearBtn.textContent=t.locale.clear),void 0!==t.todayBtn&&(t.todayBtn?L(e.controls.todayBtn):$(e.controls.todayBtn)),i(t,"minDate")||i(t,"maxDate")){const{minDate:t,maxDate:n}=e.datepicker.config;e.controls.todayBtn.disabled=!a(p(),t,n)}void 0!==t.clearBtn&&(t.clearBtn?L(e.controls.clearBtn):$(e.controls.clearBtn))}function Ce(e){const{dates:t,config:n}=e;return l(t.length>0?r(t):n.defaultViewDate,n.minDate,n.maxDate)}function De(e,t){const n=new Date(e.viewDate),i=new Date(t),{id:r,year:s,first:o,last:a}=e.currentView,l=i.getFullYear();switch(e.viewDate=t,l!==n.getFullYear()&&he(e.datepicker,"changeYear"),i.getMonth()!==n.getMonth()&&he(e.datepicker,"changeMonth"),r){case 0:return t<o||t>a;case 1:return l!==s;default:return l<o||l>a}}function Te(e){return window.getComputedStyle(e).direction}function Ne(e){const t=B(e);if(t!==document.body&&t)return"visible"!==window.getComputedStyle(t).overflow?t:Ne(t)}class Ee{constructor(e){const{config:t}=this.datepicker=e,n=ie.replace(/%buttonClass%/g,t.buttonClass),i=this.element=R(n).firstChild,[r,s,o]=i.firstChild.children,a=r.firstElementChild,[l,c,d]=r.lastElementChild.children,[h,p]=o.firstChild.children,u={title:a,prevBtn:l,viewSwitch:c,nextBtn:d,todayBtn:h,clearBtn:p};this.main=s,this.controls=u;const f=e.inline?"inline":"dropdown";i.classList.add(`datepicker-${f}`),Oe(this,t),this.viewDate=Ce(e),W(e,[[i,"mousedown",xe],[s,"click",ke.bind(null,e)],[u.viewSwitch,"click",we.bind(null,e)],[u.prevBtn,"click",ve.bind(null,e)],[u.nextBtn,"click",be.bind(null,e)],[u.todayBtn,"click",ge.bind(null,e)],[u.clearBtn,"click",ye.bind(null,e)]]),this.views=[new ae(this),new ce(this),new de(this,{id:2,name:"years",cellClass:"year",step:1}),new de(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[t.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),t.container?t.container.appendChild(this.element):e.inputField.after(this.element)}setOptions(e){Oe(this,e),this.views.forEach((t=>{t.init(e,!1)})),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:t}=this;if(e.inline)t.classList.add("active");else{const n=Te(e.inputField);n!==Te(B(t))?t.dir=n:t.dir&&t.removeAttribute("dir"),t.style.visiblity="hidden",t.classList.add("active"),this.place(),t.style.visiblity="",e.config.disableTouchKeyboard&&e.inputField.blur()}this.active=!0,he(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,he(this.datepicker,"hide"))}place(){const{classList:e,offsetParent:t,style:n}=this.element,{config:i,inputField:r}=this.datepicker,{width:s,height:o}=this.element.getBoundingClientRect(),{left:a,top:l,right:c,bottom:d,width:h,height:p}=r.getBoundingClientRect();let{x:u,y:f}=i.orientation,m=a,g=l;if(t!==document.body&&t){const e=t.getBoundingClientRect();m-=e.left-t.scrollLeft,g-=e.top-t.scrollTop}else m+=window.scrollX,g+=window.scrollY;const y=Ne(r);let w=0,v=0,{clientWidth:b,clientHeight:k}=document.documentElement;if(y){const e=y.getBoundingClientRect();e.top>0&&(v=e.top),e.left>0&&(w=e.left),e.right<b&&(b=e.right),e.bottom<k&&(k=e.bottom)}let x=0;"auto"===u&&(a<w?(u="left",x=w-a):a+s>b?(u="right",b<c&&(x=b-c)):u="rtl"===Te(r)?c-s<w?"left":"right":"left"),"right"===u&&(m+=h-s),m+=x,"auto"===f&&(f=l-o>v&&d+o>k?"top":"bottom"),"top"===f?g-=o:g+=p,e.remove(...Object.values(Se)),e.add(Se[u],Se[f]),n.left=Me(m),n.top=Me(g)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevBtnDisabled(e){this.controls.prevBtn.disabled=e}setNextBtnDisabled(e){this.controls.nextBtn.disabled=e}changeView(e){const t=this.currentView,n=this.views[e];return n.id!==t.id&&(this.currentView=n,this._renderMethod="render",he(this.datepicker,"changeView"),this.main.replaceChild(n.element,t.element)),this}changeFocus(e){return this._renderMethod=De(this,e)?"render":"refreshFocus",this.views.forEach((e=>{e.updateFocus()})),this}update(){const e=Ce(this.datepicker);return this._renderMethod=De(this,e)?"render":"refresh",this.views.forEach((e=>{e.updateFocus(),e.updateSelection()})),this}render(e=!0){const t=e&&this._renderMethod||"render";delete this._renderMethod,this.currentView[t]()}}function Ae(e,t,n,i,r,s){if(a(e,r,s)){if(i(e)){return Ae(t(e,n),t,n,i,r,s)}return e}}function Ie(e,t,n,i){const r=e.picker,s=r.currentView,o=s.step||1;let a,l,c=r.viewDate;switch(s.id){case 0:c=i?f(c,7*n):t.ctrlKey||t.metaKey?g(c,n):f(c,n),a=f,l=e=>s.disabled.includes(e);break;case 1:c=m(c,i?4*n:n),a=m,l=e=>{const t=new Date(e),{year:n,disabled:i}=s;return t.getFullYear()===n&&i.includes(t.getMonth())};break;default:c=g(c,n*(i?4:1)*o),a=g,l=e=>s.disabled.includes(b(e,o))}c=Ae(c,a,n<0?-o:o,l,s.minDate,s.maxDate),void 0!==c&&r.changeFocus(c).render()}function Re(e,t){const n=t.key;if("Tab"===n)return void fe(e);const i=e.picker,{id:r,isMinView:s}=i.currentView;if(i.active){if(e.editMode)return void("Enter"===n?e.exitEditMode({update:!0,autohide:e.config.autohide}):"Escape"===n&&i.hide());if("ArrowLeft"===n)if(t.ctrlKey||t.metaKey)pe(e,-1);else{if(t.shiftKey)return void e.enterEditMode();Ie(e,t,-1,!1)}else if("ArrowRight"===n)if(t.ctrlKey||t.metaKey)pe(e,1);else{if(t.shiftKey)return void e.enterEditMode();Ie(e,t,1,!1)}else if("ArrowUp"===n)if(t.ctrlKey||t.metaKey)ue(e);else{if(t.shiftKey)return void e.enterEditMode();Ie(e,t,-1,!0)}else if("ArrowDown"===n){if(t.shiftKey&&!t.ctrlKey&&!t.metaKey)return void e.enterEditMode();Ie(e,t,1,!0)}else{if("Enter"!==n)return void("Escape"===n?i.hide():"Backspace"!==n&&"Delete"!==n&&(1!==n.length||t.ctrlKey||t.metaKey)||e.enterEditMode());if(s)return void e.setDate(i.viewDate);i.changeView(r-1).render()}}else{if("ArrowDown"!==n)return void("Enter"===n?e.update():"Escape"===n&&i.show());i.show()}t.preventDefault()}function Be(e){e.config.showOnFocus&&!e._showing&&e.show()}function Pe(e,t){const n=t.target;(e.picker.active||e.config.showOnClick)&&(n._active=P(n),n._clicking=setTimeout((()=>{delete n._active,delete n._clicking}),2e3))}function $e(e,t){const n=t.target;n._clicking&&(clearTimeout(n._clicking),delete n._clicking,n._active&&e.enterEditMode(),delete n._active,e.config.showOnClick&&e.show())}function Le(e,t){t.clipboardData.types.includes("text/plain")&&e.enterEditMode()}function Ve(e,t){const{element:n,picker:i}=e;if(!i.active&&!P(n))return;const r=i.element;K(t,(e=>e===n||e===r))||fe(e)}function ze(e,t){return e.map((e=>A(e,t.format,t.locale))).join(t.dateDelimiter)}function Fe(e,t,n=!1){const{config:i,dates:r,rangeSideIndex:s}=e;if(0===t.length)return n?[]:void 0;let o=t.reduce(((e,t)=>{let n=E(t,i.format,i.locale);return void 0===n||(n=k(n,i.pickLevel,s),!a(n,i.minDate,i.maxDate)||e.includes(n)||i.datesDisabled.includes(n)||!(i.pickLevel>0)&&i.daysOfWeekDisabled.includes(new Date(n).getDay())||e.push(n)),e}),[]);return 0!==o.length?(i.multidate&&!n&&(o=o.reduce(((e,t)=>(r.includes(t)||e.push(t),e)),r.filter((e=>!o.includes(e))))),i.maxNumberOfDates&&o.length>i.maxNumberOfDates?o.slice(-1*i.maxNumberOfDates):o):void 0}function He(e,t=3,n=!0){const{config:i,picker:r,inputField:s}=e;if(2&t){const e=r.active?i.pickLevel:i.startView;r.update().changeView(e).render(n)}1&t&&s&&(s.value=ze(e.dates,i))}function je(e,t,n){let{clear:i,render:r,autohide:s,revert:o}=n;void 0===r&&(r=!0),r?void 0===s&&(s=e.config.autohide):s=!1;const a=Fe(e,t,i);(a||o)&&(a&&a.toString()!==e.dates.toString()?(e.dates=a,He(e,r?3:1),he(e,"changeDate")):He(e,1),s&&e.hide())}class We{constructor(e,t={},n){e.datepicker=this,this.element=e;const i=this.config=Object.assign({buttonClass:t.buttonClass&&String(t.buttonClass)||"button",container:null,defaultViewDate:p(),maxDate:void 0,minDate:void 0},ne(U,this)),r=this.inline="INPUT"!==e.tagName;let s,a;if(r?i.container=e:(t.container&&(i.container=t.container instanceof HTMLElement?t.container:document.querySelector(t.container)),s=this.inputField=e,s.classList.add("datepicker-input")),n){const e=n.inputs.indexOf(s),t=n.datepickers;if(e<0||e>1||!Array.isArray(t))throw Error("Invalid rangepicker object.");t[e]=this,Object.defineProperty(this,"rangepicker",{get:()=>n}),Object.defineProperty(this,"rangeSideIndex",{get:()=>e})}this._options=t,Object.assign(i,ne(t,this)),r?(a=o(e.dataset.date,i.dateDelimiter),delete e.dataset.date):a=o(s.value,i.dateDelimiter),this.dates=[];const l=Fe(this,a);l&&l.length>0&&(this.dates=l),s&&(s.value=ze(this.dates,i));const c=this.picker=new Ee(this);if(r)this.show();else{const e=Ve.bind(null,this);W(this,[[s,"keydown",Re.bind(null,this)],[s,"focus",Be.bind(null,this)],[s,"mousedown",Pe.bind(null,this)],[s,"click",$e.bind(null,this)],[s,"paste",Le.bind(null,this)],[document,"mousedown",e],[document,"touchstart",e],[window,"resize",c.place.bind(c)]])}}static formatDate(e,t,n){return A(e,t,n&&_[n]||_.en)}static parseDate(e,t,n){return E(e,t,n&&_[n]||_.en)}static get locales(){return _}get active(){return!(!this.picker||!this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const t=this.picker,n=ne(e,this);Object.assign(this._options,e),Object.assign(this.config,n),t.setOptions(n),He(this,3)}show(){if(this.inputField){if(this.inputField.disabled)return;P(this.inputField)||this.config.disableTouchKeyboard||(this._showing=!0,this.inputField.focus(),delete this._showing)}this.picker.show()}hide(){this.inline||(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}destroy(){return this.hide(),q(this),this.picker.detach(),this.inline||this.inputField.classList.remove("datepicker-input"),delete this.element.datepicker,this}getDate(e){const t=e?t=>A(t,e,this.config.locale):e=>new Date(e);return this.config.multidate?this.dates.map(t):this.dates.length>0?t(this.dates[0]):void 0}setDate(...e){const t=[...e],n={},i=r(e);"object"!=typeof i||Array.isArray(i)||i instanceof Date||!i||Object.assign(n,t.pop());je(this,Array.isArray(t[0])?t[0]:t,n)}update(e){if(this.inline)return;const t=Object.assign(e||{},{clear:!0,render:!0});je(this,o(this.inputField.value,this.config.dateDelimiter),t)}refresh(e,t=!1){let n;e&&"string"!=typeof e&&(t=e,e=void 0),n="picker"===e?2:"input"===e?1:3,He(this,n,!t)}enterEditMode(){this.inline||!this.picker.active||this.editMode||(this.editMode=!0,this.inputField.classList.add("in-edit"))}exitEditMode(e){if(this.inline||!this.editMode)return;const t=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),t.update&&this.update(t)}}const qe={closeListbox:e=>{let t=null!==e.$local.focusedOptionId;e.$local.focusedOptionId=null,e.search=null,t&&e.$el.querySelector("[jmb-ref=button]").focus()},toggleListboxVisibility:e=>{if(null!==e.search)return juiLov.closeListbox(e);e.search=String(""),e.$local.focusedOptionId=null},selectOption:function(e,t){let n=e.$local.focusedOptionId;e.$local.focusedOptionId=null,e.selected=null!==n&&""!==n?String(n):null,e.search=null,t("select-option-changed",{selected:e.selected})},focusNext:function(e){null===e.$local.focusedOptionId?nextOption=e.$el.querySelector("[option-id]"):(selOption=e.$el.querySelector("[option-id='"+e.$local.focusedOptionId+"']"),nextOption=null!==selOption?selOption.nextElementSibling:null,null===nextOption&&(nextOption=e.$el.querySelector("[option-id]"))),null!==nextOption&&(e.$local.focusedOptionId=nextOption.getAttribute("option-id"),nextOption.scrollIntoViewIfNeeded())},focusPrev:function(e){null===e.$local.focusedOptionId?prevOption=e.$el.querySelector("[option-id]:last-of-type"):(selOption=e.$el.querySelector("[option-id='"+e.$local.focusedOptionId+"']"),prevOption=null!==selOption?selOption.previousElementSibling:null,null===prevOption&&(prevOption=e.$el.querySelector("[option-id]:last-of-type"))),null!==prevOption&&(e.$local.focusedOptionId=prevOption.getAttribute("option-id"),prevOption.scrollIntoViewIfNeeded())}};function Je(e){this.content=e}Je.prototype={constructor:Je,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var i=n&&n!=e?this.remove(n):this,r=i.find(e),s=i.content.slice();return-1==r?s.push(n||e,t):(s[r+1]=t,n&&(s[r]=n)),new Je(s)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new Je(n)},addToStart:function(e,t){return new Je([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new Je(n)},addBefore:function(e,t,n){var i=this.remove(t),r=i.content.slice(),s=i.find(e);return r.splice(-1==s?r.length:s,0,t,n),new Je(r)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=Je.from(e)).size?new Je(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=Je.from(e)).size?new Je(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=Je.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach((function(t,n){e[t]=n})),e},get size(){return this.content.length>>1}},Je.from=function(e){if(e instanceof Je)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new Je(t)};var Ke=Je;function _e(e,t,n){for(let i=0;;i++){if(i==e.childCount||i==t.childCount)return e.childCount==t.childCount?null:n;let r=e.child(i),s=t.child(i);if(r!=s){if(!r.sameMarkup(s))return n;if(r.isText&&r.text!=s.text){for(let e=0;r.text[e]==s.text[e];e++)n++;return n}if(r.content.size||s.content.size){let e=_e(r.content,s.content,n+1);if(null!=e)return e}n+=r.nodeSize}else n+=r.nodeSize}}function Ue(e,t,n,i){for(let r=e.childCount,s=t.childCount;;){if(0==r||0==s)return r==s?null:{a:n,b:i};let o=e.child(--r),a=t.child(--s),l=o.nodeSize;if(o!=a){if(!o.sameMarkup(a))return{a:n,b:i};if(o.isText&&o.text!=a.text){let e=0,t=Math.min(o.text.length,a.text.length);for(;e<t&&o.text[o.text.length-e-1]==a.text[a.text.length-e-1];)e++,n--,i--;return{a:n,b:i}}if(o.content.size||a.content.size){let e=Ue(o.content,a.content,n-1,i-1);if(e)return e}n-=l,i-=l}else n-=l,i-=l}}class Ye{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,i=0,r){for(let s=0,o=0;o<t;s++){let a=this.content[s],l=o+a.nodeSize;if(l>e&&!1!==n(a,i+o,r||null,s)&&a.content.size){let r=o+1;a.nodesBetween(Math.max(0,e-r),Math.min(a.content.size,t-r),n,i+r)}o=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let r="",s=!0;return this.nodesBetween(e,t,((o,a)=>{o.isText?(r+=o.text.slice(Math.max(e,a)-a,t-a),s=!n):o.isLeaf?(i?r+="function"==typeof i?i(o):i:o.type.spec.leafText&&(r+=o.type.spec.leafText(o)),s=!n):!s&&o.isBlock&&(r+=n,s=!0)}),0),r}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),r=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),r=1);r<e.content.length;r++)i.push(e.content[r]);return new Ye(i,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],i=0;if(t>e)for(let r=0,s=0;s<t;r++){let o=this.content[r],a=s+o.nodeSize;a>e&&((s<e||a>t)&&(o=o.isText?o.cut(Math.max(0,e-s),Math.min(o.text.length,t-s)):o.cut(Math.max(0,e-s-1),Math.min(o.content.size,t-s-1))),n.push(o),i+=o.nodeSize),s=a}return new Ye(n,i)}cutByIndex(e,t){return e==t?Ye.empty:0==e&&t==this.content.length?this:new Ye(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),r=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new Ye(i,r)}addToStart(e){return new Ye([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Ye(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return _e(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Ue(this,e,t,n)}findIndex(e,t=-1){if(0==e)return Xe(0,e);if(e==this.size)return Xe(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,i=0;;n++){let r=i+this.child(n).nodeSize;if(r>=e)return r==e||t>0?Xe(n+1,r):Xe(n,i);i=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return Ye.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Ye(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Ye.empty;let t,n=0;for(let i=0;i<e.length;i++){let r=e[i];n+=r.nodeSize,i&&r.isText&&e[i-1].sameMarkup(r)?(t||(t=e.slice(0,i)),t[t.length-1]=r.withText(t[t.length-1].text+r.text)):t&&t.push(r)}return new Ye(t||e,n)}static from(e){if(!e)return Ye.empty;if(e instanceof Ye)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Ye([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Ye.empty=new Ye([],0);const Ge={index:0,offset:0};function Xe(e,t){return Ge.index=e,Ge.offset=t,Ge}function Ze(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!Ze(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!Ze(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}class Qe{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let r=e[i];if(this.eq(r))return e;if(this.type.excludes(r.type))t||(t=e.slice(0,i));else{if(r.type.excludes(this.type))return e;!n&&r.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(r)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Ze(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);return n.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return Qe.none;if(e instanceof Qe)return[e];let t=e.slice();return t.sort(((e,t)=>e.type.rank-t.type.rank)),t}}Qe.none=[];class et extends Error{}class tt{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=it(this.content,e+this.openStart,t);return n&&new tt(n,this.openStart,this.openEnd)}removeBetween(e,t){return new tt(nt(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return tt.empty;let n=t.openStart||0,i=t.openEnd||0;if("number"!=typeof n||"number"!=typeof i)throw new RangeError("Invalid input for Slice.fromJSON");return new tt(Ye.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)n++;for(let n=e.lastChild;n&&!n.isLeaf&&(t||!n.type.spec.isolating);n=n.lastChild)i++;return new tt(e,n,i)}}function nt(e,t,n){let{index:i,offset:r}=e.findIndex(t),s=e.maybeChild(i),{index:o,offset:a}=e.findIndex(n);if(r==t||s.isText){if(a!=n&&!e.child(o).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(i!=o)throw new RangeError("Removing non-flat range");return e.replaceChild(i,s.copy(nt(s.content,t-r-1,n-r-1)))}function it(e,t,n,i){let{index:r,offset:s}=e.findIndex(t),o=e.maybeChild(r);if(s==t||o.isText)return i&&!i.canReplace(r,r,n)?null:e.cut(0,t).append(n).append(e.cut(t));let a=it(o.content,t-s-1,n);return a&&e.replaceChild(r,o.copy(a))}function rt(e,t,n){if(n.openStart>e.depth)throw new et("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new et("Inconsistent open depths");return st(e,t,n,0)}function st(e,t,n,i){let r=e.index(i),s=e.node(i);if(r==t.index(i)&&i<e.depth-n.openStart){let o=st(e,t,n,i+1);return s.copy(s.content.replaceChild(r,o))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=i||t.depth!=i){let{start:r,end:o}=function(e,t){let n=t.depth-e.openStart,i=t.node(n).copy(e.content);for(let e=n-1;e>=0;e--)i=t.node(e).copy(Ye.from(i));return{start:i.resolveNoCache(e.openStart+n),end:i.resolveNoCache(i.content.size-e.openEnd-n)}}(n,e);return dt(s,ht(e,r,o,t,i))}{let i=e.parent,r=i.content;return dt(i,r.cut(0,e.parentOffset).append(n.content).append(r.cut(t.parentOffset)))}}return dt(s,pt(e,t,i))}function ot(e,t){if(!t.type.compatibleContent(e.type))throw new et("Cannot join "+t.type.name+" onto "+e.type.name)}function at(e,t,n){let i=e.node(n);return ot(i,t.node(n)),i}function lt(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function ct(e,t,n,i){let r=(t||e).node(n),s=0,o=t?t.index(n):r.childCount;e&&(s=e.index(n),e.depth>n?s++:e.textOffset&&(lt(e.nodeAfter,i),s++));for(let e=s;e<o;e++)lt(r.child(e),i);t&&t.depth==n&&t.textOffset&&lt(t.nodeBefore,i)}function dt(e,t){return e.type.checkContent(t),e.copy(t)}function ht(e,t,n,i,r){let s=e.depth>r&&at(e,t,r+1),o=i.depth>r&&at(n,i,r+1),a=[];return ct(null,e,r,a),s&&o&&t.index(r)==n.index(r)?(ot(s,o),lt(dt(s,ht(e,t,n,i,r+1)),a)):(s&&lt(dt(s,pt(e,t,r+1)),a),ct(t,n,r,a),o&&lt(dt(o,pt(n,i,r+1)),a)),ct(i,null,r,a),new Ye(a)}function pt(e,t,n){let i=[];if(ct(null,e,n,i),e.depth>n){lt(dt(at(e,t,n+1),pt(e,t,n+1)),i)}return ct(t,null,n,i),new Ye(i)}tt.empty=new tt(Ye.empty,0,0);class ut{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],i=0==t?0:this.path[3*t-1]+1;for(let t=0;t<e;t++)i+=n.child(t).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return Qe.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let e=n;n=i,i=e}let r=n.marks;for(var s=0;s<r.length;s++)!1!==r[s].type.spec.inclusive||i&&r[s].isInSet(i.marks)||(r=r[s--].removeFromSet(r));return r}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var r=0;r<n.length;r++)!1!==n[r].type.spec.inclusive||i&&n[r].isInSet(i.marks)||(n=n[r--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new yt(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,r=t;for(let t=e;;){let{index:e,offset:s}=t.content.findIndex(r),o=r-s;if(n.push(t,e,i+s),!o)break;if(t=t.child(e),t.isText)break;r=o-1,i+=s+1}return new ut(t,n,r)}static resolveCached(e,t){for(let n=0;n<ft.length;n++){let i=ft[n];if(i.pos==t&&i.doc==e)return i}let n=ft[mt]=ut.resolve(e,t);return mt=(mt+1)%gt,n}}let ft=[],mt=0,gt=12;class yt{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const wt=Object.create(null);class vt{constructor(e,t,n,i=Qe.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||Ye.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Ze(this.attrs,t||e.defaultAttrs||wt)&&Qe.sameSet(this.marks,n||Qe.none)}copy(e=null){return e==this.content?this:new vt(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new vt(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return tt.empty;let i=this.resolve(e),r=this.resolve(t),s=n?0:i.sharedDepth(t),o=i.start(s),a=i.node(s).content.cut(i.pos-o,r.pos-o);return new tt(a,i.depth-s,r.depth-s)}replace(e,t,n){return rt(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return ut.resolveCached(this,e)}resolveNoCache(e){return ut.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,(e=>(n.isInSet(e.marks)&&(i=!0),!i))),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),kt(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=Ye.empty,i=0,r=n.childCount){let s=this.contentMatchAt(e).matchFragment(n,i,r),o=s&&s.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let e=i;e<r;e++)if(!this.type.allowsMarks(n.child(e).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(e).matchType(n),s=r&&r.matchFragment(this.content,t);return!!s&&s.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=Qe.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!Qe.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=Ye.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,n)}}vt.prototype.text=void 0;class bt extends vt{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):kt(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new bt(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new bt(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function kt(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class xt{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new St(e,t);if(null==n.next)return xt.empty;let i=Mt(n);n.next&&n.err("Unexpected trailing text");let r=function(e){let t=Object.create(null);return n(Et(e,0));function n(i){let r=[];i.forEach((t=>{e[t].forEach((({term:t,to:n})=>{if(!t)return;let i;for(let e=0;e<r.length;e++)r[e][0]==t&&(i=r[e][1]);Et(e,n).forEach((e=>{i||r.push([t,i=[]]),-1==i.indexOf(e)&&i.push(e)}))}))}));let s=t[i.join(",")]=new xt(i.indexOf(e.length-1)>-1);for(let e=0;e<r.length;e++){let i=r[e][1].sort(Nt);s.next.push({type:r[e][0],next:t[i.join(",")]||n(i)})}return s}}(function(e){let t=[[]];return r(s(e,0),n()),t;function n(){return t.push([])-1}function i(e,n,i){let r={term:i,to:n};return t[e].push(r),r}function r(e,t){e.forEach((e=>e.to=t))}function s(e,t){if("choice"==e.type)return e.exprs.reduce(((e,n)=>e.concat(s(n,t))),[]);if("seq"!=e.type){if("star"==e.type){let o=n();return i(t,o),r(s(e.expr,o),o),[i(o)]}if("plus"==e.type){let o=n();return r(s(e.expr,t),o),r(s(e.expr,o),o),[i(o)]}if("opt"==e.type)return[i(t)].concat(s(e.expr,t));if("range"==e.type){let o=t;for(let t=0;t<e.min;t++){let t=n();r(s(e.expr,o),t),o=t}if(-1==e.max)r(s(e.expr,o),o);else for(let t=e.min;t<e.max;t++){let t=n();i(o,t),r(s(e.expr,o),t),o=t}return[i(o)]}if("name"==e.type)return[i(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let i=0;;i++){let o=s(e.exprs[i],t);if(i==e.exprs.length-1)return o;r(o,t=n())}}}(i));return function(e,t){for(let n=0,i=[e];n<i.length;n++){let e=i[n],r=!e.validEnd,s=[];for(let t=0;t<e.next.length;t++){let{type:n,next:o}=e.next[t];s.push(n.name),!r||n.isText||n.hasRequiredAttrs()||(r=!1),-1==i.indexOf(o)&&i.push(o)}r&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(r,n),r}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let r=t;i&&r<n;r++)i=i.matchType(e.child(r).type);return i}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];return function r(s,o){let a=s.matchFragment(e,n);if(a&&(!t||a.validEnd))return Ye.from(o.map((e=>e.createAndFill())));for(let e=0;e<s.next.length;e++){let{type:t,next:n}=s.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==i.indexOf(n)){i.push(n);let e=r(n,o.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),r=i.match;if(r.matchType(e)){let e=[];for(let t=i;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<r.next.length;e++){let{type:s,next:o}=r.next[e];s.isLeaf||s.hasRequiredAttrs()||s.name in t||i.type&&!o.validEnd||(n.push({match:s.contentMatch,type:s,via:i}),t[s.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let i=0;i<n.next.length;i++)-1==e.indexOf(n.next[i].next)&&t(n.next[i].next)}(this),e.map(((t,n)=>{let i=n+(t.validEnd?"*":" ")+" ";for(let n=0;n<t.next.length;n++)i+=(n?", ":"")+t.next[n].type.name+"->"+e.indexOf(t.next[n].next);return i})).join("\n")}}xt.empty=new xt(!0);class St{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Mt(e){let t=[];do{t.push(Ot(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function Ot(e){let t=[];do{t.push(Ct(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function Ct(e){let t=function(e){if(e.eat("(")){let t=Mt(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,i=n[t];if(i)return[i];let r=[];for(let e in n){let i=n[e];i.groups.indexOf(t)>-1&&r.push(i)}0==r.length&&e.err("No node type or group '"+t+"' found");return r}(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=Tt(e,t)}return t}function Dt(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function Tt(e,t){let n=Dt(e),i=n;return e.eat(",")&&(i="}"!=e.next?Dt(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:i,expr:t}}function Nt(e,t){return t-e}function Et(e,t){let n=[];return function t(i){let r=e[i];if(1==r.length&&!r[0].term)return t(r[0].to);n.push(i);for(let e=0;e<r.length;e++){let{term:i,to:s}=r[e];i||-1!=n.indexOf(s)||t(s)}}(t),n.sort(Nt)}function At(e){let t=Object.create(null);for(let n in e){let i=e[n];if(!i.hasDefault)return null;t[n]=i.default}return t}function It(e,t){let n=Object.create(null);for(let i in e){let r=t&&t[i];if(void 0===r){let t=e[i];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+i);r=t.default}n[i]=r}return n}function Rt(e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Pt(e[n]);return t}class Bt{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Rt(n.attrs),this.defaultAttrs=At(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==xt.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:It(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new vt(this,this.computeAttrs(e),Ye.from(t),Qe.setFrom(n))}createChecked(e=null,t,n){return t=Ye.from(t),this.checkContent(t),new vt(this,this.computeAttrs(e),t,Qe.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=Ye.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let i=this.contentMatch.matchFragment(t),r=i&&i.fillBefore(Ye.empty,!0);return r?new vt(this,e,t.append(r),Qe.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:Qe.none:e}static compile(e,t){let n=Object.create(null);e.forEach(((e,i)=>n[e]=new Bt(e,t,i)));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let e in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}class Pt{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class $t{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Rt(i.attrs),this.excluded=null;let r=At(this.attrs);this.instance=r?new Qe(this,r):null}create(e=null){return!e&&this.instance?this.instance:new Qe(this,It(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach(((e,r)=>n[e]=new $t(e,i++,t,r))),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class Lt{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=Ke.from(e.nodes),t.marks=Ke.from(e.marks||{}),this.nodes=Bt.compile(this.spec.nodes,this),this.marks=$t.compile(this.spec.marks,this);let n=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw new RangeError(e+" can not be both a node and a mark");let t=this.nodes[e],i=t.spec.content||"",r=t.spec.marks;t.contentMatch=n[i]||(n[i]=xt.parse(i,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.markSet="_"==r?null:r?Vt(this,r.split(" ")):""!=r&&t.inlineContent?null:[]}for(let e in this.marks){let t=this.marks[e],n=t.spec.excludes;t.excluded=null==n?[t]:""==n?[]:Vt(this,n.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof Bt))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new bt(n,n.defaultAttrs,e,Qe.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return vt.fromJSON(this,e)}markFromJSON(e){return Qe.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Vt(e,t){let n=[];for(let i=0;i<t.length;i++){let r=t[i],s=e.marks[r],o=s;if(s)n.push(s);else for(let t in e.marks){let i=e.marks[t];("_"==r||i.spec.group&&i.spec.group.split(" ").indexOf(r)>-1)&&n.push(o=i)}if(!o)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return n}class zt{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach((e=>{e.tag?this.tags.push(e):e.style&&this.styles.push(e)})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new Jt(this,t,!1);return n.addAll(e,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new Jt(this,t,!0);return n.addAll(e,t.from,t.to),tt.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let n=this.tags[i];if(Kt(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let i=this.styles[r],s=i.style;if(!(0!=s.indexOf(e)||i.context&&!n.matchesContext(i.context)||s.length>e.length&&(61!=s.charCodeAt(e.length)||s.slice(e.length+1)!=t))){if(i.getAttrs){let e=i.getAttrs(t);if(!1===e)continue;i.attrs=e||void 0}return i}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,i=0;for(;i<t.length;i++){let e=t[i];if((null==e.priority?50:e.priority)<n)break}t.splice(i,0,e)}for(let t in e.marks){let i=e.marks[t].spec.parseDOM;i&&i.forEach((e=>{n(e=_t(e)),e.mark=t}))}for(let t in e.nodes){let i=e.nodes[t].spec.parseDOM;i&&i.forEach((e=>{n(e=_t(e)),e.node=t}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new zt(e,zt.schemaRules(e)))}}const Ft={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ht={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},jt={ol:!0,ul:!0};function Wt(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class qt{constructor(e,t,n,i,r,s,o){this.type=e,this.attrs=t,this.marks=n,this.pendingMarks=i,this.solid=r,this.options=o,this.content=[],this.activeMarks=Qe.none,this.stashMarks=[],this.match=s||(4&o?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Ye.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=Ye.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Ye.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,n=this.pendingMarks;t<n.length;t++){let i=n[t];(this.type?this.type.allowsMarkType(i.type):Ut(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ft.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Jt{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let i,r=t.topNode,s=Wt(null,t.preserveWhitespace,0)|(n?4:0);i=r?new qt(r.type,r.attrs,Qe.none,Qe.none,!0,t.topMatch||r.type.contentMatch,s):new qt(n?null:e.schema.topNodeType,null,Qe.none,Qe.none,!0,null,s),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(3==e.nodeType)this.addTextNode(e);else if(1==e.nodeType){let t=e.getAttribute("style"),n=t?this.readStyles(function(e){let t,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,i=[];for(;t=n.exec(e);)i.push(t[1],t[2].trim());return i}(t)):null,i=this.top;if(null!=n)for(let e=0;e<n.length;e++)this.addPendingMark(n[e]);if(this.addElement(e),null!=n)for(let e=0;e<n.length;e++)this.removePendingMark(n[e],i)}}addTextNode(e){let t=e.nodeValue,n=this.top;if(2&n.options||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(1&n.options)t=2&n.options?t.replace(/\r\n?/g,"\n"):t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=n.content[n.content.length-1],r=e.previousSibling;(!i||r&&"BR"==r.nodeName||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let n,i=e.nodeName.toLowerCase();jt.hasOwnProperty(i)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&jt.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let r=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(n=this.parser.matchTag(e,this,t));if(r?r.ignore:Ht.hasOwnProperty(i))this.findInside(e),this.ignoreFallback(e);else if(!r||r.skip||r.closeParent){r&&r.closeParent?this.open=Math.max(0,this.open-1):r&&r.skip.nodeType&&(e=r.skip);let t,n=this.top,s=this.needsBlock;if(Ft.hasOwnProperty(i))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),t=!0,n.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e);this.addAll(e),t&&this.sync(n),this.needsBlock=s}else this.addElementByRule(e,r,!1===r.consuming?n:void 0)}leafFallback(e){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"))}ignoreFallback(e){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=Qe.none;e:for(let n=0;n<e.length;n+=2)for(let i;;){let r=this.parser.matchStyle(e[n],e[n+1],this,i);if(!r)continue e;if(r.ignore)return null;if(t=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(t),!1!==r.consuming)break;i=r}return t}addElementByRule(e,t,n){let i,r,s;if(t.node)r=this.parser.schema.nodes[t.node],r.isLeaf?this.insertNode(r.create(t.attrs))||this.leafFallback(e):i=this.enter(r,t.attrs||null,t.preserveWhitespace);else{s=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(s)}let o=this.top;if(r&&r.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e)));else{let n=e;"string"==typeof t.contentElement?n=e.querySelector(t.contentElement):"function"==typeof t.contentElement?n=t.contentElement(e):t.contentElement&&(n=t.contentElement),this.findAround(e,n,!0),this.addAll(n)}i&&this.sync(o)&&this.open--,s&&this.removePendingMark(s,o)}addAll(e,t,n){let i=t||0;for(let r=t?e.childNodes[t]:e.firstChild,s=null==n?null:e.childNodes[n];r!=s;r=r.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(r);this.findAtPoint(e,i)}findPlace(e){let t,n;for(let i=this.open;i>=0;i--){let r=this.nodes[i],s=r.findWrapping(e);if(s&&(!t||t.length>s.length)&&(t=s,n=r,!s.length))break;if(r.solid)break}if(!t)return!1;this.sync(n);for(let e=0;e<t.length;e++)this.enterInner(t[e],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let n=t.activeMarks;for(let i=0;i<e.marks.length;i++)t.type&&!t.type.allowsMarkType(e.marks[i].type)||(n=e.marks[i].addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,n),i}enterInner(e,t=null,n=!1,i){this.closeExtra();let r=this.top;r.applyPending(e),r.match=r.match&&r.match.matchType(e);let s=Wt(e,i,r.options);4&r.options&&0==r.content.length&&(s|=4),this.nodes.push(new qt(e,t,r.activeMarks,r.pendingMarks,n,null,s)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)if(null==this.find[i].pos&&1==e.nodeType&&e.contains(this.find[i].node)){t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),r=-(n?n.depth+1:0)+(i?0:1),s=(e,o)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;o>=r;o--)if(s(e-1,o))return!0;return!1}{let e=o>0||0==o&&i?this.nodes[o].type:n&&o>=r?n.node(o-r).type:null;if(!e||e.name!=a&&-1==e.groups.indexOf(a))return!1;o--}}return!0};return s(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}addPendingMark(e){let t=function(e,t){for(let n=0;n<t.length;n++)if(e.eq(t[n]))return t[n]}(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let n=this.open;n>=0;n--){let i=this.nodes[n];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let t=i.popFromStashMark(e);t&&i.type&&i.type.allowsMarkType(t.type)&&(i.activeMarks=t.addToSet(i.activeMarks))}if(i==t)break}}}function Kt(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function _t(e){let t={};for(let n in e)t[n]=e[n];return t}function Ut(e,t){let n=t.schema.nodes;for(let i in n){let r=n[i];if(!r.allowsMarkType(e))continue;let s=[],o=e=>{s.push(e);for(let n=0;n<e.edgeCount;n++){let{type:i,next:r}=e.edge(n);if(i==t)return!0;if(s.indexOf(r)<0&&o(r))return!0}};if(o(r.contentMatch))return!0}}class Yt{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=Xt(t).createDocumentFragment());let i=n,r=[];return e.forEach((e=>{if(r.length||e.marks.length){let n=0,s=0;for(;n<r.length&&s<e.marks.length;){let t=e.marks[s];if(this.marks[t.type.name]){if(!t.eq(r[n][0])||!1===t.type.spec.spanning)break;n++,s++}else s++}for(;n<r.length;)i=r.pop()[1];for(;s<e.marks.length;){let n=e.marks[s++],o=this.serializeMark(n,e.isInline,t);o&&(r.push([n,i]),i.appendChild(o.dom),i=o.contentDOM||o.dom)}}i.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:i}=Yt.renderSpec(Xt(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let r=this.serializeMark(e.marks[i],e.isInline,t);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(e,t,n={}){let i=this.marks[e.type.name];return i&&Yt.renderSpec(Xt(n),i(e,t))}static renderSpec(e,t,n=null){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let i,r=t[0],s=r.indexOf(" ");s>0&&(n=r.slice(0,s),r=r.slice(s+1));let o=n?e.createElementNS(n,r):e.createElement(r),a=t[1],l=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){l=2;for(let e in a)if(null!=a[e]){let t=e.indexOf(" ");t>0?o.setAttributeNS(e.slice(0,t),e.slice(t+1),a[e]):o.setAttribute(e,a[e])}}for(let r=l;r<t.length;r++){let s=t[r];if(0===s){if(r<t.length-1||r>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:o,contentDOM:o}}{let{dom:t,contentDOM:r}=Yt.renderSpec(e,s,n);if(o.appendChild(t),r){if(i)throw new RangeError("Multiple content holes");i=r}}}return{dom:o,contentDOM:i}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Yt(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Gt(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return Gt(e.marks)}}function Gt(e){let t={};for(let n in e){let i=e[n].spec.toDOM;i&&(t[n]=i)}return t}function Xt(e){return e.document||window.document}const Zt=Math.pow(2,16);function Qt(e){return 65535&e}class en{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class tn{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&tn.empty)return tn.empty}recover(e){let t=0,n=Qt(e);if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/Zt}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,r=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?i:0);if(a>e)break;let l=this.ranges[o+r],c=this.ranges[o+s],d=a+l;if(e<=d){let r=a+i+((l?e==a?-1:e==d?1:t:t)<0?0:c);if(n)return r;let s=e==(t<0?a:d)?null:o/3+(e-a)*Zt,h=e==a?2:e==d?1:4;return(t<0?e!=a:e!=d)&&(h|=8),new en(r,h,s)}i+=c-l}return n?e+i:new en(e+i,0,null)}touches(e,t){let n=0,i=Qt(t),r=this.inverted?2:1,s=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let o=this.ranges[t]-(this.inverted?n:0);if(o>e)break;let a=this.ranges[t+r];if(e<=o+a&&t==3*i)return!0;n+=this.ranges[t+s]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,r=0;i<this.ranges.length;i+=3){let s=this.ranges[i],o=s-(this.inverted?r:0),a=s+(this.inverted?0:r),l=this.ranges[i+t],c=this.ranges[i+n];e(o,o+l,a,a+c),r+=c-l}}invert(){return new tn(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?tn.empty:new tn(e<0?[0,-e,0]:[0,0,e])}}tn.empty=new tn([]);class nn{constructor(e=[],t,n=0,i=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=i}slice(e=0,t=this.maps.length){return new nn(this.maps,this.mirror,e,t)}copy(){return new nn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],null!=i&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=i&&i>t?n-i-1:void 0)}}invert(){let e=new nn;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let n=this.from;n<this.to;n++){let r=this.maps[n].mapResult(e,t);if(null!=r.recover){let t=this.getMirror(n);if(null!=t&&t>n&&t<this.to){n=t,e=this.maps[t].recover(r.recover);continue}}i|=r.delInfo,e=r.pos}return n?e:new en(e,i,null)}}const rn=Object.create(null);class sn{getMap(){return tn.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=rn[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in rn)throw new RangeError("Duplicate use of step JSON ID "+e);return rn[e]=t,t.prototype.jsonID=e,t}}class on{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new on(e,null)}static fail(e){return new on(null,e)}static fromReplace(e,t,n,i){try{return on.ok(e.replace(t,n,i))}catch(e){if(e instanceof et)return on.fail(e.message);throw e}}}function an(e,t,n){let i=[];for(let r=0;r<e.childCount;r++){let s=e.child(r);s.content.size&&(s=s.copy(an(s.content,t,s))),s.isInline&&(s=t(s,n,r)),i.push(s)}return Ye.fromArray(i)}class ln extends sn{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),r=new tt(an(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),i),t.openStart,t.openEnd);return on.fromReplace(e,this.from,this.to,r)}invert(){return new cn(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new ln(t.pos,n.pos,this.mark)}merge(e){return e instanceof ln&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ln(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ln(t.from,t.to,e.markFromJSON(t.mark))}}sn.jsonID("addMark",ln);class cn extends sn{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new tt(an(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return on.fromReplace(e,this.from,this.to,n)}invert(){return new ln(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new cn(t.pos,n.pos,this.mark)}merge(e){return e instanceof cn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new cn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new cn(t.from,t.to,e.markFromJSON(t.mark))}}sn.jsonID("removeMark",cn);class dn extends sn{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return on.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return on.fromReplace(e,this.pos,this.pos+1,new tt(Ye.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new dn(this.pos,t.marks[n]);return new dn(this.pos,this.mark)}}return new hn(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new dn(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new dn(t.pos,e.markFromJSON(t.mark))}}sn.jsonID("addNodeMark",dn);class hn extends sn{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return on.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return on.fromReplace(e,this.pos,this.pos+1,new tt(Ye.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new dn(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new hn(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new hn(t.pos,e.markFromJSON(t.mark))}}sn.jsonID("removeNodeMark",hn);class pn extends sn{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&fn(e,this.from,this.to)?on.fail("Structure replace would overwrite content"):on.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new tn([this.from,this.to-this.from,this.slice.size])}invert(e){return new pn(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new pn(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof pn)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?tt.empty:new tt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new pn(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?tt.empty:new tt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new pn(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new pn(t.from,t.to,tt.fromJSON(e,t.slice),!!t.structure)}}sn.jsonID("replace",pn);class un extends sn{constructor(e,t,n,i,r,s,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=r,this.insert=s,this.structure=o}apply(e){if(this.structure&&(fn(e,this.from,this.gapFrom)||fn(e,this.gapTo,this.to)))return on.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return on.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?on.fromReplace(e,this.from,this.to,n):on.fail("Content does not fit in gap")}getMap(){return new tn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new un(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),r=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||r>n.pos?null:new un(t.pos,n.pos,i,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new un(t.from,t.to,t.gapFrom,t.gapTo,tt.fromJSON(e,t.slice),t.insert,!!t.structure)}}function fn(e,t,n){let i=e.resolve(t),r=n-t,s=i.depth;for(;r>0&&s>0&&i.indexAfter(s)==i.node(s).childCount;)s--,r--;if(r>0){let e=i.node(s).maybeChild(i.indexAfter(s));for(;r>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,r--}}return!1}function mn(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function gn(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth;;--n){let i=e.$from.node(n),r=e.$from.index(n),s=e.$to.indexAfter(n);if(n<e.depth&&i.canReplace(r,s,t))return n;if(0==n||i.type.spec.isolating||!mn(i,r,s))break}return null}function yn(e,t,n=null,i=e){let r=function(e,t){let{parent:n,startIndex:i,endIndex:r}=e,s=n.contentMatchAt(i).findWrapping(t);if(!s)return null;let o=s.length?s[0]:t;return n.canReplaceWith(i,r,o)?s:null}(e,t),s=r&&function(e,t){let{parent:n,startIndex:i,endIndex:r}=e,s=n.child(i),o=t.contentMatch.findWrapping(s.type);if(!o)return null;let a=(o.length?o[o.length-1]:t).contentMatch;for(let e=i;a&&e<r;e++)a=a.matchType(n.child(e).type);return a&&a.validEnd?o:null}(i,t);return s?r.map(wn).concat({type:t,attrs:n}).concat(s.map(wn)):null}function wn(e){return{type:e,attrs:null}}function vn(e,t,n=1,i){let r=e.resolve(t),s=r.depth-n,o=i&&i[i.length-1]||r.parent;if(s<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let e=r.depth-1,t=n-2;e>s;e--,t--){let n=r.node(e),s=r.index(e);if(n.type.spec.isolating)return!1;let o=n.content.cutByIndex(s,n.childCount),a=i&&i[t]||n;if(a!=n&&(o=o.replaceChild(0,a.type.create(a.attrs))),!n.canReplace(s+1,n.childCount)||!a.type.validContent(o))return!1}let a=r.indexAfter(s),l=i&&i[0];return r.node(s).canReplaceWith(a,a,l?l.type:r.node(s+1).type)}function bn(e,t){let n=e.resolve(t),i=n.index();return kn(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(i,i+1)}function kn(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function xn(e,t,n){let i=e.resolve(t);if(!n.content.size)return t;let r=n.content;for(let e=0;e<n.openStart;e++)r=r.firstChild.content;for(let e=1;e<=(0==n.openStart&&n.size?2:1);e++)for(let t=i.depth;t>=0;t--){let n=t==i.depth?0:i.pos<=(i.start(t+1)+i.end(t+1))/2?-1:1,s=i.index(t)+(n>0?1:0),o=i.node(t),a=!1;if(1==e)a=o.canReplace(s,s,r);else{let e=o.contentMatchAt(s).findWrapping(r.firstChild.type);a=e&&o.canReplaceWith(s,s,e[0])}if(a)return 0==n?i.pos:n<0?i.before(t+1):i.after(t+1)}return null}function Sn(e,t,n=t,i=tt.empty){if(t==n&&!i.size)return null;let r=e.resolve(t),s=e.resolve(n);return Mn(r,s,i)?new pn(t,n,i):new On(r,s,i).fit()}function Mn(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}sn.jsonID("replaceAround",un);class On{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=Ye.empty;for(let t=0;t<=e.depth;t++){let n=e.node(t);this.frontier.push({type:n.type,match:n.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=Ye.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let r=this.placed,s=n.depth,o=i.depth;for(;s&&o&&1==r.childCount;)r=r.firstChild.content,s--,o--;let a=new tt(r,s,o);return e>-1?new un(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new pn(n.pos,i.pos,a):null}findFittable(){for(let e=1;e<=2;e++)for(let t=this.unplaced.openStart;t>=0;t--){let n,i=null;t?(i=Tn(this.unplaced.content,t-1).firstChild,n=i.content):n=this.unplaced.content;let r=n.firstChild;for(let n=this.depth;n>=0;n--){let s,{type:o,match:a}=this.frontier[n],l=null;if(1==e&&(r?a.matchType(r.type)||(l=a.fillBefore(Ye.from(r),!1)):i&&o.compatibleContent(i.type)))return{sliceDepth:t,frontierDepth:n,parent:i,inject:l};if(2==e&&r&&(s=a.findWrapping(r.type)))return{sliceDepth:t,frontierDepth:n,parent:i,wrap:s};if(i&&a.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=Tn(e,t);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new tt(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=Tn(e,t);if(i.childCount<=1&&t>0){let r=e.size-t<=t+i.size;this.unplaced=new tt(Cn(e,t-1,1),t-1,r?t-1:n)}else this.unplaced=new tt(Cn(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:r}){for(;this.depth>t;)this.closeFrontierNode();if(r)for(let e=0;e<r.length;e++)this.openFrontierNode(r[e]);let s=this.unplaced,o=n?n.content:s.content,a=s.openStart-e,l=0,c=[],{match:d,type:h}=this.frontier[t];if(i){for(let e=0;e<i.childCount;e++)c.push(i.child(e));d=d.matchFragment(i)}let p=o.size+e-(s.content.size-s.openEnd);for(;l<o.childCount;){let e=o.child(l),t=d.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(d=t,c.push(Nn(e.mark(h.allowedMarks(e.marks)),1==l?a:0,l==o.childCount?p:-1)))}let u=l==o.childCount;u||(p=-1),this.placed=Dn(this.placed,t,Ye.from(c)),this.frontier[t].match=d,u&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=o;e<p;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=u?0==e?tt.empty:new tt(Cn(s.content,e-1,1),e-1,p<0?s.openEnd:e-1):new tt(Cn(s.content,e,l),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!En(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],r=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),s=En(e,t,i,n,r);if(s){for(let n=t-1;n>=0;n--){let{match:t,type:i}=this.frontier[n],r=En(e,n,i,t,!0);if(!r||r.childCount)continue e}return{depth:t,fit:s,move:r?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Dn(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),i=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,i)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Dn(this.placed,this.depth,Ye.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Ye.empty,!0);e.childCount&&(this.placed=Dn(this.placed,this.frontier.length,e))}}function Cn(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(Cn(e.firstChild.content,t-1,n)))}function Dn(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Dn(e.lastChild.content,t-1,n)))}function Tn(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Nn(e,t,n){if(t<=0)return e;let i=e.content;return t>1&&(i=i.replaceChild(0,Nn(i.firstChild,t-1,1==i.childCount?n-1:0))),t>0&&(i=e.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(Ye.empty,!0)))),e.copy(i)}function En(e,t,n,i,r){let s=e.node(t),o=r?e.indexAfter(t):e.index(t);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=i.fillBefore(s.content,!0,o);return a&&!function(e,t,n){for(let i=n;i<t.childCount;i++)if(!e.allowsMarks(t.child(i).marks))return!0;return!1}(n,s.content,o)?a:null}function An(e){return e.spec.defining||e.spec.definingForContent}function In(e,t,n,i,r){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(In(r.content,t+1,n,i,r)))}if(t>i){let t=r.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(Ye.empty,!0))}return e}function Rn(e,t){let n=[];for(let i=Math.min(e.depth,t.depth);i>=0;i--){let r=e.start(i);if(r<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&n.push(i)}return n}class Bn extends sn{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return on.fail("No node at attribute step's position");let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return on.fromReplace(e,this.pos,this.pos+1,new tt(Ye.from(i),0,t.isLeaf?0:1))}getMap(){return tn.empty}invert(e){return new Bn(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Bn(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Bn(t.pos,t.attr,t.value)}}sn.jsonID("attr",Bn);let Pn=class extends Error{};Pn=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(Pn.prototype=Object.create(Error.prototype)).constructor=Pn,Pn.prototype.name="TransformError";class $n{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new nn}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Pn(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=tt.empty){let i=Sn(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new tt(Ye.from(n),0,0))}delete(e,t){return this.replace(e,t,tt.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,i){if(!i.size)return e.deleteRange(t,n);let r=e.doc.resolve(t),s=e.doc.resolve(n);if(Mn(r,s,i))return e.step(new pn(t,n,i));let o=Rn(r,e.doc.resolve(n));0==o[o.length-1]&&o.pop();let a=-(r.depth+1);o.unshift(a);for(let e=r.depth,t=r.pos-1;e>0;e--,t--){let n=r.node(e).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;o.indexOf(e)>-1?a=e:r.before(e)==t&&o.splice(1,0,-e)}let l=o.indexOf(a),c=[],d=i.openStart;for(let e=i.content,t=0;;t++){let n=e.firstChild;if(c.push(n),t==i.openStart)break;e=n.content}for(let e=d-1;e>=0;e--){let t=c[e].type,n=An(t);if(n&&r.node(l).type!=t)d=e;else if(n||!t.isTextblock)break}for(let t=i.openStart;t>=0;t--){let a=(t+d+1)%(i.openStart+1),h=c[a];if(h)for(let t=0;t<o.length;t++){let c=o[(t+l)%o.length],d=!0;c<0&&(d=!1,c=-c);let p=r.node(c-1),u=r.index(c-1);if(p.canReplaceWith(u,u,h.type,h.marks))return e.replace(r.before(c),d?s.after(c):n,new tt(In(i.content,0,i.openStart,a),a,i.openEnd))}}let h=e.steps.length;for(let a=o.length-1;a>=0&&(e.replace(t,n,i),!(e.steps.length>h));a--){let e=o[a];e<0||(t=r.before(e),n=s.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,i){if(!i.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=function(e,t,n){let i=e.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),n))return t;if(0==i.parentOffset)for(let e=i.depth-1;e>=0;e--){let t=i.index(e);if(i.node(e).canReplaceWith(t,t,n))return i.before(e+1);if(t>0)return null}if(i.parentOffset==i.parent.content.size)for(let e=i.depth-1;e>=0;e--){let t=i.indexAfter(e);if(i.node(e).canReplaceWith(t,t,n))return i.after(e+1);if(t<i.node(e).childCount)return null}return null}(e.doc,t,i.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new tt(Ye.from(i),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let i=e.doc.resolve(t),r=e.doc.resolve(n),s=Rn(i,r);for(let t=0;t<s.length;t++){let n=s[t],o=t==s.length-1;if(o&&0==n||i.node(n).type.contentMatch.validEnd)return e.delete(i.start(n),r.end(n));if(n>0&&(o||i.node(n-1).canReplace(i.index(n-1),r.indexAfter(n-1))))return e.delete(i.before(n),r.after(n))}for(let s=1;s<=i.depth&&s<=r.depth;s++)if(t-i.start(s)==i.depth-s&&n>i.end(s)&&r.end(s)-n!=r.depth-s)return e.delete(i.before(s),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:i,$to:r,depth:s}=t,o=i.before(s+1),a=r.after(s+1),l=o,c=a,d=Ye.empty,h=0;for(let e=s,t=!1;e>n;e--)t||i.index(e)>0?(t=!0,d=Ye.from(i.node(e).copy(d)),h++):l--;let p=Ye.empty,u=0;for(let e=s,t=!1;e>n;e--)t||r.after(e+1)<r.end(e)?(t=!0,p=Ye.from(r.node(e).copy(p)),u++):c++;e.step(new un(l,c,o,a,new tt(d.append(p),h,u),d.size-h,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let i=new pn(t-n,t+n,tt.empty,!0);e.step(i)}(this,e,t),this}wrap(e,t){return function(e,t,n){let i=Ye.empty;for(let e=n.length-1;e>=0;e--){if(i.size){let t=n[e].type.contentMatch.matchFragment(i);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=Ye.from(n[e].type.create(n[e].attrs,i))}let r=t.start,s=t.end;e.step(new un(r,s,r,s,new tt(i,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,i=null){return function(e,t,n,i,r){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=e.steps.length;e.doc.nodesBetween(t,n,((t,n)=>{if(t.isTextblock&&!t.hasMarkup(i,r)&&function(e,t,n){let i=e.resolve(t),r=i.index();return i.parent.canReplaceWith(r,r+1,n)}(e.doc,e.mapping.slice(s).map(n),i)){e.clearIncompatible(e.mapping.slice(s).map(n,1),i);let o=e.mapping.slice(s),a=o.map(n,1),l=o.map(n+t.nodeSize,1);return e.step(new un(a,l,a+1,l-1,new tt(Ye.from(i.create(r,null,t.marks)),0,0),1,!0)),!1}}))}(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i=[]){return function(e,t,n,i,r){let s=e.doc.nodeAt(t);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(i,null,r||s.marks);if(s.isLeaf)return e.replaceWith(t,t+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new un(t,t+s.nodeSize,t+1,t+s.nodeSize-1,new tt(Ye.from(o),0,0),1,!0))}(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Bn(e,t,n)),this}addNodeMark(e,t){return this.step(new dn(e,t)),this}removeNodeMark(e,t){if(!(t instanceof Qe)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(n.marks)))return this}return this.step(new hn(e,t)),this}split(e,t=1,n){return function(e,t,n=1,i){let r=e.doc.resolve(t),s=Ye.empty,o=Ye.empty;for(let e=r.depth,t=r.depth-n,a=n-1;e>t;e--,a--){s=Ye.from(r.node(e).copy(s));let t=i&&i[a];o=Ye.from(t?t.type.create(t.attrs,o):r.node(e).copy(o))}e.step(new pn(t,t,new tt(s.append(o),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,i){let r,s,o=[],a=[];e.doc.nodesBetween(t,n,((e,l,c)=>{if(!e.isInline)return;let d=e.marks;if(!i.isInSet(d)&&c.type.allowsMarkType(i.type)){let c=Math.max(l,t),h=Math.min(l+e.nodeSize,n),p=i.addToSet(d);for(let e=0;e<d.length;e++)d[e].isInSet(p)||(r&&r.to==c&&r.mark.eq(d[e])?r.to=h:o.push(r=new cn(c,h,d[e])));s&&s.to==c?s.to=h:a.push(s=new ln(c,h,i))}})),o.forEach((t=>e.step(t))),a.forEach((t=>e.step(t)))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,i){let r=[],s=0;e.doc.nodesBetween(t,n,((e,o)=>{if(!e.isInline)return;s++;let a=null;if(i instanceof $t){let t,n=e.marks;for(;t=i.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else i?i.isInSet(e.marks)&&(a=[i]):a=e.marks;if(a&&a.length){let i=Math.min(o+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<r.length;e++){let t=r[e];t.step==s-1&&l.eq(r[e].style)&&(n=t)}n?(n.to=i,n.step=s):r.push({style:l,from:Math.max(o,t),to:i,step:s})}}})),r.forEach((t=>e.step(new cn(t.from,t.to,t.style))))}(this,e,t,n),this}clearIncompatible(e,t,n){return function(e,t,n,i=n.contentMatch){let r=e.doc.nodeAt(t),s=[],o=t+1;for(let t=0;t<r.childCount;t++){let a=r.child(t),l=o+a.nodeSize,c=i.matchType(a.type);if(c){i=c;for(let t=0;t<a.marks.length;t++)n.allowsMarkType(a.marks[t].type)||e.step(new cn(o,l,a.marks[t]))}else s.push(new pn(o,l,tt.empty));o=l}if(!i.validEnd){let t=i.fillBefore(Ye.empty,!0);e.replace(o,o,new tt(t,0,0))}for(let t=s.length-1;t>=0;t--)e.step(s[t])}(this,e,t,n),this}}const Ln=Object.create(null);class Vn{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new zn(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=tt.empty){let n=t.content.lastChild,i=null;for(let e=0;e<t.openEnd;e++)i=n,n=n.lastChild;let r=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:a,$to:l}=s[o],c=e.mapping.slice(r);e.replaceRange(c.map(a.pos),c.map(l.pos),o?tt.empty:t),0==o&&Yn(e,r,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:s,$to:o}=i[r],a=e.mapping.slice(n),l=a.map(s.pos),c=a.map(o.pos);r?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),Yn(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new jn(e):Un(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let i=e.depth-1;i>=0;i--){let r=t<0?Un(e.node(0),e.node(i),e.before(i+1),e.index(i),t,n):Un(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,n);if(r)return r}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Kn(e.node(0))}static atStart(e){return Un(e,e,0,0,1)||new Kn(e)}static atEnd(e){return Un(e,e,e.content.size,e.childCount,-1)||new Kn(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Ln[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Ln)throw new RangeError("Duplicate use of selection JSON ID "+e);return Ln[e]=t,t.prototype.jsonID=e,t}getBookmark(){return jn.between(this.$anchor,this.$head).getBookmark()}}Vn.prototype.visible=!0;class zn{constructor(e,t){this.$from=e,this.$to=t}}let Fn=!1;function Hn(e){Fn||e.parent.inlineContent||(Fn=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class jn extends Vn{constructor(e,t=e){Hn(e),Hn(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return Vn.near(n);let i=e.resolve(t.map(this.anchor));return new jn(i.parent.inlineContent?i:n,n)}replace(e,t=tt.empty){if(super.replace(e,t),t==tt.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof jn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Wn(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new jn(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if(n&&!i||(n=i>=0?1:-1),!t.parent.inlineContent){let e=Vn.findFrom(t,n,!0)||Vn.findFrom(t,-n,!0);if(!e)return Vn.near(t,n);t=e.$head}return e.parent.inlineContent||(0==i||(e=(Vn.findFrom(e,-n,!0)||Vn.findFrom(e,n,!0)).$anchor).pos<t.pos!=i<0)&&(e=t),new jn(e,t)}}Vn.jsonID("text",jn);class Wn{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Wn(e.map(this.anchor),e.map(this.head))}resolve(e){return jn.between(e.resolve(this.anchor),e.resolve(this.head))}}class qn extends Vn{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),r=e.resolve(i);return n?Vn.near(r):new qn(r)}content(){return new tt(Ye.from(this.node),0,0)}eq(e){return e instanceof qn&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Jn(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new qn(e.resolve(t.anchor))}static create(e,t){return new qn(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}qn.prototype.visible=!1,Vn.jsonID("node",qn);class Jn{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new Wn(n,n):new Jn(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&qn.isSelectable(n)?new qn(t):Vn.near(t)}}class Kn extends Vn{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=tt.empty){if(t==tt.empty){e.delete(0,e.doc.content.size);let t=Vn.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Kn(e)}map(e){return new Kn(e)}eq(e){return e instanceof Kn}getBookmark(){return _n}}Vn.jsonID("all",Kn);const _n={map(){return this},resolve:e=>new Kn(e)};function Un(e,t,n,i,r,s=!1){if(t.inlineContent)return jn.create(e,n);for(let o=i-(r>0?0:1);r>0?o<t.childCount:o>=0;o+=r){let i=t.child(o);if(i.isAtom){if(!s&&qn.isSelectable(i))return qn.create(e,n-(r<0?i.nodeSize:0))}else{let t=Un(e,i,n+r,r<0?i.childCount:0,r,s);if(t)return t}n+=i.nodeSize*r}return null}function Yn(e,t,n){let i=e.steps.length-1;if(i<t)return;let r,s=e.steps[i];(s instanceof pn||s instanceof un)&&(e.mapping.maps[i].forEach(((e,t,n,i)=>{null==r&&(r=i)})),e.setSelection(Vn.near(e.doc.resolve(r),n)))}class Gn extends $n{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return Qe.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Qe.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let i=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let r=this.storedMarks;if(!r){let e=this.doc.resolve(t);r=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,i.text(e,r)),this.selection.empty||this.setSelection(Vn.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function Xn(e,t){return t&&e?e.bind(t):e}class Zn{constructor(e,t,n){this.name=e,this.init=Xn(t.init,n),this.apply=Xn(t.apply,n)}}const Qn=[new Zn("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new Zn("selection",{init:(e,t)=>e.selection||Vn.atStart(t.doc),apply:e=>e.selection}),new Zn("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,i)=>i.selection.$cursor?e.storedMarks:null}),new Zn("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class ei{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Qn.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new Zn(e.key,e.spec.state,e))}))}}class ti{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),i=null;for(;;){let r=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let a=i?i[s].n:0,l=i?i[s].state:this,c=a<t.length&&o.spec.appendTransaction.call(o,a?t.slice(a):t,l,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let e=0;e<this.config.plugins.length;e++)i.push(e<s?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),r=!0}i&&(i[s]={state:n,n:t.length})}}if(!r)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new ti(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let r=n[i];t[r.name]=r.apply(e,this[r.name],this,t)}return t}get tr(){return new Gn(this)}static create(e){let t=new ei(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new ti(t);for(let i=0;i<t.fields.length;i++)n[t.fields[i].name]=t.fields[i].init(e,n);return n}reconfigure(e){let t=new ei(this.schema,e.plugins),n=t.fields,i=new ti(t);for(let t=0;t<n.length;t++){let r=n[t].name;i[r]=this.hasOwnProperty(r)?this[r]:n[t].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],r=i.spec.state;r&&r.toJSON&&(t[n]=r.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new ei(e.schema,e.plugins),r=new ti(i);return i.fields.forEach((i=>{if("doc"==i.name)r.doc=vt.fromJSON(e.schema,t.doc);else if("selection"==i.name)r.selection=Vn.fromJSON(r.doc,t.selection);else if("storedMarks"==i.name)t.storedMarks&&(r.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let s in n){let o=n[s],a=o.spec.state;if(o.key==i.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,s))return void(r[i.name]=a.fromJSON.call(o,e,t[s],r))}r[i.name]=i.init(e,r)}})),r}}function ni(e,t,n){for(let i in e){let r=e[i];r instanceof Function?r=r.bind(t):"handleDOMEvents"==i&&(r=ni(r,t,{})),n[i]=r}return n}class ii{constructor(e){this.spec=e,this.props={},e.props&&ni(e.props,this,this.props),this.key=e.key?e.key.key:si("plugin")}getState(e){return e[this.key]}}const ri=Object.create(null);function si(e){return e in ri?e+"$"+ ++ri[e]:(ri[e]=0,e+"$")}class oi{constructor(e="key"){this.key=si(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const ai=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},li=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let ci=null;const di=function(e,t,n){let i=ci||(ci=document.createRange());return i.setEnd(e,null==n?e.nodeValue.length:n),i.setStart(e,t||0),i},hi=function(e,t,n,i){return n&&(ui(e,t,n,i,-1)||ui(e,t,n,i,1))},pi=/^(img|br|input|textarea|hr)$/i;function ui(e,t,n,i,r){for(;;){if(e==n&&t==i)return!0;if(t==(r<0?0:fi(e))){let n=e.parentNode;if(!n||1!=n.nodeType||mi(e)||pi.test(e.nodeName)||"false"==e.contentEditable)return!1;t=ai(e)+(r<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(r<0?-1:0)]).contentEditable)return!1;t=r<0?fi(e):0}}}function fi(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function mi(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const gi=function(e){return e.focusNode&&hi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function yi(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const wi="undefined"!=typeof navigator?navigator:null,vi="undefined"!=typeof document?document:null,bi=wi&&wi.userAgent||"",ki=/Edge\/(\d+)/.exec(bi),xi=/MSIE \d/.exec(bi),Si=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(bi),Mi=!!(xi||Si||ki),Oi=xi?document.documentMode:Si?+Si[1]:ki?+ki[1]:0,Ci=!Mi&&/gecko\/(\d+)/i.test(bi);Ci&&(/Firefox\/(\d+)/.exec(bi)||[0,0])[1];const Di=!Mi&&/Chrome\/(\d+)/.exec(bi),Ti=!!Di,Ni=Di?+Di[1]:0,Ei=!Mi&&!!wi&&/Apple Computer/.test(wi.vendor),Ai=Ei&&(/Mobile\/\w+/.test(bi)||!!wi&&wi.maxTouchPoints>2),Ii=Ai||!!wi&&/Mac/.test(wi.platform),Ri=/Android \d/.test(bi),Bi=!!vi&&"webkitFontSmoothing"in vi.documentElement.style,Pi=Bi?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function $i(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function Li(e,t){return"number"==typeof e?e:e[t]}function Vi(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,i=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*i}}function zi(e,t,n){let i=e.someProp("scrollThreshold")||0,r=e.someProp("scrollMargin")||5,s=e.dom.ownerDocument;for(let o=n||e.dom;o;o=li(o)){if(1!=o.nodeType)continue;let e=o,n=e==s.body,a=n?$i(s):Vi(e),l=0,c=0;if(t.top<a.top+Li(i,"top")?c=-(a.top-t.top+Li(r,"top")):t.bottom>a.bottom-Li(i,"bottom")&&(c=t.bottom-a.bottom+Li(r,"bottom")),t.left<a.left+Li(i,"left")?l=-(a.left-t.left+Li(r,"left")):t.right>a.right-Li(i,"right")&&(l=t.right-a.right+Li(r,"right")),l||c)if(n)s.defaultView.scrollBy(l,c);else{let n=e.scrollLeft,i=e.scrollTop;c&&(e.scrollTop+=c),l&&(e.scrollLeft+=l);let r=e.scrollLeft-n,s=e.scrollTop-i;t={left:t.left-r,top:t.top-s,right:t.right-r,bottom:t.bottom-s}}if(n)break}}function Fi(e){let t=[],n=e.ownerDocument;for(let i=e;i&&(t.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),e!=n);i=li(i));return t}function Hi(e,t){for(let n=0;n<e.length;n++){let{dom:i,top:r,left:s}=e[n];i.scrollTop!=r+t&&(i.scrollTop=r+t),i.scrollLeft!=s&&(i.scrollLeft=s)}}let ji=null;function Wi(e,t){let n,i,r=2e8,s=0,o=t.top,a=t.top;for(let l=e.firstChild,c=0;l;l=l.nextSibling,c++){let e;if(1==l.nodeType)e=l.getClientRects();else{if(3!=l.nodeType)continue;e=di(l).getClientRects()}for(let d=0;d<e.length;d++){let h=e[d];if(h.top<=o&&h.bottom>=a){o=Math.max(h.bottom,o),a=Math.min(h.top,a);let e=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(e<r){n=l,r=e,i=e&&3==n.nodeType?{left:h.right<t.left?h.right:h.left,top:t.top}:t,1==l.nodeType&&e&&(s=c+(t.left>=(h.left+h.right)/2?1:0));continue}}!n&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)&&(s=c+1)}}return n&&3==n.nodeType?function(e,t){let n=e.nodeValue.length,i=document.createRange();for(let r=0;r<n;r++){i.setEnd(e,r+1),i.setStart(e,r);let n=_i(i,1);if(n.top!=n.bottom&&qi(t,n))return{node:e,offset:r+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}(n,i):!n||r&&1==n.nodeType?{node:e,offset:s}:Wi(n,i)}function qi(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function Ji(e,t,n){let i=e.childNodes.length;if(i&&n.top<n.bottom)for(let r=Math.max(0,Math.min(i-1,Math.floor(i*(t.top-n.top)/(n.bottom-n.top))-2)),s=r;;){let n=e.childNodes[s];if(1==n.nodeType){let e=n.getClientRects();for(let i=0;i<e.length;i++){let r=e[i];if(qi(t,r))return Ji(n,t,r)}}if((s=(s+1)%i)==r)break}return e}function Ki(e,t){let n,i=e.dom.ownerDocument,r=0;if(i.caretPositionFromPoint)try{let e=i.caretPositionFromPoint(t.left,t.top);e&&({offsetNode:n,offset:r}=e)}catch(e){}if(!n&&i.caretRangeFromPoint){let e=i.caretRangeFromPoint(t.left,t.top);e&&({startContainer:n,startOffset:r}=e)}let s,o=(e.root.elementFromPoint?e.root:i).elementFromPoint(t.left,t.top);if(!o||!e.dom.contains(1!=o.nodeType?o.parentNode:o)){let n=e.dom.getBoundingClientRect();if(!qi(t,n))return null;if(o=Ji(e.dom,t,n),!o)return null}if(Ei)for(let e=o;n&&e;e=li(e))e.draggable&&(n=void 0);if(o=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(o,t),n){if(Ci&&1==n.nodeType&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let e,i=n.childNodes[r];"IMG"==i.nodeName&&(e=i.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&r++}n==e.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?s=e.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(s=function(e,t,n,i){let r=-1;for(let n=t;n!=e.dom;){let t=e.docView.nearestDesc(n,!0);if(!t)return null;if(t.node.isBlock&&t.parent){let e=t.dom.getBoundingClientRect();if(e.left>i.left||e.top>i.top)r=t.posBefore;else{if(!(e.right<i.left||e.bottom<i.top))break;r=t.posAfter}}n=t.dom.parentNode}return r>-1?r:e.docView.posFromDOM(t,n,1)}(e,n,r,t))}null==s&&(s=function(e,t,n){let{node:i,offset:r}=Wi(t,n),s=-1;if(1==i.nodeType&&!i.firstChild){let e=i.getBoundingClientRect();s=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(i,r,s)}(e,o,t));let a=e.docView.nearestDesc(o,!0);return{pos:s,inside:a?a.posAtStart-a.border:-1}}function _i(e,t){let n=e.getClientRects();return n.length?n[t<0?0:n.length-1]:e.getBoundingClientRect()}const Ui=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Yi(e,t,n){let{node:i,offset:r,atom:s}=e.docView.domFromPos(t,n<0?-1:1),o=Bi||Ci;if(3==i.nodeType){if(!o||!Ui.test(i.nodeValue)&&(n<0?r:r!=i.nodeValue.length)){let e=r,t=r,s=n<0?1:-1;return n<0&&!r?(t++,s=-1):n>=0&&r==i.nodeValue.length?(e--,s=1):n<0?e--:t++,Gi(_i(di(i,e,t),1),s<0)}{let e=_i(di(i,r,r),n);if(Ci&&r&&/\s/.test(i.nodeValue[r-1])&&r<i.nodeValue.length){let t=_i(di(i,r-1,r-1),-1);if(t.top==e.top){let n=_i(di(i,r,r+1),-1);if(n.top!=e.top)return Gi(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(s||0)).parent.inlineContent){if(null==s&&r&&(n<0||r==fi(i))){let e=i.childNodes[r-1];if(1==e.nodeType)return Xi(e.getBoundingClientRect(),!1)}if(null==s&&r<fi(i)){let e=i.childNodes[r];if(1==e.nodeType)return Xi(e.getBoundingClientRect(),!0)}return Xi(i.getBoundingClientRect(),n>=0)}if(null==s&&r&&(n<0||r==fi(i))){let e=i.childNodes[r-1],t=3==e.nodeType?di(e,fi(e)-(o?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return Gi(_i(t,1),!1)}if(null==s&&r<fi(i)){let e=i.childNodes[r];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?di(e,0,o?0:1):1==e.nodeType?e:null:null;if(t)return Gi(_i(t,-1),!0)}return Gi(_i(3==i.nodeType?di(i):i,-n),n>=0)}function Gi(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function Xi(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function Zi(e,t,n){let i=e.state,r=e.root.activeElement;i!=t&&e.updateState(t),r!=e.dom&&e.focus();try{return n()}finally{i!=t&&e.updateState(i),r!=e.dom&&r&&r.focus()}}const Qi=/[\u0590-\u08ac]/;let er=null,tr=null,nr=!1;function ir(e,t,n){return er==t&&tr==n?nr:(er=t,tr=n,nr="up"==n||"down"==n?function(e,t,n){let i=t.selection,r="up"==n?i.$from:i.$to;return Zi(e,t,(()=>{let{node:t}=e.docView.domFromPos(r.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.dom;break}t=n.dom.parentNode}let i=Yi(e,r.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=di(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let r=t[e];if(r.bottom>r.top+1&&("up"==n?i.top-r.top>2*(r.bottom-i.top):r.bottom-i.bottom>2*(i.bottom-r.top)))return!1}}return!0}))}(e,t,n):function(e,t,n){let{$head:i}=t.selection;if(!i.parent.isTextblock)return!1;let r=i.parentOffset,s=!r,o=r==i.parent.content.size,a=e.domSelection();return Qi.test(i.parent.textContent)&&a.modify?Zi(e,t,(()=>{let{focusNode:t,focusOffset:r,anchorNode:s,anchorOffset:o}=e.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=i.depth?e.docView.domAfterPos(i.before()):e.dom,{focusNode:d,focusOffset:h}=e.domSelectionRange(),p=d&&!c.contains(1==d.nodeType?d:d.parentNode)||t==d&&r==h;try{a.collapse(s,o),t&&(t!=s||r!=o)&&a.extend&&a.extend(t,r)}catch(e){}return null!=l&&(a.caretBidiLevel=l),p})):"left"==n||"backward"==n?s:o}(e,t,n))}class rr{constructor(e,t,n,i){this.parent=e,this.children=t,this.dom=n,this.contentDOM=i,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let i=this.children[t];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,i;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(i=n.pmViewDesc)||i.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(i)+i.size:this.posAtStart}{let n,i;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(i=n.pmViewDesc)||i.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(i):this.posAtEnd}}let i;if(e==this.dom&&this.contentDOM)i=t>ai(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){i=!1;break}if(t.previousSibling)break}if(null==i&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){i=!0;break}if(t.nextSibling)break}}return(null==i?n>0:i)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,i=e;i;i=i.parentNode){let r,s=this.getDesc(i);if(s&&(!t||s.node)){if(!n||!(r=s.nodeDOM)||(1==r.nodeType?r.contains(1==e.nodeType?e:e.parentNode):r==e))return s;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let e=t;e;e=e.parent)if(e==this)return t}posFromDOM(e,t,n){for(let i=e;i;i=i.parentNode){let r=this.getDesc(i);if(r)return r.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let i=this.children[t],r=n+i.size;if(n==e&&r!=n){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<r)return i.descAt(e-n-i.border);n=r}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n,i=0,r=0;for(let t=0;i<this.children.length;i++){let n=this.children[i],s=t+n.size;if(s>e||n instanceof hr){r=e-t;break}t=s}if(r)return this.children[i].domFromPos(r-this.children[i].border,t);for(;i&&!(n=this.children[i-1]).size&&n instanceof sr&&n.side>=0;i--);if(t<=0){let e,n=!0;for(;e=i?this.children[i-1]:null,e&&e.dom.parentNode!=this.contentDOM;i--,n=!1);return e&&t&&n&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?ai(e.dom)+1:0}}{let e,n=!0;for(;e=i<this.children.length?this.children[i]:null,e&&e.dom.parentNode!=this.contentDOM;i++,n=!1);return e&&n&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?ai(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,r=-1;for(let s=n,o=0;;o++){let n=this.children[o],a=s+n.size;if(-1==i&&e<=a){let r=s+n.border;if(e>=r&&t<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,r);e=s;for(let t=o;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){i=ai(n.dom)+1;break}e-=n.size}-1==i&&(i=0)}if(i>-1&&(a>t||o==this.children.length-1)){t=a;for(let e=o+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){r=ai(n.dom);break}t+=n.size}-1==r&&(r=this.contentDOM.childNodes.length);break}s=a}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,i=!1){let r=Math.min(e,t),s=Math.max(e,t);for(let o=0,a=0;o<this.children.length;o++){let l=this.children[o],c=a+l.size;if(r>a&&s<c)return l.setSelection(e-a-l.border,t-a-l.border,n,i);a=c}let o=this.domFromPos(e,e?-1:1),a=t==e?o:this.domFromPos(t,t?-1:1),l=n.getSelection(),c=!1;if((Ci||Ei)&&e==t){let{node:e,offset:t}=o;if(3==e.nodeType){if(c=!(!t||"\n"!=e.nodeValue[t-1]),c&&t==e.nodeValue.length)for(let t,n=e;n;n=n.parentNode){if(t=n.nextSibling){"BR"==t.nodeName&&(o=a={node:t.parentNode,offset:ai(t)+1});break}let e=n.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];c=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(Ci&&l.focusNode&&l.focusNode!=a.node&&1==l.focusNode.nodeType){let e=l.focusNode.childNodes[l.focusOffset];e&&"false"==e.contentEditable&&(i=!0)}if(!(i||c&&Ei)&&hi(o.node,o.offset,l.anchorNode,l.anchorOffset)&&hi(a.node,a.offset,l.focusNode,l.focusOffset))return;let d=!1;if((l.extend||e==t)&&!c){l.collapse(o.node,o.offset);try{e!=t&&l.extend(a.node,a.offset),d=!0}catch(e){}}if(!d){if(e>t){let e=o;o=a,a=e}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(o.node,o.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,i=0;i<this.children.length;i++){let r=this.children[i],s=n+r.size;if(n==s?e<=s&&t>=n:e<s&&t>n){let i=n+r.border,o=s-r.border;if(e>=i&&t<=o)return this.dirty=e==n||t==s?2:1,void(e!=i||t!=o||!r.contentLost&&r.dom.parentNode==this.contentDOM?r.markDirty(e-i,t-i):r.dirty=3);r.dirty=r.dom!=r.contentDOM||r.dom.parentNode!=this.contentDOM||r.children.length?3:2}n=s}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class sr extends rr{constructor(e,t,n,i){let r,s=t.type.toDOM;if("function"==typeof s&&(s=s(n,(()=>r?r.parent?r.parent.posBeforeChild(r):void 0:i))),!t.type.spec.raw){if(1!=s.nodeType){let e=document.createElement("span");e.appendChild(s),s=e}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=t,this.widget=t,r=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class or extends rr{constructor(e,t,n,i){super(e,[],t,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class ar extends rr{constructor(e,t,n,i){super(e,[],n,i),this.mark=t}static create(e,t,n,i){let r=i.nodeViews[t.type.name],s=r&&r(t,i,n);return s&&s.dom||(s=Yt.renderSpec(document,t.type.spec.toDOM(t,n))),new ar(e,t,s.dom,s.contentDOM||s.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let i=ar.create(this.parent,this.mark,!0,n),r=this.children,s=this.size;t<s&&(r=Mr(r,t,s,n)),e>0&&(r=Mr(r,0,e,n));for(let e=0;e<r.length;e++)r[e].parent=i;return i.children=r,i}}class lr extends rr{constructor(e,t,n,i,r,s,o,a,l){super(e,[],r,s),this.node=t,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=o,s&&this.updateChildren(a,l)}static create(e,t,n,i,r,s){let o,a=r.nodeViews[t.type.name],l=a&&a(t,r,(()=>o?o.parent?o.parent.posBeforeChild(o):void 0:s),n,i),c=l&&l.dom,d=l&&l.contentDOM;if(t.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(t.text);else c||({dom:c,contentDOM:d}=Yt.renderSpec(document,t.type.spec.toDOM(t)));d||t.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let h=c;return c=vr(c,n,t),l?o=new pr(e,t,n,i,c,d||null,h,l,r,s+1):t.isText?new dr(e,t,n,i,c,h,r):new lr(e,t,n,i,c,d||null,h,r,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Ye.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&br(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,i=t,r=e.composing?this.localCompositionInfo(e,t):null,s=r&&r.pos>-1?r:null,o=r&&r.pos<0,a=new xr(this,s&&s.node,e);!function(e,t,n,i){let r=t.locals(e),s=0;if(0==r.length){for(let n=0;n<e.childCount;n++){let o=e.child(n);i(o,r,t.forChild(s,o),n),s+=o.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){if(o<r.length&&r[o].to==s){let e,t=r[o++];for(;o<r.length&&r[o].to==s;)(e||(e=[t])).push(r[o++]);if(e){e.sort(Sr);for(let t=0;t<e.length;t++)n(e[t],c,!!l)}else n(t,c,!!l)}let d,h;if(l)h=-1,d=l,l=null;else{if(!(c<e.childCount))break;h=c,d=e.child(c++)}for(let e=0;e<a.length;e++)a[e].to<=s&&a.splice(e--,1);for(;o<r.length&&r[o].from<=s&&r[o].to>s;)a.push(r[o++]);let p=s+d.nodeSize;if(d.isText){let e=p;o<r.length&&r[o].from<e&&(e=r[o].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<p&&(l=d.cut(e-s),d=d.cut(0,e-s),p=e,h=-1)}i(d,d.isInline&&!d.isLeaf?a.filter((e=>!e.inline)):a.slice(),t.forChild(s,d),h),s=p}}(this.node,this.innerDeco,((t,r,s)=>{t.spec.marks?a.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!s&&a.syncToMarks(r==this.node.childCount?Qe.none:this.node.child(r).marks,n,e),a.placeWidget(t,e,i)}),((t,s,l,c)=>{let d;a.syncToMarks(t.marks,n,e),a.findNodeMatch(t,s,l,c)||o&&e.state.selection.from>i&&e.state.selection.to<i+t.nodeSize&&(d=a.findIndexWithChild(r.node))>-1&&a.updateNodeAt(t,s,l,d,e)||a.updateNextNode(t,s,l,e,c)||a.addNode(t,s,l,e,i),i+=t.nodeSize})),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(s&&this.protectLocalComposition(e,s),ur(this.contentDOM,this.children,e),Ai&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof jn)||n<t||i>t+this.node.content.size)return null;let r=e.domSelectionRange(),s=function(e,t){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0){if(e.childNodes.length>t&&3==e.childNodes[t].nodeType)return e.childNodes[t];t=fi(e=e.childNodes[t-1])}else{if(!(1==e.nodeType&&t<e.childNodes.length))return null;e=e.childNodes[t],t=0}}}(r.focusNode,r.focusOffset);if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let e=s.nodeValue,r=function(e,t,n,i){for(let r=0,s=0;r<e.childCount&&s<=i;){let o=e.child(r++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;r<e.childCount;){let t=e.child(r++);if(s+=t.nodeSize,!t.isText)break;l+=t.text}if(s>=n){let e=a<i?l.lastIndexOf(t,i-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==i&&l.length>=i+t.length-a&&l.slice(i-a,i-a+t.length)==t)return i}}return-1}(this.node.content,e,n-t,i-t);return r<0?null:{node:s,pos:r,text:e}}return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:i}){if(this.getDesc(t))return;let r=t;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let s=new or(this,r,t,i);e.input.compositionNodes.push(s),this.children=Mr(this.children,n,n+i.length,e,s)}update(e,t,n,i){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,i),!0)}updateInner(e,t,n,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(br(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=yr(this.dom,this.nodeDOM,gr(this.outerDeco,this.node,t),gr(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function cr(e,t,n,i,r){return vr(i,t,e),new lr(void 0,e,t,n,i,i,i,r,0)}class dr extends lr{constructor(e,t,n,i,r,s,o){super(e,t,n,i,r,null,s,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,i){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let i=this.node.cut(e,t),r=document.createTextNode(i.text);return new dr(this.parent,i,this.outerDeco,this.innerDeco,r,r,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}}class hr extends rr{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class pr extends lr{constructor(e,t,n,i,r,s,o,a,l,c){super(e,t,n,i,r,s,o,l,c),this.spec=a}update(e,t,n,i){if(3==this.dirty)return!1;if(this.spec.update){let r=this.spec.update(e,t,n);return r&&this.updateInner(e,t,n,i),r}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,i){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function ur(e,t,n){let i=e.firstChild,r=!1;for(let s=0;s<t.length;s++){let o=t[s],a=o.dom;if(a.parentNode==e){for(;a!=i;)i=kr(i),r=!0;i=i.nextSibling}else r=!0,e.insertBefore(a,i);if(o instanceof ar){let t=i?i.previousSibling:e.lastChild;ur(o.contentDOM,o.children,n),i=t?t.nextSibling:e.firstChild}}for(;i;)i=kr(i),r=!0;r&&n.trackWrites==e&&(n.trackWrites=null)}const fr=function(e){e&&(this.nodeName=e)};fr.prototype=Object.create(null);const mr=[new fr];function gr(e,t,n){if(0==e.length)return mr;let i=n?mr[0]:new fr,r=[i];for(let s=0;s<e.length;s++){let o=e[s].type.attrs;if(o){o.nodeName&&r.push(i=new fr(o.nodeName));for(let e in o){let s=o[e];null!=s&&(n&&1==r.length&&r.push(i=new fr(t.isInline?"span":"div")),"class"==e?i.class=(i.class?i.class+" ":"")+s:"style"==e?i.style=(i.style?i.style+";":"")+s:"nodeName"!=e&&(i[e]=s))}}}return r}function yr(e,t,n,i){if(n==mr&&i==mr)return t;let r=t;for(let t=0;t<i.length;t++){let s=i[t],o=n[t];if(t){let t;o&&o.nodeName==s.nodeName&&r!=e&&(t=r.parentNode)&&t.nodeName.toLowerCase()==s.nodeName||(t=document.createElement(s.nodeName),t.pmIsDeco=!0,t.appendChild(r),o=mr[0]),r=t}wr(r,o||mr[0],s)}return r}function wr(e,t,n){for(let i in t)"class"==i||"style"==i||"nodeName"==i||i in n||e.removeAttribute(i);for(let i in n)"class"!=i&&"style"!=i&&"nodeName"!=i&&n[i]!=t[i]&&e.setAttribute(i,n[i]);if(t.class!=n.class){let i=t.class?t.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<i.length;t++)-1==r.indexOf(i[t])&&e.classList.remove(i[t]);for(let t=0;t<r.length;t++)-1==i.indexOf(r[t])&&e.classList.add(r[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=i.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function vr(e,t,n){return yr(e,e,mr,gr(t,n,1!=e.nodeType))}function br(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function kr(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class xr{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,i=n.children.length,r=e.childCount,s=new Map,o=[];e:for(;r>0;){let a;for(;;)if(i){let e=n.children[i-1];if(!(e instanceof ar)){a=e,i--;break}n=e,i=e.children.length}else{if(n==t)break e;i=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=e.child(r-1))break;--r,s.set(a,r),o.push(a)}}return{index:r,matched:s,matches:o.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let i=0,r=this.stack.length>>1,s=Math.min(r,e.length);for(;i<s&&(i==r-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&!1!==e[i].type.spec.spanning;)i++;for(;i<r;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<e.length;){this.stack.push(this.top,this.index+1);let i=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++)if(this.top.children[t].matchesMark(e[r])){i=t;break}if(i>-1)i>this.index&&(this.changed=!0,this.destroyBetween(this.index,i)),this.top=this.top.children[this.index];else{let i=ar.create(this.top,e[r],t,n);this.top.children.splice(this.index,0,i),this.top=i,this.changed=!0}this.index=0,r++}}findNodeMatch(e,t,n,i){let r,s=-1;if(i>=this.preMatch.index&&(r=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&r.matchesNode(e,t,n))s=this.top.children.indexOf(r,this.index);else for(let i=this.index,r=Math.min(this.top.children.length,i+5);i<r;i++){let r=this.top.children[i];if(r.matchesNode(e,t,n)&&!this.preMatch.matched.has(r)){s=i;break}}return!(s<0)&&(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,t,n,i,r){let s=this.top.children[i];return 3==s.dirty&&s.dom==s.contentDOM&&(s.dirty=2),!!s.update(e,t,n,r)&&(this.destroyBetween(this.index,i),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,i,r){for(let s=this.index;s<this.top.children.length;s++){let o=this.top.children[s];if(o instanceof lr){let a=this.preMatch.matched.get(o);if(null!=a&&a!=r)return!1;let l=o.dom;if(!(this.lock&&(l==this.lock||1==l.nodeType&&l.contains(this.lock.parentNode))&&!(e.isText&&o.node&&o.node.isText&&o.nodeDOM.nodeValue==e.text&&3!=o.dirty&&br(t,o.outerDeco)))&&o.update(e,t,n,i))return this.destroyBetween(this.index,s),o.dom!=l&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,t,n,i,r){this.top.children.splice(this.index++,0,lr.create(this.top,e,t,n,i,r)),this.changed=!0}placeWidget(e,t,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(!i||!i.matchesWidget(e)||e!=i.widget&&i.widget.type.toDOM.parentNode){let i=new sr(this.top,e,t,n);this.top.children.splice(this.index++,0,i),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof ar;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof dr)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ei||Ti)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let i=new hr(this.top,[],n,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}}function Sr(e,t){return e.type.side-t.type.side}function Mr(e,t,n,i,r){let s=[];for(let o=0,a=0;o<e.length;o++){let l=e[o],c=a,d=a+=l.size;c>=n||d<=t?s.push(l):(c<t&&s.push(l.slice(0,t-c,i)),r&&(s.push(r),r=void 0),d>n&&s.push(l.slice(n-c,l.size,i)))}return s}function Or(e,t=null){let n=e.domSelectionRange(),i=e.state.doc;if(!n.focusNode)return null;let r=e.docView.nearestDesc(n.focusNode),s=r&&0==r.size,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a,l,c=i.resolve(o);if(gi(n)){for(a=c;r&&!r.node;)r=r.parent;let e=r.node;if(r&&e.isAtom&&qn.isSelectable(e)&&r.parent&&(!e.isInline||!function(e,t,n){for(let i=0==t,r=t==fi(e);i||r;){if(e==n)return!0;let t=ai(e);if(!(e=e.parentNode))return!1;i=i&&0==t,r=r&&t==fi(e)}}(n.focusNode,n.focusOffset,r.dom))){let e=r.posBefore;l=new qn(o==e?c:i.resolve(e))}}else{let t=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(t<0)return null;a=i.resolve(t)}if(!l){l=Br(e,a,c,"pointer"==t||e.state.selection.head<c.pos&&!s?1:-1)}return l}function Cr(e){return e.editable?e.hasFocus():$r(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function Dr(e,t=!1){let n=e.state.selection;if(Ir(e,n),Cr(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&Ti){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&hi(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),n=document.createRange(),i=e.cursorWrapper.dom,r="IMG"==i.nodeName;r?n.setEnd(i.parentNode,ai(i)+1):n.setEnd(i,0);n.collapse(!1),t.removeAllRanges(),t.addRange(n),!r&&!e.state.selection.visible&&Mi&&Oi<=11&&(i.disabled=!0,i.disabled=!1)}(e);else{let i,r,{anchor:s,head:o}=n;!Tr||n instanceof jn||(n.$from.parent.inlineContent||(i=Nr(e,n.from)),n.empty||n.$from.parent.inlineContent||(r=Nr(e,n.to))),e.docView.setSelection(s,o,e.root,t),Tr&&(i&&Ar(i),r&&Ar(r)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),i=n.anchorNode,r=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==i&&n.anchorOffset==r||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{Cr(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Tr=Ei||Ti&&Ni<63;function Nr(e,t){let{node:n,offset:i}=e.docView.domFromPos(t,0),r=i<n.childNodes.length?n.childNodes[i]:null,s=i?n.childNodes[i-1]:null;if(Ei&&r&&"false"==r.contentEditable)return Er(r);if(!(r&&"false"!=r.contentEditable||s&&"false"!=s.contentEditable)){if(r)return Er(r);if(s)return Er(s)}}function Er(e){return e.contentEditable="true",Ei&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Ar(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Ir(e,t){if(t instanceof qn){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(Rr(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else Rr(e)}function Rr(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Br(e,t,n,i){return e.someProp("createSelectionBetween",(i=>i(e,t,n)))||jn.between(t,n,i)}function Pr(e){return!(e.editable&&!e.hasFocus())&&$r(e)}function $r(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function Lr(e,t){let{$anchor:n,$head:i}=e.selection,r=t>0?n.max(i):n.min(i),s=r.parent.inlineContent?r.depth?e.doc.resolve(t>0?r.after():r.before()):null:r;return s&&Vn.findFrom(s,t)}function Vr(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function zr(e,t,n){let i=e.state.selection;if(!(i instanceof jn)){if(i instanceof qn&&i.node.isInline)return Vr(e,new jn(t>0?i.$to:i.$from));{let n=Lr(e.state,t);return!!n&&Vr(e,n)}}if(!i.empty||n.indexOf("s")>-1)return!1;if(e.endOfTextblock(t>0?"right":"left")){let n=Lr(e.state,t);return!!(n&&n instanceof qn)&&Vr(e,n)}if(!(Ii&&n.indexOf("m")>-1)){let n,r=i.$head,s=r.textOffset?null:t<0?r.nodeBefore:r.nodeAfter;if(!s||s.isText)return!1;let o=t<0?r.pos-s.nodeSize:r.pos;return!!(s.isAtom||(n=e.docView.descAt(o))&&!n.contentDOM)&&(qn.isSelectable(s)?Vr(e,new qn(t<0?e.state.doc.resolve(r.pos-s.nodeSize):r)):!!Bi&&Vr(e,new jn(e.state.doc.resolve(t<0?o:o+s.nodeSize))))}}function Fr(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Hr(e){let t=e.pmViewDesc;return t&&0==t.size&&(e.nextSibling||"BR"!=e.nodeName)}function jr(e){let t=e.domSelectionRange(),n=t.focusNode,i=t.focusOffset;if(!n)return;let r,s,o=!1;for(Ci&&1==n.nodeType&&i<Fr(n)&&Hr(n.childNodes[i])&&(o=!0);;)if(i>0){if(1!=n.nodeType)break;{let e=n.childNodes[i-1];if(Hr(e))r=n,s=--i;else{if(3!=e.nodeType)break;n=e,i=n.nodeValue.length}}}else{if(qr(n))break;{let t=n.previousSibling;for(;t&&Hr(t);)r=n.parentNode,s=ai(t),t=t.previousSibling;if(t)n=t,i=Fr(n);else{if(n=n.parentNode,n==e.dom)break;i=0}}}o?Jr(e,n,i):r&&Jr(e,r,s)}function Wr(e){let t=e.domSelectionRange(),n=t.focusNode,i=t.focusOffset;if(!n)return;let r,s,o=Fr(n);for(;;)if(i<o){if(1!=n.nodeType)break;if(!Hr(n.childNodes[i]))break;r=n,s=++i}else{if(qr(n))break;{let t=n.nextSibling;for(;t&&Hr(t);)r=t.parentNode,s=ai(t)+1,t=t.nextSibling;if(t)n=t,i=0,o=Fr(n);else{if(n=n.parentNode,n==e.dom)break;i=o=0}}}r&&Jr(e,r,s)}function qr(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Jr(e,t,n){let i=e.domSelection();if(gi(i)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),i.removeAllRanges(),i.addRange(e)}else i.extend&&i.extend(t,n);e.domObserver.setCurSelection();let{state:r}=e;setTimeout((()=>{e.state==r&&Dr(e)}),50)}function Kr(e,t,n){let i=e.state.selection;if(i instanceof jn&&!i.empty||n.indexOf("s")>-1)return!1;if(Ii&&n.indexOf("m")>-1)return!1;let{$from:r,$to:s}=i;if(!r.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=Lr(e.state,t);if(n&&n instanceof qn)return Vr(e,n)}if(!r.parent.inlineContent){let n=t<0?r:s,o=i instanceof Kn?Vn.near(n,t):Vn.findFrom(n,t);return!!o&&Vr(e,o)}return!1}function _r(e,t){if(!(e.state.selection instanceof jn))return!0;let{$head:n,$anchor:i,empty:r}=e.state.selection;if(!n.sameParent(i))return!0;if(!r)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let s=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let i=e.state.tr;return t<0?i.delete(n.pos-s.nodeSize,n.pos):i.delete(n.pos,n.pos+s.nodeSize),e.dispatch(i),!0}return!1}function Ur(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Yr(e,t){let n=t.keyCode,i=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);return 8==n||Ii&&72==n&&"c"==i?_r(e,-1)||jr(e):46==n||Ii&&68==n&&"c"==i?_r(e,1)||Wr(e):13==n||27==n||(37==n||Ii&&66==n&&"c"==i?zr(e,-1,i)||jr(e):39==n||Ii&&70==n&&"c"==i?zr(e,1,i)||Wr(e):38==n||Ii&&80==n&&"c"==i?Kr(e,-1,i)||jr(e):40==n||Ii&&78==n&&"c"==i?function(e){if(!Ei||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;Ur(e,n,"true"),setTimeout((()=>Ur(e,n,"false")),20)}return!1}(e)||Kr(e,1,i)||Wr(e):i==(Ii?"m":"c")&&(66==n||73==n||89==n||90==n))}function Gr(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:i,openStart:r,openEnd:s}=t;for(;r>1&&s>1&&1==i.childCount&&1==i.firstChild.childCount;){r--,s--;let e=i.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),i=e.content}let o=e.someProp("clipboardSerializer")||Yt.fromSchema(e.state.schema),a=as(),l=a.createElement("div");l.appendChild(o.serializeFragment(i,{document:a}));let c,d=l.firstChild,h=0;for(;d&&1==d.nodeType&&(c=rs[d.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=a.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),h++}d=l.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice",`${r} ${s}${h?` -${h}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n")}}function Xr(e,t,n,i,r){let s,o,a=r.parent.type.spec.code;if(!n&&!t)return null;let l=t&&(i||a||!n);if(l){if(e.someProp("transformPastedText",(n=>{t=n(t,a||i,e)})),a)return t?new tt(Ye.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):tt.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,r,i,e)));if(n)o=n;else{let n=r.marks(),{schema:i}=e.state,o=Yt.fromSchema(i);s=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=s.appendChild(document.createElement("p"));e&&t.appendChild(o.serializeNode(i.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),s=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,i=as().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e);(n=r&&rs[r[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join(""));if(i.innerHTML=e,n)for(let e=0;e<n.length;e++)i=i.querySelector(n[e])||i;return i}(n),Bi&&function(e){let t=e.querySelectorAll(Ti?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let i=t[n];1==i.childNodes.length&&" "==i.textContent&&i.parentNode&&i.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),i)}}(s);let c=s&&s.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let e=+d[3];e>0;e--){let e=s.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;s=e}if(!o){let t=e.someProp("clipboardParser")||e.someProp("domParser")||zt.fromSchema(e.state.schema);o=t.parseSlice(s,{preserveWhitespace:!(!l&&!d),context:r,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||Zr.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(d)o=function(e,t){if(!e.size)return e;let n,i=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(t){return e}let{content:r,openStart:s,openEnd:o}=e;for(let e=n.length-2;e>=0;e-=2){let t=i.nodes[n[e]];if(!t||t.hasRequiredAttrs())break;r=Ye.from(t.create(n[e+1],r)),s++,o++}return new tt(r,s,o)}(is(o,+d[1],+d[2]),d[4]);else if(o=tt.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let i,r=t.node(n).contentMatchAt(t.index(n)),s=[];if(e.forEach((e=>{if(!s)return;let t,n=r.findWrapping(e.type);if(!n)return s=null;if(t=s.length&&i.length&&es(n,i,e,s[s.length-1],0))s[s.length-1]=t;else{s.length&&(s[s.length-1]=ts(s[s.length-1],i.length));let t=Qr(e,n);s.push(t),r=r.matchType(t.type),i=n}})),s)return Ye.from(s)}return e}(o.content,r),!0),o.openStart||o.openEnd){let e=0,t=0;for(let t=o.content.firstChild;e<o.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=o.content.lastChild;t<o.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);o=is(o,e,t)}return e.someProp("transformPasted",(t=>{o=t(o,e)})),o}const Zr=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Qr(e,t,n=0){for(let i=t.length-1;i>=n;i--)e=t[i].create(null,Ye.from(e));return e}function es(e,t,n,i,r){if(r<e.length&&r<t.length&&e[r]==t[r]){let s=es(e,t,n,i.lastChild,r+1);if(s)return i.copy(i.content.replaceChild(i.childCount-1,s));if(i.contentMatchAt(i.childCount).matchType(r==e.length-1?n.type:e[r+1]))return i.copy(i.content.append(Ye.from(Qr(n,e,r+1))))}}function ts(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,ts(e.lastChild,t-1)),i=e.contentMatchAt(e.childCount).fillBefore(Ye.empty,!0);return e.copy(n.append(i))}function ns(e,t,n,i,r,s){let o=t<0?e.firstChild:e.lastChild,a=o.content;return r<i-1&&(a=ns(a,t,n,i,r+1,s)),r>=n&&(a=t<0?o.contentMatchAt(0).fillBefore(a,e.childCount>1||s<=r).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Ye.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(a))}function is(e,t,n){return t<e.openStart&&(e=new tt(ns(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new tt(ns(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const rs={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let ss=null;function as(){return ss||(ss=document.implementation.createHTMLDocument("title"))}const ls={},cs={},ds={touchstart:!0,touchmove:!0};class hs{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ps(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function us(e){e.someProp("handleDOMEvents",(t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>fs(e,t))}))}function fs(e,t){return e.someProp("handleDOMEvents",(n=>{let i=n[t.type];return!!i&&(i(e,t)||t.defaultPrevented)}))}function ms(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function gs(e){return{left:e.clientX,top:e.clientY}}function ys(e,t,n,i,r){if(-1==i)return!1;let s=e.state.doc.resolve(i);for(let i=s.depth+1;i>0;i--)if(e.someProp(t,(t=>i>s.depth?t(e,n,s.nodeAfter,s.before(i),r,!0):t(e,n,s.node(i),s.before(i),r,!1))))return!0;return!1}function ws(e,t,n){e.focused||e.focus();let i=e.state.tr.setSelection(t);"pointer"==n&&i.setMeta("pointer",!0),e.dispatch(i)}function vs(e,t,n,i,r){return ys(e,"handleClickOn",t,n,i)||e.someProp("handleClick",(n=>n(e,t,i)))||(r?function(e,t){if(-1==t)return!1;let n,i,r=e.state.selection;r instanceof qn&&(n=r.node);let s=e.state.doc.resolve(t);for(let e=s.depth+1;e>0;e--){let t=e>s.depth?s.nodeAfter:s.node(e);if(qn.isSelectable(t)){i=n&&r.$from.depth>0&&e>=r.$from.depth&&s.before(r.$from.depth+1)==r.$from.pos?s.before(r.$from.depth):s.before(e);break}}return null!=i&&(ws(e,qn.create(e.state.doc,i),"pointer"),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),i=n.nodeAfter;return!!(i&&i.isAtom&&qn.isSelectable(i))&&(ws(e,new qn(n),"pointer"),!0)}(e,n))}function bs(e,t,n,i){return ys(e,"handleDoubleClickOn",t,n,i)||e.someProp("handleDoubleClick",(n=>n(e,t,i)))}function ks(e,t,n,i){return ys(e,"handleTripleClickOn",t,n,i)||e.someProp("handleTripleClick",(n=>n(e,t,i)))||function(e,t,n){if(0!=n.button)return!1;let i=e.state.doc;if(-1==t)return!!i.inlineContent&&(ws(e,jn.create(i,0,i.content.size),"pointer"),!0);let r=i.resolve(t);for(let t=r.depth+1;t>0;t--){let n=t>r.depth?r.nodeAfter:r.node(t),s=r.before(t);if(n.inlineContent)ws(e,jn.create(i,s+1,s+1+n.content.size),"pointer");else{if(!qn.isSelectable(n))continue;ws(e,qn.create(i,s),"pointer")}return!0}}(e,n,i)}function xs(e){return Ns(e)}cs.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!Os(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!Ri||!Ti||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!Ai||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||Yr(e,n)?n.preventDefault():ps(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,yi(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},cs.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},cs.keypress=(e,t)=>{let n=t;if(Os(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ii&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let i=e.state.selection;if(!(i instanceof jn&&i.$from.sameParent(i.$to))){let t=String.fromCharCode(n.charCode);e.someProp("handleTextInput",(n=>n(e,i.$from.pos,i.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const Ss=Ii?"metaKey":"ctrlKey";ls.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let i=xs(e),r=Date.now(),s="singleClick";r-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,i=t.y-e.clientY;return n*n+i*i<100}(n,e.input.lastClick)&&!n[Ss]&&("singleClick"==e.input.lastClick.type?s="doubleClick":"doubleClick"==e.input.lastClick.type&&(s="tripleClick")),e.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:s};let o=e.posAtCoords(gs(n));o&&("singleClick"==s?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new Ms(e,o,n,!!i)):("doubleClick"==s?bs:ks)(e,o.pos,o.inside,n)?n.preventDefault():ps(e,"pointer"))};class Ms{constructor(e,t,n,i){let r,s;if(this.view=e,this.pos=t,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[Ss],this.allowDefault=n.shiftKey,t.inside>-1)r=e.state.doc.nodeAt(t.inside),s=t.inside;else{let n=e.state.doc.resolve(t.pos);r=n.parent,s=n.depth?n.before():0}const o=i?null:n.target,a=o?e.docView.nearestDesc(o,!0):null;this.target=a?a.dom:null;let{selection:l}=e.state;(0==n.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||l instanceof qn&&l.from<=s&&l.to>s)&&(this.mightDrag={node:r,pos:s,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!Ci||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ps(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>Dr(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(gs(e))),this.updateAllowDefault(e),this.allowDefault||!t?ps(this.view,"pointer"):vs(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||Ei&&this.mightDrag&&!this.mightDrag.node.isAtom||Ti&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(ws(this.view,Vn.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):ps(this.view,"pointer")}move(e){this.updateAllowDefault(e),ps(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function Os(e,t){return!!e.composing||!!(Ei&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}ls.touchstart=e=>{e.input.lastTouch=Date.now(),xs(e),ps(e,"pointer")},ls.touchmove=e=>{e.input.lastTouch=Date.now(),ps(e,"pointer")},ls.contextmenu=e=>xs(e);const Cs=Ri?5e3:-1;function Ds(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>Ns(e)),t))}function Ts(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function Ns(e,t=!1){if(!(Ri&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),Ts(e),t||e.docView&&e.docView.dirty){let t=Or(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}cs.compositionstart=cs.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),Ns(e,!0),e.markCursor=null;else if(Ns(e),Ci&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,i=t.focusOffset;n&&1==n.nodeType&&0!=i;){let t=i<0?n.lastChild:n.childNodes[i-1];if(!t)break;if(3==t.nodeType){e.domSelection().collapse(t,t.nodeValue.length);break}n=t,i=-1}}e.input.composing=!0}Ds(e,Cs)},cs.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,Ds(e,20))};const Es=Mi&&Oi<15||Ai&&Pi<604;function As(e,t,n,i){let r=Xr(e,t,n,e.input.shiftKey,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,i,r||tt.empty))))return!0;if(!r)return!1;let s=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(r),o=s?e.state.tr.replaceSelectionWith(s,e.input.shiftKey):e.state.tr.replaceSelection(r);return e.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}ls.copy=cs.cut=(e,t)=>{let n=t,i=e.state.selection,r="cut"==n.type;if(i.empty)return;let s=Es?null:n.clipboardData,o=i.content(),{dom:a,text:l}=Gr(e,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),r=document.createRange();r.selectNodeContents(t),e.dom.blur(),i.removeAllRanges(),i.addRange(r),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}(e,a),r&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},cs.paste=(e,t)=>{let n=t;if(e.composing&&!Ri)return;let i=Es?null:n.clipboardData;i&&As(e,i.getData("text/plain"),i.getData("text/html"),n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,i=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{e.focus(),i.parentNode&&i.parentNode.removeChild(i),n?As(e,i.value,null,t):As(e,i.textContent,i.innerHTML,t)}),50)}(e,n)};class Is{constructor(e,t){this.slice=e,this.move=t}}const Rs=Ii?"altKey":"ctrlKey";ls.dragstart=(e,t)=>{let n=t,i=e.input.mouseDown;if(i&&i.done(),!n.dataTransfer)return;let r=e.state.selection,s=r.empty?null:e.posAtCoords(gs(n));if(s&&s.pos>=r.from&&s.pos<=(r instanceof qn?r.to-1:r.to));else if(i&&i.mightDrag)e.dispatch(e.state.tr.setSelection(qn.create(e.state.doc,i.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&e.dispatch(e.state.tr.setSelection(qn.create(e.state.doc,t.posBefore)))}let o=e.state.selection.content(),{dom:a,text:l}=Gr(e,o);n.dataTransfer.clearData(),n.dataTransfer.setData(Es?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",Es||n.dataTransfer.setData("text/plain",l),e.dragging=new Is(o,!n[Rs])},ls.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},cs.dragover=cs.dragenter=(e,t)=>t.preventDefault(),cs.drop=(e,t)=>{let n=t,i=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let r=e.posAtCoords(gs(n));if(!r)return;let s=e.state.doc.resolve(r.pos),o=i&&i.slice;o?e.someProp("transformPasted",(t=>{o=t(o,e)})):o=Xr(e,n.dataTransfer.getData(Es?"Text":"text/plain"),Es?null:n.dataTransfer.getData("text/html"),!1,s);let a=!(!i||n[Rs]);if(e.someProp("handleDrop",(t=>t(e,n,o||tt.empty,a))))return void n.preventDefault();if(!o)return;n.preventDefault();let l=o?xn(e.state.doc,s.pos,o):s.pos;null==l&&(l=s.pos);let c=e.state.tr;a&&c.deleteSelection();let d=c.mapping.map(l),h=0==o.openStart&&0==o.openEnd&&1==o.content.childCount,p=c.doc;if(h?c.replaceRangeWith(d,d,o.content.firstChild):c.replaceRange(d,d,o),c.doc.eq(p))return;let u=c.doc.resolve(d);if(h&&qn.isSelectable(o.content.firstChild)&&u.nodeAfter&&u.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new qn(u));else{let t=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach(((e,n,i,r)=>t=r)),c.setSelection(Br(e,u,c.doc.resolve(t)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))},ls.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&Dr(e)}),20))},ls.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},ls.beforeinput=(e,t)=>{if(Ti&&Ri&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,yi(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let e in cs)ls[e]=cs[e];function Bs(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class Ps{constructor(e,t){this.toDOM=e,this.spec=t||Fs,this.side=this.spec.side||0}map(e,t,n,i){let{pos:r,deleted:s}=e.mapResult(t.from+i,this.side<0?-1:1);return s?null:new Vs(r-n,r-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Ps&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Bs(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class $s{constructor(e,t){this.attrs=e,this.spec=t||Fs}map(e,t,n,i){let r=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-n,s=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-n;return r>=s?null:new Vs(r,s,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof $s&&Bs(this.attrs,e.attrs)&&Bs(this.spec,e.spec)}static is(e){return e.type instanceof $s}destroy(){}}class Ls{constructor(e,t){this.attrs=e,this.spec=t||Fs}map(e,t,n,i){let r=e.mapResult(t.from+i,1);if(r.deleted)return null;let s=e.mapResult(t.to+i,-1);return s.deleted||s.pos<=r.pos?null:new Vs(r.pos-n,s.pos-n,this)}valid(e,t){let n,{index:i,offset:r}=e.content.findIndex(t.from);return r==t.from&&!(n=e.child(i)).isText&&r+n.nodeSize==t.to}eq(e){return this==e||e instanceof Ls&&Bs(this.attrs,e.attrs)&&Bs(this.spec,e.spec)}destroy(){}}class Vs{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Vs(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Vs(e,e,new Ps(t,n))}static inline(e,t,n,i){return new Vs(e,t,new $s(n,i))}static node(e,t,n,i){return new Vs(e,t,new Ls(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof $s}}const zs=[],Fs={};class Hs{constructor(e,t){this.local=e.length?e:zs,this.children=t.length?t:zs}static create(e,t){return t.length?_s(t,e,0,Fs):js}find(e,t,n){let i=[];return this.findInner(null==e?0:e,null==t?1e9:t,i,0,n),i}findInner(e,t,n,i,r){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=t&&o.to>=e&&(!r||r(o.spec))&&n.push(o.copy(o.from+i,o.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<t&&this.children[s+1]>e){let o=this.children[s]+1;this.children[s+2].findInner(e-o,t-o,n,i+o,r)}}map(e,t,n){return this==js||0==e.maps.length?this:this.mapInner(e,t,0,0,n||Fs)}mapInner(e,t,n,i,r){let s;for(let o=0;o<this.local.length;o++){let a=this.local[o].map(e,n,i);a&&a.type.valid(t,a)?(s||(s=[])).push(a):r.onRemove&&r.onRemove(this.local[o].spec)}return this.children.length?function(e,t,n,i,r,s,o){let a=e.slice();for(let e=0,t=s;e<n.maps.length;e++){let i=0;n.maps[e].forEach(((e,n,s,o)=>{let l=o-s-(n-e);for(let o=0;o<a.length;o+=3){let c=a[o+1];if(c<0||e>c+t-i)continue;let d=a[o]+t-i;n>=d?a[o+1]=e<=d?-2:-1:s>=r&&l&&(a[o]+=l,a[o+1]+=l)}i+=l})),t=n.maps[e].map(t,-1)}let l=!1;for(let t=0;t<a.length;t+=3)if(a[t+1]<0){if(-2==a[t+1]){l=!0,a[t+1]=-1;continue}let c=n.map(e[t]+s),d=c-r;if(d<0||d>=i.content.size){l=!0;continue}let h=n.map(e[t+1]+s,-1)-r,{index:p,offset:u}=i.content.findIndex(d),f=i.maybeChild(p);if(f&&u==d&&u+f.nodeSize==h){let i=a[t+2].mapInner(n,f,c+1,e[t]+s+1,o);i!=js?(a[t]=d,a[t+1]=h,a[t+2]=i):(a[t+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,i,r,s,o){function a(e,t){for(let s=0;s<e.local.length;s++){let a=e.local[s].map(i,r,t);a?n.push(a):o.onRemove&&o.onRemove(e.local[s].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let n=0;n<e.length;n+=3)-1==e[n+1]&&a(e[n+2],t[n]+s+1);return n}(a,e,t,n,r,s,o),c=_s(l,i,0,o);t=c.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<a.length&&a[t]<n;)t+=3;a.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new Hs(t.sort(Us),a)}(this.children,s||[],e,t,n,i,r):s?new Hs(s.sort(Us),zs):js}add(e,t){return t.length?this==js?Hs.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let i,r=0;e.forEach(((e,s)=>{let o,a=s+n;if(o=Js(t,e,a)){for(i||(i=this.children.slice());r<i.length&&i[r]<s;)r+=3;i[r]==s?i[r+2]=i[r+2].addInner(e,o,a+1):i.splice(r,0,s,s+e.nodeSize,_s(o,e,a+1,Fs)),r+=3}}));let s=qs(r?Ks(t):t,-n);for(let t=0;t<s.length;t++)s[t].type.valid(e,s[t])||s.splice(t--,1);return new Hs(s.length?this.local.concat(s).sort(Us):this.local,i||this.children)}remove(e){return 0==e.length||this==js?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,i=this.local;for(let i=0;i<n.length;i+=3){let r,s=n[i]+t,o=n[i+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>s&&t.to<o&&(e[n]=null,(r||(r=[])).push(t));if(!r)continue;n==this.children&&(n=this.children.slice());let a=n[i+2].removeInner(r,s+1);a!=js?n[i+2]=a:(n.splice(i,3),i-=3)}if(i.length)for(let n,r=0;r<e.length;r++)if(n=e[r])for(let e=0;e<i.length;e++)i[e].eq(n,t)&&(i==this.local&&(i=this.local.slice()),i.splice(e--,1));return n==this.children&&i==this.local?this:i.length||n.length?new Hs(i,n):js}forChild(e,t){if(this==js)return this;if(t.isLeaf)return Hs.empty;let n,i;for(let t=0;t<this.children.length;t+=3)if(this.children[t]>=e){this.children[t]==e&&(n=this.children[t+2]);break}let r=e+1,s=r+t.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<s&&t.to>r&&t.type instanceof $s){let e=Math.max(r,t.from)-r,n=Math.min(s,t.to)-r;e<n&&(i||(i=[])).push(t.copy(e,n))}}if(i){let e=new Hs(i.sort(Us),zs);return n?new Ws([e,n]):e}return n||js}eq(e){if(this==e)return!0;if(!(e instanceof Hs)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Ys(this.localsInner(e))}localsInner(e){if(this==js)return zs;if(e.inlineContent||!this.local.some($s.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof $s||t.push(this.local[e]);return t}}Hs.empty=new Hs([],[]),Hs.removeOverlap=Ys;const js=Hs.empty;class Ws{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,Fs)));return Ws.from(n)}forChild(e,t){if(t.isLeaf)return Hs.empty;let n=[];for(let i=0;i<this.members.length;i++){let r=this.members[i].forChild(e,t);r!=js&&(r instanceof Ws?n=n.concat(r.members):n.push(r))}return Ws.from(n)}eq(e){if(!(e instanceof Ws)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let i=0;i<this.members.length;i++){let r=this.members[i].localsInner(e);if(r.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<r.length;e++)t.push(r[e])}else t=r}return t?Ys(n?t:t.sort(Us)):zs}static from(e){switch(e.length){case 0:return js;case 1:return e[0];default:return new Ws(e.every((e=>e instanceof Hs))?e:e.reduce(((e,t)=>e.concat(t instanceof Hs?t:t.members)),[]))}}}function qs(e,t){if(!t||!e.length)return e;let n=[];for(let i=0;i<e.length;i++){let r=e[i];n.push(new Vs(r.from+t,r.to+t,r.type))}return n}function Js(e,t,n){if(t.isLeaf)return null;let i=n+t.nodeSize,r=null;for(let t,s=0;s<e.length;s++)(t=e[s])&&t.from>n&&t.to<i&&((r||(r=[])).push(t),e[s]=null);return r}function Ks(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function _s(e,t,n,i){let r=[],s=!1;t.forEach(((t,o)=>{let a=Js(e,t,o+n);if(a){s=!0;let e=_s(a,t,n+o+1,i);e!=js&&r.push(o,o+t.nodeSize,e)}}));let o=qs(s?Ks(e):e,-n).sort(Us);for(let e=0;e<o.length;e++)o[e].type.valid(t,o[e])||(i.onRemove&&i.onRemove(o[e].spec),o.splice(e--,1));return o.length||r.length?new Hs(o,r):js}function Us(e,t){return e.from-t.from||e.to-t.to}function Ys(e){let t=e;for(let n=0;n<t.length-1;n++){let i=t[n];if(i.from!=i.to)for(let r=n+1;r<t.length;r++){let s=t[r];if(s.from!=i.from){s.from<i.to&&(t==e&&(t=e.slice()),t[n]=i.copy(i.from,s.from),Gs(t,r,i.copy(s.from,i.to)));break}s.to!=i.to&&(t==e&&(t=e.slice()),t[r]=s.copy(s.from,i.to),Gs(t,r+1,s.copy(i.to,s.to)))}}return t}function Gs(e,t,n){for(;t<e.length&&Us(n,e[t])>0;)t++;e.splice(t,0,n)}function Xs(e){let t=[];return e.someProp("decorations",(n=>{let i=n(e.state);i&&i!=js&&t.push(i)})),e.cursorWrapper&&t.push(Hs.create(e.state.doc,[e.cursorWrapper.deco])),Ws.from(t)}const Zs={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Qs=Mi&&Oi<=11;class eo{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class to{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new eo,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);Mi&&Oi<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Qs&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Zs)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(Pr(this.view)){if(this.suppressingSelectionUpdates)return Dr(this.view);if(Mi&&Oi<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&hi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let t=e.focusNode;t;t=li(t))n.add(t);for(let i=e.anchorNode;i;i=li(i))if(n.has(i)){t=i;break}let i=t&&this.view.docView.nearestDesc(t);return i&&i.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Pr(e)&&!this.ignoreSelectionChange(n),r=-1,s=-1,o=!1,a=[];if(e.editable)for(let e=0;e<t.length;e++){let n=this.registerMutation(t[e],a);n&&(r=r<0?n.from:Math.min(n.from,r),s=s<0?n.to:Math.max(n.to,s),n.typeOver&&(o=!0))}if(Ci&&a.length>1){let e=a.filter((e=>"BR"==e.nodeName));if(2==e.length){let t=e[0],n=e[1];t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}}let l=null;r<0&&i&&e.input.lastFocus>Date.now()-200&&e.input.lastTouch<Date.now()-300&&gi(n)&&(l=Or(e))&&l.eq(Vn.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Dr(e),this.currentSelection.set(n),e.scrollToSelection()):(r>-1||i)&&(r>-1&&(e.docView.markDirty(r,s),function(e){if(no.has(e))return;if(no.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=Ci,io)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),io=!0}}(e)),this.handleDOMChange(r,s,o,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||Dr(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++)t.push(e.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,r=e.nextSibling;if(Mi&&Oi<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:s}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(i=n),(!s||Array.prototype.indexOf.call(e.addedNodes,s)<0)&&(r=s)}let s=i&&i.parentNode==e.target?ai(i)+1:0,o=n.localPosFromDOM(e.target,s,-1),a=r&&r.parentNode==e.target?ai(r):e.target.childNodes.length;return{from:o,to:n.localPosFromDOM(e.target,a,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let no=new WeakMap,io=!1;function ro(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(Ei&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||Ei&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}function so(e,t,n,i,r){if(t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=Or(e,t);if(n&&!e.state.selection.eq(n)){let i=e.state.tr.setSelection(n);"pointer"==t?i.setMeta("pointer",!0):"key"==t&&i.scrollIntoView(),e.dispatch(i)}return}let s=e.state.doc.resolve(t),o=s.sharedDepth(n);t=s.before(o+1),n=e.state.doc.resolve(n).after(o+1);let a,l,c=e.state.selection,d=function(e,t,n){let i,{node:r,fromOffset:s,toOffset:o,from:a,to:l}=e.docView.parseRange(t,n),c=e.domSelectionRange(),d=c.anchorNode;if(d&&e.dom.contains(1==d.nodeType?d:d.parentNode)&&(i=[{node:d,offset:c.anchorOffset}],gi(c)||i.push({node:c.focusNode,offset:c.focusOffset})),Ti&&8===e.input.lastKeyCode)for(let e=o;e>s;e--){let t=r.childNodes[e-1],n=t.pmViewDesc;if("BR"==t.nodeName&&!n){o=e;break}if(!n||n.size)break}let h=e.state.doc,p=e.someProp("domParser")||zt.fromSchema(e.state.schema),u=h.resolve(a),f=null,m=p.parse(r,{topNode:u.parent,topMatch:u.parent.contentMatchAt(u.index()),topOpen:!0,from:s,to:o,preserveWhitespace:"pre"!=u.parent.type.whitespace||"full",findPositions:i,ruleFromNode:ro,context:u});if(i&&null!=i[0].pos){let e=i[0].pos,t=i[1]&&i[1].pos;null==t&&(t=e),f={anchor:e+a,head:t+a}}return{doc:m,sel:f,from:a,to:l}}(e,t,n),h=e.state.doc,p=h.slice(d.from,d.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(a=e.state.selection.to,l="end"):(a=e.state.selection.from,l="start"),e.input.lastKeyCode=null;let u=function(e,t,n,i,r){let s=e.findDiffStart(t,n);if(null==s)return null;let{a:o,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==r){i-=o+Math.max(0,s-Math.min(o,a))-s}if(o<s&&e.size<t.size){s-=i<=s&&i>=o?s-i:0,a=s+(a-o),o=s}else if(a<s){s-=i<=s&&i>=a?s-i:0,o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}(p.content,d.doc.content,d.from,a,l);if((Ai&&e.input.lastIOSEnter>Date.now()-225||Ri)&&r.some((e=>"DIV"==e.nodeName||"P"==e.nodeName||"LI"==e.nodeName))&&(!u||u.endA>=u.endB)&&e.someProp("handleKeyDown",(t=>t(e,yi(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!u){if(!(i&&c instanceof jn&&!c.empty&&c.$head.sameParent(c.$anchor))||e.composing||d.sel&&d.sel.anchor!=d.sel.head){if(d.sel){let t=oo(e,e.state.doc,d.sel);t&&!t.eq(e.state.selection)&&e.dispatch(e.state.tr.setSelection(t))}return}u={start:c.from,endA:c.to,endB:c.to}}if(Ti&&e.cursorWrapper&&d.sel&&d.sel.anchor==e.cursorWrapper.deco.from&&d.sel.head==d.sel.anchor){let e=u.endB-u.start;d.sel={anchor:d.sel.anchor+e,head:d.sel.anchor+e}}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&u.start==u.endB&&e.state.selection instanceof jn&&(u.start>e.state.selection.from&&u.start<=e.state.selection.from+2&&e.state.selection.from>=d.from?u.start=e.state.selection.from:u.endA<e.state.selection.to&&u.endA>=e.state.selection.to-2&&e.state.selection.to<=d.to&&(u.endB+=e.state.selection.to-u.endA,u.endA=e.state.selection.to)),Mi&&Oi<=11&&u.endB==u.start+1&&u.endA==u.start&&u.start>d.from&&"  "==d.doc.textBetween(u.start-d.from-1,u.start-d.from+1)&&(u.start--,u.endA--,u.endB--);let f,m=d.doc.resolveNoCache(u.start-d.from),g=d.doc.resolveNoCache(u.endB-d.from),y=h.resolve(u.start),w=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=u.endA;if((Ai&&e.input.lastIOSEnter>Date.now()-225&&(!w||r.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!w&&m.pos<d.doc.content.size&&(f=Vn.findFrom(d.doc.resolve(m.pos+1),1,!0))&&f.head==g.pos)&&e.someProp("handleKeyDown",(t=>t(e,yi(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>u.start&&function(e,t,n,i,r){if(!i.parent.isTextblock||n-t<=r.pos-i.pos||ao(i,!0,!1)<r.pos)return!1;let s=e.resolve(t);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=e.resolve(ao(s,!0,!0));return!(!o.parent.isTextblock||o.pos>n||ao(o,!0,!1)<n)&&i.parent.content.cut(i.parentOffset).eq(o.parent.content)}(h,u.start,u.endA,m,g)&&e.someProp("handleKeyDown",(t=>t(e,yi(8,"Backspace")))))return void(Ri&&Ti&&e.domObserver.suppressSelectionUpdates());Ti&&Ri&&u.endB==u.start&&(e.input.lastAndroidDelete=Date.now()),Ri&&!w&&m.start()!=g.start()&&0==g.parentOffset&&m.depth==g.depth&&d.sel&&d.sel.anchor==d.sel.head&&d.sel.head==u.endA&&(u.endB-=2,g=d.doc.resolveNoCache(u.endB-d.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,yi(13,"Enter"))}))}),20));let v,b,k,x=u.start,S=u.endA;if(w)if(m.pos==g.pos)Mi&&Oi<=11&&0==m.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>Dr(e)),20)),v=e.state.tr.delete(x,S),b=h.resolve(u.start).marksAcross(h.resolve(u.endA));else if(u.endA==u.endB&&(k=function(e,t){let n,i,r,s=e.firstChild.marks,o=t.firstChild.marks,a=s,l=o;for(let e=0;e<o.length;e++)a=o[e].removeFromSet(a);for(let e=0;e<s.length;e++)l=s[e].removeFromSet(l);if(1==a.length&&0==l.length)i=a[0],n="add",r=e=>e.mark(i.addToSet(e.marks));else{if(0!=a.length||1!=l.length)return null;i=l[0],n="remove",r=e=>e.mark(i.removeFromSet(e.marks))}let c=[];for(let e=0;e<t.childCount;e++)c.push(r(t.child(e)));if(Ye.from(c).eq(e))return{mark:i,type:n}}(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,u.endA-y.start()))))v=e.state.tr,"add"==k.type?v.addMark(x,S,k.mark):v.removeMark(x,S,k.mark);else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let t=m.parent.textBetween(m.parentOffset,g.parentOffset);if(e.someProp("handleTextInput",(n=>n(e,x,S,t))))return;v=e.state.tr.insertText(t,x,S)}if(v||(v=e.state.tr.replace(x,S,d.doc.slice(u.start-d.from,u.endB-d.from))),d.sel){let t=oo(e,v.doc,d.sel);t&&!(Ti&&Ri&&e.composing&&t.empty&&(u.start!=u.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==x||t.head==v.mapping.map(S)-1)||Mi&&t.empty&&t.head==x)&&v.setSelection(t)}b&&v.ensureMarks(b),e.dispatch(v.scrollIntoView())}function oo(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Br(e,t.resolve(n.anchor),t.resolve(n.head))}function ao(e,t,n){let i=e.depth,r=t?e.end():e.pos;for(;i>0&&(t||e.indexAfter(i)==e.node(i).childCount);)i--,r++,t=!1;if(n){let t=e.node(i).maybeChild(e.indexAfter(i));for(;t&&!t.isLeaf;)t=t.firstChild,r++}return r}class lo{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new hs,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(fo),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=po(this),ho(this),this.nodeViews=uo(this),this.docView=cr(this.state.doc,co(this),Xs(this),this.dom,this),this.domObserver=new to(this,((e,t,n,i)=>so(this,e,t,n,i))),this.domObserver.start(),function(e){for(let t in ls){let n=ls[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!ms(e,t)||fs(e,t)||!e.editable&&t.type in cs||n(e,t)},ds[t]?{passive:!0}:void 0)}Ei&&e.dom.addEventListener("input",(()=>null)),us(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&us(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(fo),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let e in this._props)t[e]=this._props[e];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,i=!1,r=!1;e.storedMarks&&this.composing&&(Ts(this),r=!0),this.state=e;let s=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(s||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=uo(this);(function(e,t){let n=0,i=0;for(let i in e){if(e[i]!=t[i])return!0;n++}for(let e in t)i++;return n!=i})(e,this.nodeViews)&&(this.nodeViews=e,i=!0)}(s||t.handleDOMEvents!=this._props.handleDOMEvents)&&us(this),this.editable=po(this),ho(this);let o=Xs(this),a=co(this),l=n.plugins==e.plugins||n.doc.eq(e.doc)?e.scrollToSelection>n.scrollToSelection?"to selection":"preserve":"reset",c=i||!this.docView.matchesNode(e.doc,a,o);!c&&e.selection.eq(n.selection)||(r=!0);let d="preserve"==l&&r&&null==this.dom.style.overflowAnchor&&function(e){let t,n,i=e.dom.getBoundingClientRect(),r=Math.max(0,i.top);for(let s=(i.left+i.right)/2,o=r+1;o<Math.min(innerHeight,i.bottom);o+=5){let i=e.root.elementFromPoint(s,o);if(!i||i==e.dom||!e.dom.contains(i))continue;let a=i.getBoundingClientRect();if(a.top>=r-20){t=i,n=a.top;break}}return{refDOM:t,refTop:n,stack:Fi(e.dom)}}(this);if(r){this.domObserver.stop();let t=c&&(Mi||Ti)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(n.selection,e.selection);if(c){let n=Ti?this.trackWrites=this.domSelectionRange().focusNode:null;!i&&this.docView.update(e.doc,a,o,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=cr(e.doc,a,o,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return hi(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?Dr(this,t):(Ir(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():d&&function({refDOM:e,refTop:t,stack:n}){let i=e?e.getBoundingClientRect().top:0;Hi(n,0==i?0:i-t)}(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof qn){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&zi(this,t.getBoundingClientRect(),e)}else zi(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}someProp(e,t){let n,i=this._props&&this._props[e];if(null!=i&&(n=t?t(i):i))return n;for(let i=0;i<this.directPlugins.length;i++){let r=this.directPlugins[i].props[e];if(null!=r&&(n=t?t(r):r))return n}let r=this.state.plugins;if(r)for(let i=0;i<r.length;i++){let s=r[i].props[e];if(null!=s&&(n=t?t(s):s))return n}}hasFocus(){if(Mi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(ji)return e.focus(ji);let t=Fi(e);e.focus(null==ji?{get preventScroll(){return ji={preventScroll:!0},!0}}:void 0),ji||(ji=!1,Hi(t,0))}(this.dom),Dr(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return e||document}posAtCoords(e){return Ki(this,e)}coordsAtPos(e,t=1){return Yi(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let i=this.docView.posFromDOM(e,t,n);if(null==i)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return ir(this,t||this.state,e)}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Xs(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){fs(e,t)||!ls[t.type]||!e.editable&&t.type in cs||ls[t.type](e,t)}(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return Ei&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom?function(e){let t;function n(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}e.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",n,!0);let i=t.startContainer,r=t.startOffset,s=t.endContainer,o=t.endOffset,a=e.domAtPos(e.state.selection.anchor);return hi(a.node,a.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function co(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),t.translate="no",e.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e&&(t.class+=" "+n[e]),"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))})),[Vs.node(0,e.state.doc.content.size,t)]}function ho(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Vs.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function po(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function uo(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function fo(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var mo={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},go={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},yo="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),wo=("undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)),vo="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),bo=wo||yo&&+yo[1]<57,ko=0;ko<10;ko++)mo[48+ko]=mo[96+ko]=String(ko);for(ko=1;ko<=24;ko++)mo[ko+111]="F"+ko;for(ko=65;ko<=90;ko++)mo[ko]=String.fromCharCode(ko+32),go[ko]=String.fromCharCode(ko);for(var xo in mo)go.hasOwnProperty(xo)||(go[xo]=mo[xo]);function So(e){var t=!(bo&&(e.ctrlKey||e.altKey||e.metaKey)||vo&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?go:mo)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}const Mo="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function Oo(e){let t,n,i,r,s=e.split(/-(?!$)/),o=s[s.length-1];"Space"==o&&(o=" ");for(let e=0;e<s.length-1;e++){let o=s[e];if(/^(cmd|meta|m)$/i.test(o))r=!0;else if(/^a(lt)?$/i.test(o))t=!0;else if(/^(c|ctrl|control)$/i.test(o))n=!0;else if(/^s(hift)?$/i.test(o))i=!0;else{if(!/^mod$/i.test(o))throw new Error("Unrecognized modifier name: "+o);Mo?r=!0:n=!0}}return t&&(o="Alt-"+o),n&&(o="Ctrl-"+o),r&&(o="Meta-"+o),i&&(o="Shift-"+o),o}function Co(e,t,n){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==n&&t.shiftKey&&(e="Shift-"+e),e}function Do(e){let t=function(e){let t=Object.create(null);for(let n in e)t[Oo(n)]=e[n];return t}(e);return function(e,n){let i,r=So(n),s=1==r.length&&" "!=r,o=t[Co(r,n,!s)];if(o&&o(e.state,e.dispatch,e))return!0;if(s&&(n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(i=mo[n.keyCode])&&i!=r){let r=t[Co(i,n,!0)];if(r&&r(e.state,e.dispatch,e))return!0}else if(s&&n.shiftKey){let i=t[Co(r,n,!0)];if(i&&i(e.state,e.dispatch,e))return!0}return!1}}const To=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function No(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const Eo=(e,t,n)=>{let i=No(e,n);if(!i)return!1;let r=Ro(i);if(!r){let n=i.blockRange(),r=n&&gn(n);return null!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let s=r.nodeBefore;if(!s.type.spec.isolating&&Ko(e,r,t))return!0;if(0==i.parent.content.size&&(Ao(s,"end")||qn.isSelectable(s))){let n=Sn(e.doc,i.before(),i.after(),tt.empty);if(n&&n.slice.size<n.to-n.from){if(t){let i=e.tr.step(n);i.setSelection(Ao(s,"end")?Vn.findFrom(i.doc.resolve(i.mapping.map(r.pos,-1)),-1):qn.create(i.doc,r.pos-s.nodeSize)),t(i.scrollIntoView())}return!0}}return!(!s.isAtom||r.depth!=i.depth-1)&&(t&&t(e.tr.delete(r.pos-s.nodeSize,r.pos).scrollIntoView()),!0)};function Ao(e,t,n=!1){for(let i=e;i;i="start"==t?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(n&&1!=i.childCount)return!1}return!1}const Io=(e,t,n)=>{let{$head:i,empty:r}=e.selection,s=i;if(!r)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):i.parentOffset>0)return!1;s=Ro(i)}let o=s&&s.nodeBefore;return!(!o||!qn.isSelectable(o))&&(t&&t(e.tr.setSelection(qn.create(e.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function Ro(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function Bo(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const Po=(e,t,n)=>{let i=Bo(e,n);if(!i)return!1;let r=Lo(i);if(!r)return!1;let s=r.nodeAfter;if(Ko(e,r,t))return!0;if(0==i.parent.content.size&&(Ao(s,"start")||qn.isSelectable(s))){let n=Sn(e.doc,i.before(),i.after(),tt.empty);if(n&&n.slice.size<n.to-n.from){if(t){let i=e.tr.step(n);i.setSelection(Ao(s,"start")?Vn.findFrom(i.doc.resolve(i.mapping.map(r.pos)),1):qn.create(i.doc,i.mapping.map(r.pos))),t(i.scrollIntoView())}return!0}}return!(!s.isAtom||r.depth!=i.depth-1)&&(t&&t(e.tr.delete(r.pos,r.pos+s.nodeSize).scrollIntoView()),!0)},$o=(e,t,n)=>{let{$head:i,empty:r}=e.selection,s=i;if(!r)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):i.parentOffset<i.parent.content.size)return!1;s=Lo(i)}let o=s&&s.nodeAfter;return!(!o||!qn.isSelectable(o))&&(t&&t(e.tr.setSelection(qn.create(e.doc,s.pos)).scrollIntoView()),!0)};function Lo(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const Vo=(e,t)=>{let{$from:n,$to:i}=e.selection,r=n.blockRange(i),s=r&&gn(r);return null!=s&&(t&&t(e.tr.lift(r,s).scrollIntoView()),!0)},zo=(e,t)=>{let{$head:n,$anchor:i}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(i))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function Fo(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Ho=(e,t)=>{let{$head:n,$anchor:i}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(i))return!1;let r=n.node(-1),s=n.indexAfter(-1),o=Fo(r.contentMatchAt(s));if(!o||!r.canReplaceWith(s,s,o))return!1;if(t){let i=n.after(),r=e.tr.replaceWith(i,i,o.createAndFill());r.setSelection(Vn.near(r.doc.resolve(i),1)),t(r.scrollIntoView())}return!0},jo=(e,t)=>{let n=e.selection,{$from:i,$to:r}=n;if(n instanceof Kn||i.parent.inlineContent||r.parent.inlineContent)return!1;let s=Fo(r.parent.contentMatchAt(r.indexAfter()));if(!s||!s.isTextblock)return!1;if(t){let n=(!i.parentOffset&&r.index()<r.parent.childCount?i:r).pos,o=e.tr.insert(n,s.createAndFill());o.setSelection(jn.create(o.doc,n+1)),t(o.scrollIntoView())}return!0},Wo=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(vn(e.doc,i))return t&&t(e.tr.split(i).scrollIntoView()),!0}let i=n.blockRange(),r=i&&gn(i);return null!=r&&(t&&t(e.tr.lift(i,r).scrollIntoView()),!0)},qo=(e,t)=>{let{$from:n,$to:i}=e.selection;if(e.selection instanceof qn&&e.selection.node.isBlock)return!(!n.parentOffset||!vn(e.doc,n.pos))&&(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(t){let r=i.parentOffset==i.parent.content.size,s=e.tr;(e.selection instanceof jn||e.selection instanceof Kn)&&s.deleteSelection();let o=0==n.depth?null:Fo(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=r&&o?[{type:o}]:void 0,l=vn(s.doc,s.mapping.map(n.pos),1,a);if(a||l||!vn(s.doc,s.mapping.map(n.pos),1,o?[{type:o}]:void 0)||(o&&(a=[{type:o}]),l=!0),l&&(s.split(s.mapping.map(n.pos),1,a),!r&&!n.parentOffset&&n.parent.type!=o)){let e=s.mapping.map(n.before()),t=s.doc.resolve(e);o&&n.node(-1).canReplaceWith(t.index(),t.index()+1,o)&&s.setNodeMarkup(s.mapping.map(n.before()),o)}t(s.scrollIntoView())}return!0},Jo=(e,t)=>{let n,{$from:i,to:r}=e.selection,s=i.sharedDepth(r);return 0!=s&&(n=i.before(s),t&&t(e.tr.setSelection(qn.create(e.doc,n))),!0)};function Ko(e,t,n){let i,r,s=t.nodeBefore,o=t.nodeAfter;if(s.type.spec.isolating||o.type.spec.isolating)return!1;if(function(e,t,n){let i=t.nodeBefore,r=t.nodeAfter,s=t.index();return!(!(i&&r&&i.type.compatibleContent(r.type))||(!i.content.size&&t.parent.canReplace(s-1,s)?(n&&n(e.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(s,s+1)||!r.isTextblock&&!bn(e.doc,t.pos)||(n&&n(e.tr.clearIncompatible(t.pos,i.type,i.contentMatchAt(i.childCount)).join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let a=t.parent.canReplace(t.index(),t.index()+1);if(a&&(i=(r=s.contentMatchAt(s.childCount)).findWrapping(o.type))&&r.matchType(i[0]||o.type).validEnd){if(n){let r=t.pos+o.nodeSize,a=Ye.empty;for(let e=i.length-1;e>=0;e--)a=Ye.from(i[e].create(null,a));a=Ye.from(s.copy(a));let l=e.tr.step(new un(t.pos-1,r,t.pos,r,new tt(a,1,0),i.length,!0)),c=r+2*i.length;bn(l.doc,c)&&l.join(c),n(l.scrollIntoView())}return!0}let l=Vn.findFrom(t,1),c=l&&l.$from.blockRange(l.$to),d=c&&gn(c);if(null!=d&&d>=t.depth)return n&&n(e.tr.lift(c,d).scrollIntoView()),!0;if(a&&Ao(o,"start",!0)&&Ao(s,"end")){let i=s,r=[];for(;r.push(i),!i.isTextblock;)i=i.lastChild;let a=o,l=1;for(;!a.isTextblock;a=a.firstChild)l++;if(i.canReplace(i.childCount,i.childCount,a.content)){if(n){let i=Ye.empty;for(let e=r.length-1;e>=0;e--)i=Ye.from(r[e].copy(i));n(e.tr.step(new un(t.pos-r.length,t.pos+o.nodeSize,t.pos+l,t.pos+o.nodeSize-l,new tt(i,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function _o(e){return function(t,n){let i=t.selection,r=e<0?i.$from:i.$to,s=r.depth;for(;r.node(s).isInline;){if(!s)return!1;s--}return!!r.node(s).isTextblock&&(n&&n(t.tr.setSelection(jn.create(t.doc,e<0?r.start(s):r.end(s)))),!0)}}const Uo=_o(-1),Yo=_o(1);function Go(e,t=null){return function(n,i){let{$from:r,$to:s}=n.selection,o=r.blockRange(s),a=o&&yn(o,e,t);return!!a&&(i&&i(n.tr.wrap(o,a).scrollIntoView()),!0)}}function Xo(e,t=null){return function(n,i){let r=!1;for(let i=0;i<n.selection.ranges.length&&!r;i++){let{$from:{pos:s},$to:{pos:o}}=n.selection.ranges[i];n.doc.nodesBetween(s,o,((i,s)=>{if(r)return!1;if(i.isTextblock&&!i.hasMarkup(e,t))if(i.type==e)r=!0;else{let t=n.doc.resolve(s),i=t.index();r=t.parent.canReplaceWith(i,i+1,e)}}))}if(!r)return!1;if(i){let r=n.tr;for(let i=0;i<n.selection.ranges.length;i++){let{$from:{pos:s},$to:{pos:o}}=n.selection.ranges[i];r.setBlockType(s,o,e,t)}i(r.scrollIntoView())}return!0}}function Zo(...e){return function(t,n,i){for(let r=0;r<e.length;r++)if(e[r](t,n,i))return!0;return!1}}let Qo=Zo(To,Eo,Io),ea=Zo(To,Po,$o);const ta={Enter:Zo(zo,jo,Wo,qo),"Mod-Enter":Ho,Backspace:Qo,"Mod-Backspace":Qo,"Shift-Backspace":Qo,Delete:ea,"Mod-Delete":ea,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new Kn(e.doc))),!0)},na={"Ctrl-h":ta.Backspace,"Alt-Backspace":ta["Mod-Backspace"],"Ctrl-d":ta.Delete,"Ctrl-Alt-Backspace":ta["Mod-Delete"],"Alt-Delete":ta["Mod-Delete"],"Alt-d":ta["Mod-Delete"],"Ctrl-a":Uo,"Ctrl-e":Yo};for(let e in ta)na[e]=ta[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&os.platform();function ia(e,t=null){return function(n,i){let{$from:r,$to:s}=n.selection,o=r.blockRange(s),a=!1,l=o;if(!o)return!1;if(o.depth>=2&&r.node(o.depth-1).type.compatibleContent(e)&&0==o.startIndex){if(0==r.index(o.depth-1))return!1;let e=n.doc.resolve(o.start-2);l=new yt(e,e,o.depth),o.endIndex<o.parent.childCount&&(o=new yt(r,n.doc.resolve(s.end(o.depth)),o.depth)),a=!0}let c=yn(l,e,t,o);return!!c&&(i&&i(function(e,t,n,i,r){let s=Ye.empty;for(let e=n.length-1;e>=0;e--)s=Ye.from(n[e].type.create(n[e].attrs,s));e.step(new un(t.start-(i?2:0),t.end,t.start,t.end,new tt(s,0,0),n.length,!0));let o=0;for(let e=0;e<n.length;e++)n[e].type==r&&(o=e+1);let a=n.length-o,l=t.start+n.length-(i?2:0),c=t.parent;for(let n=t.startIndex,i=t.endIndex,r=!0;n<i;n++,r=!1)!r&&vn(e.doc,l,a)&&(e.split(l,a),l+=2*a),l+=c.child(n).nodeSize;return e}(n.tr,o,c,a,e).scrollIntoView()),!0)}}function ra(e){return function(t,n){let{$from:i,$to:r}=t.selection,s=i.blockRange(r,(t=>t.childCount>0&&t.firstChild.type==e));return!!s&&(!n||(i.node(s.depth-1).type==e?function(e,t,n,i){let r=e.tr,s=i.end,o=i.$to.end(i.depth);s<o&&(r.step(new un(s-1,o,s,o,new tt(Ye.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new yt(r.doc.resolve(i.$from.pos),r.doc.resolve(o),i.depth));const a=gn(i);if(null==a)return!1;r.lift(i,a);let l=r.mapping.map(s,-1)-1;bn(r.doc,l)&&r.join(l);return t(r.scrollIntoView()),!0}(t,n,e,s):function(e,t,n){let i=e.tr,r=n.parent;for(let e=n.end,t=n.endIndex-1,s=n.startIndex;t>s;t--)e-=r.child(t).nodeSize,i.delete(e-1,e+1);let s=i.doc.resolve(n.start),o=s.nodeAfter;if(i.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==r.childCount,c=s.node(-1),d=s.index(-1);if(!c.canReplace(d+(a?0:1),d+1,o.content.append(l?Ye.empty:Ye.from(r))))return!1;let h=s.pos,p=h+o.nodeSize;return i.step(new un(h-(a?1:0),p+(l?1:0),h+1,p-1,new tt((a?Ye.empty:Ye.from(r.copy(Ye.empty))).append(l?Ye.empty:Ye.from(r.copy(Ye.empty))),a?0:1,l?0:1),a?0:1)),t(i.scrollIntoView()),!0}(t,n,s)))}}function sa(e){const{state:t,transaction:n}=e;let{selection:i}=n,{doc:r}=n,{storedMarks:s}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),filterTransaction:t.filterTransaction,plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return s},get selection(){return i},get doc(){return r},get tr(){return i=n.selection,r=n.doc,s=n.storedMarks,n}}}class oa{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:r}=n,s=this.buildProps(r);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const n=t(...e)(s);return r.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(r),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:r}=this,{view:s}=i,o=[],a=!!e,l=e||r.tr,c={...Object.fromEntries(Object.entries(n).map((([e,n])=>[e,(...e)=>{const i=this.buildProps(l,t),r=n(...e)(i);return o.push(r),c}]))),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||s.dispatch(l),o.every((e=>!0===e)))};return c}createCan(e){const{rawCommands:t,state:n}=this,i=e||n.tr,r=this.buildProps(i,false);return{...Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...r,dispatch:void 0})]))),chain:()=>this.createChain(i,false)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:r}=this,{view:s}=i;r.storedMarks&&e.setStoredMarks(r.storedMarks);const o={tr:e,editor:i,view:s,state:sa({state:r,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(o)])))}};return o}}function aa(e,t,n){if(void 0===e.config[t]&&e.parent)return aa(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?aa(e.parent,t,n):null})}return e.config[t]}function la(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function ca(e){const t=[],{nodeExtensions:n,markExtensions:i}=la(e),r=[...n,...i],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach((e=>{const n=aa(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage});if(!n)return;n().forEach((e=>{e.types.forEach((n=>{Object.entries(e.attributes).forEach((([e,i])=>{t.push({type:n,name:e,attribute:{...s,...i}})}))}))}))})),r.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},i=aa(e,"addAttributes",n);if(!i)return;const r=i();Object.entries(r).forEach((([n,i])=>{const r={...s,...i};(null==i?void 0:i.isRequired)&&void 0===(null==i?void 0:i.default)&&delete r.default,t.push({type:e.name,name:n,attribute:r})}))})),t}function da(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function ha(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{n[e]?n[e]="class"===e?[n[e],t].join(" "):"style"===e?[n[e],t].join("; "):t:n[e]=t})),n}),{})}function pa(e,t){return t.filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>ha(e,t)),{})}function ua(e){return"function"==typeof e}function fa(e,t,...n){return ua(e)?t?e.bind(t)(...n):e(...n):e}function ma(e,t){return e.style?e:{...e,getAttrs:n=>{const i=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===i)return!1;const r=t.reduce(((e,t)=>{const i=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==i?e:{...e,[t.name]:i}}),{});return{...i,...r}}}}function ga(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t)))}function ya(e){var t;const n=ca(e),{nodeExtensions:i,markExtensions:r}=la(e),s=null===(t=i.find((e=>aa(e,"topNode"))))||void 0===t?void 0:t.name,o=Object.fromEntries(i.map((t=>{const i=n.filter((e=>e.type===t.name)),r={name:t.name,options:t.options,storage:t.storage},s=ga({...e.reduce(((e,n)=>{const i=aa(n,"extendNodeSchema",r);return{...e,...i?i(t):{}}}),{}),content:fa(aa(t,"content",r)),marks:fa(aa(t,"marks",r)),group:fa(aa(t,"group",r)),inline:fa(aa(t,"inline",r)),atom:fa(aa(t,"atom",r)),selectable:fa(aa(t,"selectable",r)),draggable:fa(aa(t,"draggable",r)),code:fa(aa(t,"code",r)),defining:fa(aa(t,"defining",r)),isolating:fa(aa(t,"isolating",r)),attrs:Object.fromEntries(i.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),o=fa(aa(t,"parseHTML",r));o&&(s.parseDOM=o.map((e=>ma(e,i))));const a=aa(t,"renderHTML",r);a&&(s.toDOM=e=>a({node:e,HTMLAttributes:pa(e,i)}));const l=aa(t,"renderText",r);return l&&(s.toText=l),[t.name,s]}))),a=Object.fromEntries(r.map((t=>{const i=n.filter((e=>e.type===t.name)),r={name:t.name,options:t.options,storage:t.storage},s=ga({...e.reduce(((e,n)=>{const i=aa(n,"extendMarkSchema",r);return{...e,...i?i(t):{}}}),{}),inclusive:fa(aa(t,"inclusive",r)),excludes:fa(aa(t,"excludes",r)),group:fa(aa(t,"group",r)),spanning:fa(aa(t,"spanning",r)),code:fa(aa(t,"code",r)),attrs:Object.fromEntries(i.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),o=fa(aa(t,"parseHTML",r));o&&(s.parseDOM=o.map((e=>ma(e,i))));const a=aa(t,"renderHTML",r);return a&&(s.toDOM=e=>a({mark:e,HTMLAttributes:pa(e,i)})),[t.name,s]})));return new Lt({topNode:s,nodes:o,marks:a})}function wa(e,t){return t.nodes[e]||t.marks[e]||null}function va(e,t){return Array.isArray(t)?t.some((t=>("string"==typeof t?t:t.name)===e.name)):t}function ba(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class ka{constructor(e){this.find=e.find,this.handler=e.handler}}function xa(e){var t;const{editor:n,from:i,to:r,text:s,rules:o,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(i);if(c.parent.type.spec.code||(null===(t=c.nodeBefore||c.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let d=!1;const h=((e,t=500)=>{let n="";const i=e.parentOffset;return e.parent.nodesBetween(Math.max(0,i-t),i,((e,t,r,s)=>{var o,a;const l=(null===(a=(o=e.type.spec).toText)||void 0===a?void 0:a.call(o,{node:e,pos:t,parent:r,index:s}))||e.textContent||"%leaf%";n+=l.slice(0,Math.max(0,i-t))})),n})(c)+s;return o.forEach((e=>{if(d)return;const t=((e,t)=>{if(ba(t))return t.exec(e);const n=t(e);if(!n)return null;const i=[];return i.push(n.text),i.index=n.index,i.input=e,i.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),i.push(n.replaceWith)),i})(h,e.find);if(!t)return;const o=l.state.tr,c=sa({state:l.state,transaction:o}),p={from:i-(t[0].length-s.length),to:r},{commands:u,chain:f,can:m}=new oa({editor:n,state:c});null!==e.handler({state:c,range:p,match:t,commands:u,chain:f,can:m})&&o.steps.length&&(o.setMeta(a,{transform:o,from:i,to:r,text:s}),l.dispatch(o),d=!0)})),d}function Sa(e){const{editor:t,rules:n}=e,i=new ii({state:{init:()=>null,apply(e,t){const n=e.getMeta(i);return n||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput:(e,r,s,o)=>xa({editor:t,from:r,to:s,text:o,rules:n,plugin:i}),handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:r}=e.state.selection;r&&xa({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:i})})),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;const{$cursor:s}=e.state.selection;return!!s&&xa({editor:t,from:s.pos,to:s.pos,text:"\n",rules:n,plugin:i})}},isInputRules:!0});return i}class Ma{constructor(e){this.find=e.find,this.handler=e.handler}}function Oa(e){const{editor:t,state:n,from:i,to:r,rule:s}=e,{commands:o,chain:a,can:l}=new oa({editor:t,state:n}),c=[];n.doc.nodesBetween(i,r,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const d=Math.max(i,t),h=Math.min(r,t+e.content.size);((e,t)=>{if(ba(t))return[...e.matchAll(t)];const n=t(e);return n?n.map((t=>{const n=[];return n.push(t.text),n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n})):[]})(e.textBetween(d-t,h-t,void 0,"￼"),s.find).forEach((e=>{if(void 0===e.index)return;const t=d+e.index+1,i=t+e[0].length,r={from:n.tr.mapping.map(t),to:n.tr.mapping.map(i)},h=s.handler({state:n,range:r,match:e,commands:o,chain:a,can:l});c.push(h)}))}));return c.every((e=>null!==e))}function Ca(e){const{editor:t,rules:n}=e;let i=null,r=!1,s=!1;return n.map((e=>new ii({view(e){const t=t=>{var n;i=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:e=>(s=i===e.dom.parentElement,!1),paste:(e,t)=>{var n;const i=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return r=!!(null==i?void 0:i.includes("data-pm-slice")),!1}}},appendTransaction:(n,i,o)=>{const a=n[0],l="paste"===a.getMeta("uiEvent")&&!r,c="drop"===a.getMeta("uiEvent")&&!s;if(!l&&!c)return;const d=i.doc.content.findDiffStart(o.doc.content),h=i.doc.content.findDiffEnd(o.doc.content);if("number"!=typeof d||!h||d===h.b)return;const p=o.tr,u=sa({state:o,transaction:p});return Oa({editor:t,state:u,from:Math.max(d-1,0),to:h.b-1,rule:e})&&p.steps.length?p:void 0}})))}class Da{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Da.resolve(e),this.schema=ya(this.extensions),this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:wa(e.name,this.schema)};if("mark"===e.type){(null===(t=fa(aa(e,"keepOnSplit",n)))||void 0===t||t)&&this.splittableMarks.push(e.name)}const i=aa(e,"onBeforeCreate",n);i&&this.editor.on("beforeCreate",i);const r=aa(e,"onCreate",n);r&&this.editor.on("create",r);const s=aa(e,"onUpdate",n);s&&this.editor.on("update",s);const o=aa(e,"onSelectionUpdate",n);o&&this.editor.on("selectionUpdate",o);const a=aa(e,"onTransaction",n);a&&this.editor.on("transaction",a);const l=aa(e,"onFocus",n);l&&this.editor.on("focus",l);const c=aa(e,"onBlur",n);c&&this.editor.on("blur",c);const d=aa(e,"onDestroy",n);d&&this.editor.on("destroy",d)}))}static resolve(e){const t=Da.sort(Da.flatten(e)),n=function(e){const t=e.filter(((t,n)=>e.indexOf(t)!==n));return[...new Set(t)]}(t.map((e=>e.name)));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map((e=>`'${e}'`)).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map((e=>{const t=aa(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...this.flatten(t())]:e})).flat(10)}static sort(e){return e.sort(((e,t)=>{const n=aa(e,"priority")||100,i=aa(t,"priority")||100;return n>i?-1:n<i?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const n=aa(t,"addCommands",{name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:wa(t.name,this.schema)});return n?{...e,...n()}:e}),{})}get plugins(){const{editor:e}=this,t=Da.sort([...this.extensions].reverse()),n=[],i=[],r=t.map((t=>{const r={name:t.name,options:t.options,storage:t.storage,editor:e,type:wa(t.name,this.schema)},s=[],o=aa(t,"addKeyboardShortcuts",r);let a={};if("mark"===t.type&&t.config.exitable&&(a.ArrowRight=()=>vl.handleExit({editor:e,mark:t})),o){const t=Object.fromEntries(Object.entries(o()).map((([t,n])=>[t,()=>n({editor:e})])));a={...a,...t}}const l=new ii({props:{handleKeyDown:Do(a)}});s.push(l);const c=aa(t,"addInputRules",r);va(t,e.options.enableInputRules)&&c&&n.push(...c());const d=aa(t,"addPasteRules",r);va(t,e.options.enablePasteRules)&&d&&i.push(...d());const h=aa(t,"addProseMirrorPlugins",r);if(h){const e=h();s.push(...e)}return s})).flat();return[Sa({editor:e,rules:n}),...Ca({editor:e,rules:i}),...r]}get attributes(){return ca(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=la(this.extensions);return Object.fromEntries(t.filter((e=>!!aa(e,"addNodeView"))).map((t=>{const n=this.attributes.filter((e=>e.type===t.name)),i={name:t.name,options:t.options,storage:t.storage,editor:e,type:da(t.name,this.schema)},r=aa(t,"addNodeView",i);if(!r)return[];return[t.name,(i,s,o,a)=>{const l=pa(i,n);return r()({editor:e,node:i,getPos:o,decorations:a,HTMLAttributes:l,extension:t})}]})))}}function Ta(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Na(e,t){const n={...e};return Ta(e)&&Ta(t)&&Object.keys(t).forEach((i=>{Ta(t[i])?i in e?n[i]=Na(e[i],t[i]):Object.assign(n,{[i]:t[i]}):Object.assign(n,{[i]:t[i]})})),n}class Ea{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fa(aa(this,"addOptions",{name:this.name}))),this.storage=fa(aa(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ea(e)}configure(e={}){const t=this.extend();return t.options=Na(this.options,e),t.storage=fa(aa(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Ea(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fa(aa(t,"addOptions",{name:t.name})),t.storage=fa(aa(t,"addStorage",{name:t.name,options:t.options})),t}}function Aa(e,t,n){const{from:i,to:r}=t,{blockSeparator:s="\n\n",textSerializers:o={}}=n||{};let a="",l=!0;return e.nodesBetween(i,r,((e,n,c,d)=>{var h;const p=null==o?void 0:o[e.type.name];p?(e.isBlock&&!l&&(a+=s,l=!0),c&&(a+=p({node:e,pos:n,parent:c,index:d,range:t}))):e.isText?(a+=null===(h=null==e?void 0:e.text)||void 0===h?void 0:h.slice(Math.max(i,n)-n,r-n),l=!1):e.isBlock&&!l&&(a+=s,l=!0)})),a}function Ia(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const Ra=Ea.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new ii({key:new oi("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:i,selection:r}=t,{ranges:s}=r,o=Math.min(...s.map((e=>e.$from.pos))),a=Math.max(...s.map((e=>e.$to.pos)));return Aa(i,{from:o,to:a},{textSerializers:Ia(n)})}}})]}});function Ba(e,t,n={strict:!0}){const i=Object.keys(t);return!i.length||i.every((i=>n.strict?t[i]===e[i]:ba(t[i])?t[i].test(e[i]):t[i]===e[i]))}function Pa(e,t,n={}){return e.find((e=>e.type===t&&Ba(e.attrs,n)))}function $a(e,t,n={}){return!!Pa(e,t,n)}function La(e,t,n={}){if(!e||!t)return;let i=e.parent.childAfter(e.parentOffset);if(e.parentOffset===i.offset&&0!==i.offset&&(i=e.parent.childBefore(e.parentOffset)),!i.node)return;const r=Pa([...i.node.marks],t,n);if(!r)return;let s=i.index,o=e.start()+i.offset,a=s+1,l=o+i.node.nodeSize;for(Pa([...i.node.marks],t,n);s>0&&r.isInSet(e.parent.child(s-1).marks);)s-=1,o-=e.parent.child(s).nodeSize;for(;a<e.parent.childCount&&$a([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:o,to:l}}function Va(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function za(e){return e instanceof jn}function Fa(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function Ha(e,t=null){if(!t)return null;const n=Vn.atStart(e),i=Vn.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return i;const r=n.from,s=i.to;return"all"===t?jn.create(e,Fa(0,r,s),Fa(e.content.size,r,s)):jn.create(e,Fa(t,r,s),Fa(t,r,s))}function ja(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Wa(e){const t=`<body>${e}</body>`;return(new window.DOMParser).parseFromString(t,"text/html").body}function qa(e,t,n){if(n={slice:!0,parseOptions:{},...n},"object"==typeof e&&null!==e)try{return Array.isArray(e)?Ye.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(i){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",i),qa("",t,n)}if("string"==typeof e){const i=zt.fromSchema(t);return n.slice?i.parseSlice(Wa(e),n.parseOptions).content:i.parse(Wa(e),n.parseOptions)}return qa("",t,n)}function Ja(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function Ka(e,t,n={}){const{from:i,to:r,empty:s}=e.selection,o=t?da(t,e.schema):null,a=[];e.doc.nodesBetween(i,r,((e,t)=>{if(e.isText)return;const n=Math.max(i,t),s=Math.min(r,t+e.nodeSize);a.push({node:e,from:n,to:s})}));const l=r-i,c=a.filter((e=>!o||o.name===e.node.type.name)).filter((e=>Ba(e.node.attrs,n,{strict:!1})));if(s)return!!c.length;return c.reduce(((e,t)=>e+t.to-t.from),0)>=l}function _a(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Ua(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,i)=>(n.includes(i)||(t[i]=e[i]),t)),{})}function Ya(e,t,n={}){return qa(e,t,{slice:!1,parseOptions:n})}function Ga(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}}(t.$from,e)}function Xa(e,t){const n=Yt.fromSchema(t).serializeFragment(e),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function Za(e,t){return Aa(e,{from:0,to:e.content.size},t)}function Qa(e,t){const n=Va(t,e.schema),{from:i,to:r,empty:s}=e.selection,o=[];s?(e.storedMarks&&o.push(...e.storedMarks),o.push(...e.selection.$head.marks())):e.doc.nodesBetween(i,r,(e=>{o.push(...e.marks)}));const a=o.find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}function el(e,t){const n=_a("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=da(t,e.schema),{from:i,to:r}=e.selection,s=[];e.doc.nodesBetween(i,r,(e=>{s.push(e)}));const o=s.reverse().find((e=>e.type.name===n.name));return o?{...o.attrs}:{}}(e,t):"mark"===n?Qa(e,t):{}}function tl(e,t,n){const i=[];return e===t?n.resolve(e).marks().forEach((t=>{const r=La(n.resolve(e-1),t.type);r&&i.push({mark:t,...r})})):n.nodesBetween(e,t,((e,t)=>{i.push(...e.marks.map((n=>({from:t,to:t+e.nodeSize,mark:n}))))})),i}function nl(e,t,n={}){const{empty:i,ranges:r}=e.selection,s=t?Va(t,e.schema):null;if(i)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!s||s.name===e.type.name)).find((e=>Ba(e.attrs,n,{strict:!1})));let o=0;const a=[];if(r.forEach((({$from:t,$to:n})=>{const i=t.pos,r=n.pos;e.doc.nodesBetween(i,r,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(i,t),s=Math.min(r,t+e.nodeSize);o+=s-n,a.push(...e.marks.map((e=>({mark:e,from:n,to:s}))))}))})),0===o)return!1;const l=a.filter((e=>!s||s.name===e.mark.type.name)).filter((e=>Ba(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),c=a.filter((e=>!s||e.mark.type!==s&&e.mark.type.excludes(s))).reduce(((e,t)=>e+t.to-t.from),0);return(l>0?l+c:l)>=o}function il(e,t){const{nodeExtensions:n}=la(t),i=n.find((t=>t.name===e));if(!i)return!1;const r=fa(aa(i,"group",{name:i.name,options:i.options,storage:i.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function rl(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const i=e.find((e=>e.type===t&&e.name===n));return!!i&&i.attribute.keepOnSplit})))}function sl(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const i=n.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(i)}}const ol=(e,t)=>{const n=Ga((e=>e.type===t))(e.selection);if(!n)return!0;const i=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===i)return!0;const r=e.doc.nodeAt(i);return n.node.type!==(null==r?void 0:r.type)||!bn(e.doc,n.pos)||(e.join(n.pos),!0)},al=(e,t)=>{const n=Ga((e=>e.type===t))(e.selection);if(!n)return!0;const i=e.doc.resolve(n.start).after(n.depth);if(void 0===i)return!0;const r=e.doc.nodeAt(i);return n.node.type!==(null==r?void 0:r.type)||!bn(e.doc,i)||(e.join(i),!0)};var ll=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:n})=>{const{selection:i}=t,{ranges:r}=i;return!n||(r.forEach((({$from:n,$to:i})=>{e.doc.nodesBetween(n.pos,i.pos,((e,n)=>{if(e.type.isText)return;const{doc:i,mapping:r}=t,s=i.resolve(r.map(n)),o=i.resolve(r.map(n+e.nodeSize)),a=s.blockRange(o);if(!a)return;const l=gn(a);if(e.type.isTextblock){const{defaultType:e}=s.parent.contentMatchAt(s.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)}))})),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>jo(e,t),deleteNode:e=>({tr:t,state:n,dispatch:i})=>{const r=da(e,n.schema),s=t.selection.$anchor;for(let e=s.depth;e>0;e-=1){if(s.node(e).type===r){if(i){const n=s.before(e),i=s.after(e);t.delete(n,i).scrollIntoView()}return!0}}return!1},deleteRange:e=>({tr:t,dispatch:n})=>{const{from:i,to:r}=e;return n&&t.delete(i,r),!0},deleteSelection:()=>({state:e,dispatch:t})=>To(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>Ho(e,t),extendMarkRange:(e,t={})=>({tr:n,state:i,dispatch:r})=>{const s=Va(e,i.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:d}=a;if(r){const e=La(l,s,t);if(e&&e.from<=c&&e.to>=d){const t=jn.create(o,e.from,e.to);n.setSelection(t)}}return!0},first:e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:n,view:i,tr:r,dispatch:s})=>{t={scrollIntoView:!0,...t};const o=()=>{ja()&&i.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(i.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(i.hasFocus()&&null===e||!1===e)return!0;if(s&&null===e&&!za(n.state.selection))return o(),!0;const a=Ha(r.doc,e)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),o()),!0},forEach:(e,t)=>n=>e.every(((e,i)=>t(e,{...n,index:i}))),insertContent:(e,t)=>({tr:n,commands:i})=>i.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),insertContentAt:(e,t,n)=>({tr:i,dispatch:r,editor:s})=>{if(r){n={parseOptions:{},updateSelection:!0,...n};const r=qa(t,s.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===r.toString())return!0;let{from:o,to:a}="number"==typeof e?{from:e,to:e}:e,l=!0,c=!0;if((r.toString().startsWith("<")?r:[r]).forEach((e=>{e.check(),l=!!l&&(e.isText&&0===e.marks.length),c=!!c&&e.isBlock})),o===a&&c){const{parent:e}=i.doc.resolve(o);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(o-=1,a+=1)}l?i.insertText(t,o,a):i.replaceWith(o,a,r),n.updateSelection&&function(e,t,n){const i=e.steps.length-1;if(i<t)return;const r=e.steps[i];if(!(r instanceof pn||r instanceof un))return;const s=e.mapping.maps[i];let o=0;s.forEach(((e,t,n,i)=>{0===o&&(o=i)})),e.setSelection(Vn.near(e.doc.resolve(o),n))}(i,i.steps.length-1,-1)}return!0},joinBackward:()=>({state:e,dispatch:t})=>Eo(e,t),joinForward:()=>({state:e,dispatch:t})=>Po(e,t),keyboardShortcut:e=>({editor:t,view:n,tr:i,dispatch:r})=>{const s=function(e){const t=e.split(/-(?!$)/);let n,i,r,s,o=t[t.length-1];"Space"===o&&(o=" ");for(let e=0;e<t.length-1;e+=1){const o=t[e];if(/^(cmd|meta|m)$/i.test(o))s=!0;else if(/^a(lt)?$/i.test(o))n=!0;else if(/^(c|ctrl|control)$/i.test(o))i=!0;else if(/^s(hift)?$/i.test(o))r=!0;else{if(!/^mod$/i.test(o))throw new Error(`Unrecognized modifier name: ${o}`);ja()||Ja()?s=!0:i=!0}}return n&&(o=`Alt-${o}`),i&&(o=`Ctrl-${o}`),s&&(o=`Meta-${o}`),r&&(o=`Shift-${o}`),o}(e).split(/-(?!$)/),o=s.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),a=new KeyboardEvent("keydown",{key:"Space"===o?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,a)))}));return null==l||l.steps.forEach((e=>{const t=e.map(i.mapping);t&&r&&i.maybeStep(t)})),!0},lift:(e,t={})=>({state:n,dispatch:i})=>!!Ka(n,da(e,n.schema),t)&&Vo(n,i),liftEmptyBlock:()=>({state:e,dispatch:t})=>Wo(e,t),liftListItem:e=>({state:t,dispatch:n})=>ra(da(e,t.schema))(t,n),newlineInCode:()=>({state:e,dispatch:t})=>zo(e,t),resetAttributes:(e,t)=>({tr:n,state:i,dispatch:r})=>{let s=null,o=null;const a=_a("string"==typeof e?e:e.name,i.schema);return!!a&&("node"===a&&(s=da(e,i.schema)),"mark"===a&&(o=Va(e,i.schema)),r&&n.selection.ranges.forEach((e=>{i.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,i)=>{s&&s===e.type&&n.setNodeMarkup(i,void 0,Ua(e.attrs,t)),o&&e.marks.length&&e.marks.forEach((r=>{o===r.type&&n.addMark(i,i+e.nodeSize,o.create(Ua(r.attrs,t)))}))}))})),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>Io(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>$o(e,t),selectParentNode:()=>({state:e,dispatch:t})=>Jo(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>Yo(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>Uo(e,t),setContent:(e,t=!1,n={})=>({tr:i,editor:r,dispatch:s})=>{const{doc:o}=i,a=Ya(e,r.schema,n);return s&&i.replaceWith(0,o.content.size,a).setMeta("preventUpdate",!t),!0},setMark:(e,t={})=>({tr:n,state:i,dispatch:r})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=Va(e,i.schema);if(r)if(o){const e=Qa(i,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach((e=>{const r=e.$from.pos,s=e.$to.pos;i.doc.nodesBetween(r,s,((e,i)=>{const o=Math.max(i,r),a=Math.min(i+e.nodeSize,s);e.marks.find((e=>e.type===l))?e.marks.forEach((e=>{l===e.type&&n.addMark(o,a,l.create({...e.attrs,...t}))})):n.addMark(o,a,l.create(t))}))}));return function(e,t,n){var i;const{selection:r}=t;let s=null;if(za(r)&&(s=r.$cursor),s){const t=null!==(i=e.storedMarks)&&void 0!==i?i:s.marks();return!!n.isInSet(t)||!t.some((e=>e.type.excludes(n)))}const{ranges:o}=r;return o.some((({$from:t,$to:i})=>{let r=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,i.pos,((e,t,i)=>{if(r)return!1;if(e.isInline){const t=!i||i.type.allowsMarkType(n),s=!!n.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(n)));r=t&&s}return!r})),r}))}(i,n,l)},setMeta:(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),setNode:(e,t={})=>({state:n,dispatch:i,chain:r})=>{const s=da(e,n.schema);return s.isTextblock?r().command((({commands:e})=>!!Xo(s,t)(n)||e.clearNodes())).command((({state:e})=>Xo(s,t)(e,i))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,i=Fa(e,0,n.content.size),r=qn.create(n,i);t.setSelection(r)}return!0},setTextSelection:e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:i,to:r}="number"==typeof e?{from:e,to:e}:e,s=jn.atStart(n).from,o=jn.atEnd(n).to,a=Fa(i,s,o),l=Fa(r,s,o),c=jn.create(n,a,l);t.setSelection(c)}return!0},sinkListItem:e=>({state:t,dispatch:n})=>{const i=da(e,t.schema);return(r=i,function(e,t){let{$from:n,$to:i}=e.selection,s=n.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==r));if(!s)return!1;let o=s.startIndex;if(0==o)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=r)return!1;if(t){let n=l.lastChild&&l.lastChild.type==a.type,i=Ye.from(n?r.create():null),o=new tt(Ye.from(r.create(null,Ye.from(a.type.create(null,i)))),n?3:1,0),c=s.start,d=s.end;t(e.tr.step(new un(c-(n?3:1),d,c,d,o,1,!0)).scrollIntoView())}return!0})(t,n);var r},splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:i,editor:r})=>{const{selection:s,doc:o}=t,{$from:a,$to:l}=s,c=rl(r.extensionManager.attributes,a.node().type.name,a.node().attrs);if(s instanceof qn&&s.node.isBlock)return!(!a.parentOffset||!vn(o,a.pos))&&(i&&(e&&sl(n,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(i){const i=l.parentOffset===l.parent.content.size;s instanceof jn&&t.deleteSelection();const o=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let d=i&&o?[{type:o,attrs:c}]:void 0,h=vn(t.doc,t.mapping.map(a.pos),1,d);if(d||h||!vn(t.doc,t.mapping.map(a.pos),1,o?[{type:o}]:void 0)||(h=!0,d=o?[{type:o,attrs:c}]:void 0),h&&(t.split(t.mapping.map(a.pos),1,d),o&&!i&&!a.parentOffset&&a.parent.type!==o)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,o)&&t.setNodeMarkup(t.mapping.map(a.before()),o)}e&&sl(n,r.extensionManager.splittableMarks),t.scrollIntoView()}return!0},splitListItem:e=>({tr:t,state:n,dispatch:i,editor:r})=>{var s;const o=da(e,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const d=a.node(-1);if(d.type!==o)return!1;const h=r.extensionManager.attributes;if(0===a.parent.content.size&&a.node(-1).childCount===a.indexAfter(-1)){if(2===a.depth||a.node(-3).type!==o||a.index(-2)!==a.node(-2).childCount-1)return!1;if(i){let e=Ye.empty;const n=a.index(-1)?1:a.index(-2)?2:3;for(let t=a.depth-n;t>=a.depth-3;t-=1)e=Ye.from(a.node(t).copy(e));const i=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,r=rl(h,a.node().type.name,a.node().attrs),l=(null===(s=o.contentMatch.defaultType)||void 0===s?void 0:s.createAndFill(r))||void 0;e=e.append(Ye.from(o.createAndFill(null,l)||void 0));const c=a.before(a.depth-(n-1));t.replace(c,a.after(-i),new tt(e,4-n,0));let d=-1;t.doc.nodesBetween(c,t.doc.content.size,((e,t)=>{if(d>-1)return!1;e.isTextblock&&0===e.content.size&&(d=t+1)})),d>-1&&t.setSelection(jn.near(t.doc.resolve(d))),t.scrollIntoView()}return!0}const p=l.pos===a.end()?d.contentMatchAt(0).defaultType:null,u=rl(h,d.type.name,d.attrs),f=rl(h,a.node().type.name,a.node().attrs);t.delete(a.pos,l.pos);const m=p?[{type:o,attrs:u},{type:p,attrs:f}]:[{type:o,attrs:u}];return!!vn(t.doc,a.pos,2)&&(i&&t.split(a.pos,2,m).scrollIntoView(),!0)},toggleList:(e,t)=>({editor:n,tr:i,state:r,dispatch:s,chain:o,commands:a,can:l})=>{const{extensions:c}=n.extensionManager,d=da(e,r.schema),h=da(t,r.schema),{selection:p}=r,{$from:u,$to:f}=p,m=u.blockRange(f);if(!m)return!1;const g=Ga((e=>il(e.type.name,c)))(p);if(m.depth>=1&&g&&m.depth-g.depth<=1){if(g.node.type===d)return a.liftListItem(h);if(il(g.node.type.name,c)&&d.validContent(g.node.content)&&s)return o().command((()=>(i.setNodeMarkup(g.pos,d),!0))).command((()=>ol(i,d))).command((()=>al(i,d))).run()}return o().command((()=>!!l().wrapInList(d)||a.clearNodes())).wrapInList(d).command((()=>ol(i,d))).command((()=>al(i,d))).run()},toggleMark:(e,t={},n={})=>({state:i,commands:r})=>{const{extendEmptyMarkRange:s=!1}=n,o=Va(e,i.schema);return nl(i,o,t)?r.unsetMark(o,{extendEmptyMarkRange:s}):r.setMark(o,t)},toggleNode:(e,t,n={})=>({state:i,commands:r})=>{const s=da(e,i.schema),o=da(t,i.schema);return Ka(i,s,n)?r.setNode(o):r.setNode(s,n)},toggleWrap:(e,t={})=>({state:n,commands:i})=>{const r=da(e,n.schema);return Ka(n,r,t)?i.lift(r):i.wrapIn(r,t)},undoInputRule:()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let i=0;i<n.length;i+=1){const r=n[i];let s;if(r.spec.isInputRules&&(s=r.getState(e))){if(t){const t=e.tr,n=s.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(s.text){const n=t.doc.resolve(s.from).marks();t.replaceWith(s.from,s.to,e.schema.text(s.text,n))}else t.delete(s.from,s.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:i,ranges:r}=n;return i||t&&r.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},unsetMark:(e,t={})=>({tr:n,state:i,dispatch:r})=>{var s;const{extendEmptyMarkRange:o=!1}=t,{selection:a}=n,l=Va(e,i.schema),{$from:c,empty:d,ranges:h}=a;if(!r)return!0;if(d&&o){let{from:e,to:t}=a;const i=null===(s=c.marks().find((e=>e.type===l)))||void 0===s?void 0:s.attrs,r=La(c,l,i);r&&(e=r.from,t=r.to),n.removeMark(e,t,l)}else h.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,l)}));return n.removeStoredMark(l),!0},updateAttributes:(e,t={})=>({tr:n,state:i,dispatch:r})=>{let s=null,o=null;const a=_a("string"==typeof e?e:e.name,i.schema);return!!a&&("node"===a&&(s=da(e,i.schema)),"mark"===a&&(o=Va(e,i.schema)),r&&n.selection.ranges.forEach((e=>{const r=e.$from.pos,a=e.$to.pos;i.doc.nodesBetween(r,a,((e,i)=>{s&&s===e.type&&n.setNodeMarkup(i,void 0,{...e.attrs,...t}),o&&e.marks.length&&e.marks.forEach((s=>{if(o===s.type){const l=Math.max(i,r),c=Math.min(i+e.nodeSize,a);n.addMark(l,c,o.create({...s.attrs,...t}))}}))}))})),!0)},wrapIn:(e,t={})=>({state:n,dispatch:i})=>Go(da(e,n.schema),t)(n,i),wrapInList:(e,t={})=>({state:n,dispatch:i})=>ia(da(e,n.schema),t)(n,i)});const cl=Ea.create({name:"commands",addCommands:()=>({...ll})}),dl=Ea.create({name:"editable",addProseMirrorPlugins(){return[new ii({key:new oi("editable"),props:{editable:()=>this.editor.options.editable}})]}}),hl=Ea.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new ii({key:new oi("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const i=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,n)=>{e.isFocused=!1;const i=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),pl=Ea.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:i}=t,{empty:r,$anchor:s}=n,{pos:o,parent:a}=s,l=Vn.atStart(i).from===o;return!(!(r&&l&&a.type.isTextblock)||a.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.joinForward(),()=>e.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},r={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ja()||Ja()?r:i},addProseMirrorPlugins(){return[new ii({key:new oi("clearDocument"),appendTransaction:(e,t,n)=>{if(!(e.some((e=>e.docChanged))&&!t.doc.eq(n.doc)))return;const{empty:i,from:r,to:s}=t.selection,o=Vn.atStart(t.doc).from,a=Vn.atEnd(t.doc).to,l=r===o&&s===a,c=0===n.doc.textBetween(0,n.doc.content.size," "," ").length;if(i||!l||!c)return;const d=n.tr,h=sa({state:n,transaction:d}),{commands:p}=new oa({editor:this.editor,state:h});return p.clearNodes(),d.steps.length?d:void 0}})]}}),ul=Ea.create({name:"tabindex",addProseMirrorPlugins(){return[new ii({key:new oi("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var fl=Object.freeze({__proto__:null,ClipboardTextSerializer:Ra,Commands:cl,Editable:dl,FocusEvents:hl,Keymap:pl,Tabindex:ul});class ml extends class{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e,t){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const i=document.createElement("style");return t&&i.setAttribute("nonce",t),i.setAttribute("data-tiptap-style",""),i.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(i),i}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e}),this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=ua(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:n});this.view.updateState(i)}unregisterPlugin(e){if(this.isDestroyed)return;const t="string"==typeof e?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((e=>!e.key.startsWith(t)))});this.view.updateState(n)}createExtensionManager(){const e=[...this.options.enableCoreExtensions?Object.values(fl):[],...this.options.extensions].filter((e=>["extension","node","mark"].includes(null==e?void 0:e.type)));this.extensionManager=new Da(e,this)}createCommandManager(){this.commandManager=new oa({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Ya(this.options.content,this.schema,this.options.parseOptions),t=Ha(e,this.options.autofocus);this.view=new lo(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:ti.create({doc:e,selection:t||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews();this.view.dom.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),r=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),r&&this.emit("blur",{editor:this,event:r.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return el(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,i="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return Ka(e,null,n)||nl(e,null,n);const i=_a(t,e.schema);return"node"===i?Ka(e,t,n):"mark"===i&&nl(e,t,n)}(this.state,n,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Xa(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return Za(this.state.doc,{blockSeparator:t,textSerializers:{...n,...Ia(this.schema)}})}get isEmpty(){return function(e){var t;const n=null===(t=e.type.createAndFill())||void 0===t?void 0:t.toJSON(),i=e.toJSON();return JSON.stringify(n)===JSON.stringify(i)}(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}}function gl(e){return new ka({find:e.find,handler:({state:t,range:n,match:i})=>{const r=fa(e.getAttributes,void 0,i);if(!1===r||null===r)return null;const{tr:s}=t,o=i[i.length-1],a=i[0];let l=n.to;if(o){const i=a.search(/\S/),c=n.from+a.indexOf(o),d=c+o.length;if(tl(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>c)).length)return null;d<n.to&&s.delete(d,n.to),c>n.from&&s.delete(n.from+i,c),l=n.from+i+o.length,s.addMark(n.from+i,l,e.type.create(r||{})),s.removeStoredMark(e.type)}}})}function yl(e){return new ka({find:e.find,handler:({state:t,range:n,match:i})=>{const r=t.doc.resolve(n.from),s=fa(e.getAttributes,void 0,i)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,s)}})}function wl(e){return new ka({find:e.find,handler:({state:t,range:n,match:i})=>{const r=fa(e.getAttributes,void 0,i)||{},s=t.tr.delete(n.from,n.to),o=s.doc.resolve(n.from).blockRange(),a=o&&yn(o,e.type,r);if(!a)return null;s.wrap(o,a);const l=s.doc.resolve(n.from-1).nodeBefore;l&&l.type===e.type&&bn(s.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(i,l))&&s.join(n.from-1)}})}class vl{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fa(aa(this,"addOptions",{name:this.name}))),this.storage=fa(aa(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new vl(e)}configure(e={}){const t=this.extend();return t.options=Na(this.options,e),t.storage=fa(aa(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new vl(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fa(aa(t,"addOptions",{name:t.name})),t.storage=fa(aa(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const r=i.marks();if(!!!r.find((e=>(null==e?void 0:e.type.name)===t.name)))return!1;const s=r.find((e=>(null==e?void 0:e.type.name)===t.name));return s&&n.removeStoredMark(s),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}}class bl{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=fa(aa(this,"addOptions",{name:this.name}))),this.storage=fa(aa(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new bl(e)}configure(e={}){const t=this.extend();return t.options=Na(this.options,e),t.storage=fa(aa(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new bl(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=fa(aa(t,"addOptions",{name:t.name})),t.storage=fa(aa(t,"addStorage",{name:t.name,options:t.options})),t}}function kl(e){return new Ma({find:e.find,handler:({state:t,range:n,match:i})=>{const r=fa(e.getAttributes,void 0,i);if(!1===r||null===r)return null;const{tr:s}=t,o=i[i.length-1],a=i[0];let l=n.to;if(o){const i=a.search(/\S/),c=n.from+a.indexOf(o),d=c+o.length;if(tl(n.from,n.to,t.doc).filter((t=>t.mark.type.excluded.find((n=>n===e.type&&n!==t.mark.type)))).filter((e=>e.to>c)).length)return null;d<n.to&&s.delete(d,n.to),c>n.from&&s.delete(n.from+i,c),l=n.from+i+o.length,s.addMark(n.from+i,l,e.type.create(r||{})),s.removeStoredMark(e.type)}}})}const xl=/^\s*>\s$/,Sl=bl.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return["blockquote",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[wl({find:xl,type:this.type})]}}),Ml=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,Ol=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,Cl=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,Dl=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,Tl=vl.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],renderHTML({HTMLAttributes:e}){return["strong",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[gl({find:Ml,type:this.type}),gl({find:Cl,type:this.type})]},addPasteRules(){return[kl({find:Ol,type:this.type}),kl({find:Dl,type:this.type})]}}),Nl=/^\s*([-+*])\s$/,El=bl.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[wl({find:Nl,type:this.type})]}}),Al=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,Il=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,Rl=vl.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[gl({find:Al,type:this.type})]},addPasteRules(){return[kl({find:Il,type:this.type})]}}),Bl=/^```([a-z]+)?[\s\n]$/,Pl=/^~~~([a-z]+)?[\s\n]$/,$l=bl.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,i=[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]].filter((e=>e.startsWith(n))).map((e=>e.replace(n,"")))[0];return i||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",ha(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:i,empty:r}=n;if(!r||i.parent.type!==this.type)return!1;const s=i.parentOffset===i.parent.nodeSize-2,o=i.parent.textContent.endsWith("\n\n");return!(!s||!o)&&e.chain().command((({tr:e})=>(e.delete(i.pos-2,i.pos),!0))).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:i}=t,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;if(!(r.parentOffset===r.parent.nodeSize-2))return!1;const o=r.after();if(void 0===o)return!1;return!i.nodeAt(o)&&e.commands.exitCode()}}},addInputRules(){return[yl({find:Bl,type:this.type,getAttributes:e=>({language:e[1]})}),yl({find:Pl,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new ii({key:new oi("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),i=t.clipboardData.getData("vscode-editor-data"),r=i?JSON.parse(i):void 0,s=null==r?void 0:r.mode;if(!n||!s)return!1;const{tr:o}=e.state;return o.replaceSelectionWith(this.type.create({language:s})),o.setSelection(jn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,"\n")),o.setMeta("paste",!0),e.dispatch(o),!0}}})]}}),Ll=bl.create({name:"doc",topNode:!0,content:"block+"});function Vl(e={}){return new ii({view:t=>new zl(t,e)})}class zl{constructor(e,t){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos);if(!t.parent.inlineContent){let n=t.nodeBefore,i=t.nodeAfter;if(n||i){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0)).getBoundingClientRect(),r=n?t.bottom:t.top;n&&i&&(r=(r+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:t.left,right:t.right,top:r-this.width/2,bottom:r+this.width/2}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let n,i,r=this.editorView.dom.offsetParent;if(this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),!r||r==document.body&&"static"==getComputedStyle(r).position)n=-pageXOffset,i=-pageYOffset;else{let e=r.getBoundingClientRect();n=e.left-r.scrollLeft,i=e.top-r.scrollTop}this.element.style.left=e.left-n+"px",this.element.style.top=e.top-i+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=n&&n.type.spec.disableDropCursor,r="function"==typeof i?i(this.editorView,t):i;if(t&&!r){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(e=xn(this.editorView.state.doc,e,this.editorView.dragging.slice),null==e))return this.setCursor(null);this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Fl=Ea.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[Vl(this.options)]}});class Hl extends Vn{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return Hl.valid(n)?new Hl(n):Vn.near(n)}content(){return tt.empty}eq(e){return e instanceof Hl&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new Hl(e.resolve(t.pos))}getBookmark(){return new jl(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),i=e.node(t);if(0!=n)for(let e=i.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(i.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),i=e.node(t);if(n!=i.childCount)for(let e=i.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(i.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&Hl.valid(e))return e;let i=e.pos,r=null;for(let n=e.depth;;n--){let s=e.node(n);if(t>0?e.indexAfter(n)<s.childCount:e.index(n)>0){r=s.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;i+=t;let o=e.doc.resolve(i);if(Hl.valid(o))return o}for(;;){let s=t>0?r.firstChild:r.lastChild;if(!s){if(r.isAtom&&!r.isText&&!qn.isSelectable(r)){e=e.doc.resolve(i+r.nodeSize*t),n=!1;continue e}break}r=s,i+=t;let o=e.doc.resolve(i);if(Hl.valid(o))return o}return null}}}Hl.prototype.visible=!1,Hl.findFrom=Hl.findGapCursorFrom,Vn.jsonID("gapcursor",Hl);class jl{constructor(e){this.pos=e}map(e){return new jl(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Hl.valid(t)?new Hl(t):Vn.near(t)}}const Wl=Do({ArrowLeft:ql("horiz",-1),ArrowRight:ql("horiz",1),ArrowUp:ql("vert",-1),ArrowDown:ql("vert",1)});function ql(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,i,r){let s=e.selection,o=t>0?s.$to:s.$from,a=s.empty;if(s instanceof jn){if(!r.endOfTextblock(n)||0==o.depth)return!1;a=!1,o=e.doc.resolve(t>0?o.after():o.before())}let l=Hl.findGapCursorFrom(o,t,a);return!!l&&(i&&i(e.tr.setSelection(new Hl(l))),!0)}}function Jl(e,t,n){if(!e||!e.editable)return!1;let i=e.state.doc.resolve(t);if(!Hl.valid(i))return!1;let r=e.posAtCoords({left:n.clientX,top:n.clientY});return!(r&&r.inside>-1&&qn.isSelectable(e.state.doc.nodeAt(r.inside)))&&(e.dispatch(e.state.tr.setSelection(new Hl(i))),!0)}function Kl(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof Hl))return!1;let{$from:n}=e.state.selection,i=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!i)return!1;let r=Ye.empty;for(let e=i.length-1;e>=0;e--)r=Ye.from(i[e].createAndFill(null,r));let s=e.state.tr.replace(n.pos,n.pos,new tt(r,0,0));return s.setSelection(jn.near(s.doc.resolve(n.pos+1))),e.dispatch(s),!1}function _l(e){if(!(e.selection instanceof Hl))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",Hs.create(e.doc,[Vs.widget(e.selection.head,t,{key:"gapcursor"})])}const Ul=Ea.create({name:"gapCursor",addProseMirrorPlugins:()=>[new ii({props:{decorations:_l,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&Hl.valid(n)?new Hl(n):null,handleClick:Jl,handleKeyDown:Wl,handleDOMEvents:{beforeinput:Kl}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!==(t=fa(aa(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))&&void 0!==t?t:null}}}),Yl=bl.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",ha(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:i})=>e.first([()=>e.exitCode(),()=>e.command((()=>{const{selection:e,storedMarks:r}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=i.extensionManager,a=r||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{if(t&&a&&s){const t=a.filter((e=>o.includes(e.type.name)));e.ensureMarks(t)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Gl=bl.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map((e=>({tag:`h${e}`,attrs:{level:e}})))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,ha(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce(((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})})),{})},addInputRules(){return this.options.levels.map((e=>yl({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}})))}});var Xl=200,Zl=function(){};Zl.prototype.append=function(e){return e.length?(e=Zl.from(e),!this.length&&e||e.length<Xl&&this.leafAppend(e)||this.length<Xl&&e.leafPrepend(this)||this.appendInner(e)):this},Zl.prototype.prepend=function(e){return e.length?Zl.from(e).append(this):this},Zl.prototype.appendInner=function(e){return new ec(this,e)},Zl.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?Zl.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},Zl.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},Zl.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},Zl.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var i=[];return this.forEach((function(t,n){return i.push(e(t,n))}),t,n),i},Zl.from=function(e){return e instanceof Zl?e:e&&e.length?new Ql(e):Zl.empty};var Ql=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,i){for(var r=t;r<n;r++)if(!1===e(this.values[r],i+r))return!1},t.prototype.forEachInvertedInner=function(e,t,n,i){for(var r=t-1;r>=n;r--)if(!1===e(this.values[r],i+r))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=Xl)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=Xl)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(Zl);Zl.empty=new Ql([]);var ec=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,i){var r=this.left.length;return!(t<r&&!1===this.left.forEachInner(e,t,Math.min(n,r),i))&&(!(n>r&&!1===this.right.forEachInner(e,Math.max(t-r,0),Math.min(this.length,n)-r,i+r))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,i){var r=this.left.length;return!(t>r&&!1===this.right.forEachInvertedInner(e,t-r,Math.max(n,r)-r,i+r))&&(!(n<r&&!1===this.left.forEachInvertedInner(e,Math.min(t,r),n,i))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(Zl),tc=Zl;class nc{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,i,r=this.items.length;for(;;r--){if(this.items.get(r-1).selection){--r;break}}t&&(n=this.remapping(r,this.items.length),i=n.maps.length);let s,o,a=e.tr,l=[],c=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(r,t+1),i=n.maps.length),i--,void c.push(e);if(n){c.push(new ic(e.map));let t,r=e.step.map(n.slice(i));r&&a.maybeStep(r).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new ic(t,void 0,void 0,l.length+c.length))),i--,t&&n.appendMap(t,i)}else a.maybeStep(e.step);return e.selection?(s=n?e.selection.map(n.slice(i)):e.selection,o=new nc(this.items.slice(0,r).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:o,transform:a,selection:s}}addTransform(e,t,n,i){let r=[],s=this.eventCount,o=this.items,a=!i&&o.length?o.get(o.length-1):null;for(let n=0;n<e.steps.length;n++){let l,c=e.steps[n].invert(e.docs[n]),d=new ic(e.mapping.maps[n],c,t);(l=a&&a.merge(d))&&(d=l,n?r.pop():o=o.slice(0,o.length-1)),r.push(d),t&&(s++,t=void 0),i||(a=d)}let l=s-n.depth;return l>sc&&(o=function(e,t){let n;return e.forEach(((e,i)=>{if(e.selection&&0==t--)return n=i,!1})),e.slice(n)}(o,l),s-=l),new nc(o.append(r),s)}remapping(e,t){let n=new nn;return this.items.forEach(((t,i)=>{let r=null!=t.mirrorOffset&&i-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,r)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new nc(this.items.append(e.map((e=>new ic(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-t),r=e.mapping,s=e.steps.length,o=this.eventCount;this.items.forEach((e=>{e.selection&&o--}),i);let a=t;this.items.forEach((t=>{let i=r.getMirror(--a);if(null==i)return;s=Math.min(s,i);let l=r.maps[i];if(t.step){let s=e.steps[i].invert(e.docs[i]),c=t.selection&&t.selection.map(r.slice(a+1,i));c&&o++,n.push(new ic(l,s,c))}else n.push(new ic(l))}),i);let l=[];for(let e=t;e<s;e++)l.push(new ic(r.maps[e]));let c=this.items.slice(0,i).append(l).append(n),d=new nc(c,o);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,i=[],r=0;return this.items.forEach(((s,o)=>{if(o>=e)i.push(s),s.selection&&r++;else if(s.step){let e=s.step.map(t.slice(n)),o=e&&e.getMap();if(n--,o&&t.appendMap(o,n),e){let a=s.selection&&s.selection.map(t.slice(n));a&&r++;let l,c=new ic(o.invert(),e,a),d=i.length-1;(l=i.length&&i[d].merge(c))?i[d]=l:i.push(c)}}else s.map&&n--}),this.items.length,0),new nc(tc.from(i.reverse()),r)}}nc.empty=new nc(tc.empty,0);class ic{constructor(e,t,n,i){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new ic(t.getMap().invert(),t,this.selection)}}}class rc{constructor(e,t,n,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=i}}const sc=20;function oc(e){let t=[];return e.forEach(((e,n,i,r)=>t.push(i,r))),t}function ac(e,t){if(!e)return null;let n=[];for(let i=0;i<e.length;i+=2){let r=t.map(e[i],1),s=t.map(e[i+1],-1);r<=s&&n.push(r,s)}return n}function lc(e,t,n,i){let r=hc(t),s=pc.get(t).spec.config,o=(i?e.undone:e.done).popEvent(t,r);if(!o)return;let a=o.selection.resolve(o.transform.doc),l=(i?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),s,r),c=new rc(i?l:o.remaining,i?o.remaining:l,null,0);n(o.transform.setSelection(a).setMeta(pc,{redo:i,historyState:c}).scrollIntoView())}let cc=!1,dc=null;function hc(e){let t=e.plugins;if(dc!=t){cc=!1,dc=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){cc=!0;break}}return cc}const pc=new oi("history"),uc=new oi("closeHistory");function fc(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new ii({key:pc,state:{init:()=>new rc(nc.empty,nc.empty,null,0),apply:(t,n,i)=>function(e,t,n,i){let r,s=n.getMeta(pc);if(s)return s.historyState;n.getMeta(uc)&&(e=new rc(e.done,e.undone,null,0));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(o&&o.getMeta(pc))return o.getMeta(pc).redo?new rc(e.done.addTransform(n,void 0,i,hc(t)),e.undone,oc(n.mapping.maps[n.steps.length-1]),e.prevTime):new rc(e.done,e.undone.addTransform(n,void 0,i,hc(t)),null,e.prevTime);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(r=n.getMeta("rebased"))?new rc(e.done.rebased(n,r),e.undone.rebased(n,r),ac(e.prevRanges,n.mapping),e.prevTime):new rc(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),ac(e.prevRanges,n.mapping),e.prevTime);{let r=0==e.prevTime||!o&&(e.prevTime<(n.time||0)-i.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,i)=>{for(let r=0;r<t.length;r+=2)e<=t[r+1]&&i>=t[r]&&(n=!0)})),n}(n,e.prevRanges)),s=o?ac(e.prevRanges,n.mapping):oc(n.mapping.maps[n.steps.length-1]);return new rc(e.done.addTransform(n,r?t.selection.getBookmark():void 0,i,hc(t)),nc.empty,s,n.time)}}(n,i,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,i="historyUndo"==n?mc:"historyRedo"==n?gc:null;return!!i&&(t.preventDefault(),i(e.state,e.dispatch))}}}})}const mc=(e,t)=>{let n=pc.getState(e);return!(!n||0==n.done.eventCount)&&(t&&lc(n,e,t,!1),!0)},gc=(e,t)=>{let n=pc.getState(e);return!(!n||0==n.undone.eventCount)&&(t&&lc(n,e,t,!0),!0)};const yc=Ea.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>mc(e,t),redo:()=>({state:e,dispatch:t})=>gc(e,t)}),addProseMirrorPlugins(){return[fc(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),wc=bl.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",ha(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e})=>e().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{var n;if(t){const{$to:t}=e.selection,i=t.end();if(t.nodeAfter)e.setSelection(jn.create(e.doc,t.pos));else{const r=null===(n=t.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();r&&(e.insert(i,r),e.setSelection(jn.create(e.doc,i)))}e.scrollIntoView()}return!0})).run()}},addInputRules(){return[(e={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type},new ka({find:e.find,handler:({state:t,range:n,match:i})=>{const r=fa(e.getAttributes,void 0,i)||{},{tr:s}=t,o=n.from;let a=n.to;if(i[1]){let t=o+i[0].lastIndexOf(i[1]);t>a?t=a:a=t+i[1].length;const n=i[0][i[0].length-1];s.insertText(n,o+i[0].length-1),s.replaceWith(t,a,e.type.create(r))}else i[0]&&s.replaceWith(o,a,e.type.create(r))}}))];var e}}),vc=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,bc=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,kc=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,xc=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,Sc=vl.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=italic"}],renderHTML({HTMLAttributes:e}){return["em",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[gl({find:vc,type:this.type}),gl({find:kc,type:this.type})]},addPasteRules(){return[kl({find:bc,type:this.type}),kl({find:xc,type:this.type})]}}),Mc=bl.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",ha(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Oc=/^(\d+)\.\s$/,Cc=bl.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",ha(this.options.HTMLAttributes,n),0]:["ol",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[wl({find:Oc,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]})]}}),Dc=bl.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Tc=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,Nc=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,Ec=vl.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",ha(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[gl({find:Tc,type:this.type})]},addPasteRules(){return[kl({find:Nc,type:this.type})]}}),Ac=bl.create({name:"text",group:"inline"}),Ic=Ea.create({name:"starterKit",addExtensions(){var e,t,n,i,r,s,o,a,l,c,d,h,p,u,f,m,g,y;const w=[];return!1!==this.options.blockquote&&w.push(Sl.configure(null===(e=this.options)||void 0===e?void 0:e.blockquote)),!1!==this.options.bold&&w.push(Tl.configure(null===(t=this.options)||void 0===t?void 0:t.bold)),!1!==this.options.bulletList&&w.push(El.configure(null===(n=this.options)||void 0===n?void 0:n.bulletList)),!1!==this.options.code&&w.push(Rl.configure(null===(i=this.options)||void 0===i?void 0:i.code)),!1!==this.options.codeBlock&&w.push($l.configure(null===(r=this.options)||void 0===r?void 0:r.codeBlock)),!1!==this.options.document&&w.push(Ll.configure(null===(s=this.options)||void 0===s?void 0:s.document)),!1!==this.options.dropcursor&&w.push(Fl.configure(null===(o=this.options)||void 0===o?void 0:o.dropcursor)),!1!==this.options.gapcursor&&w.push(Ul.configure(null===(a=this.options)||void 0===a?void 0:a.gapcursor)),!1!==this.options.hardBreak&&w.push(Yl.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&w.push(Gl.configure(null===(c=this.options)||void 0===c?void 0:c.heading)),!1!==this.options.history&&w.push(yc.configure(null===(d=this.options)||void 0===d?void 0:d.history)),!1!==this.options.horizontalRule&&w.push(wc.configure(null===(h=this.options)||void 0===h?void 0:h.horizontalRule)),!1!==this.options.italic&&w.push(Sc.configure(null===(p=this.options)||void 0===p?void 0:p.italic)),!1!==this.options.listItem&&w.push(Mc.configure(null===(u=this.options)||void 0===u?void 0:u.listItem)),!1!==this.options.orderedList&&w.push(Cc.configure(null===(f=this.options)||void 0===f?void 0:f.orderedList)),!1!==this.options.paragraph&&w.push(Dc.configure(null===(m=this.options)||void 0===m?void 0:m.paragraph)),!1!==this.options.strike&&w.push(Ec.configure(null===(g=this.options)||void 0===g?void 0:g.strike)),!1!==this.options.text&&w.push(Ac.configure(null===(y=this.options)||void 0===y?void 0:y.text)),w}}),Rc={start:function(e,t){return content=e.innerHTML,e.innerHTML="",new ml({element:e,extensions:[Ic],editable:!t,editorProps:{attributes:{class:"prose prose-sm max-w-full focus:outline-none text-base-content"}},content:content,onBlur({editor:t,event:n}){const i=t.getHTML();e.value=i,e.dispatchEvent(new Event("change",{detail:i}))}})},get:function(e){return e.parentElement.nextElementSibling._editor}};window.Datepicker=We,window.juiLov=qe,window.TipTap=Rc})();
//# sourceMappingURL=jembeui.js.map
