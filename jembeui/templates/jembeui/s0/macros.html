{# I C O N S #}
{% macro display_icon(icon_name=none, icon_html=none, default_icon_name="checkmark-circle-outline", class=none) %}
    {%- if icon_html %}
        {{icon_html}}
    {%- elif icon_name %}
        {%- include "jembeui/s0/icons/{}.svg".format(icon_name) with context %}
    {%- elif default_icon_name %}
        {%- include "jembeui/s0/icons/{}.svg".format(default_icon_name) with context %}
    {%- endif %}
{% endmacro %}



{# L I N K S #}

{# Display link as HREF #}
{% macro display_link(title=none, url=none, jrl=none, icon_name=none, icon_html=none, styling=(), attrs=none) %}
    {% set has_icon = icon_name  or icon_html %}
    {% set attrs = attrs if attrs else {} %}
    <a  href="{{url if url else '#'}}"{% if jrl %} jmb-on:click.prevent="{{jrl}}"{% endif %} 
        class="href"
        {%- if attrs %}
            {%- for k,v in attrs.items() %}
                {{k}}="{{v}}"
            {%- endfor %}
        {%- endif %}>
        {%- if has_icon %}
            {%- set icon_is_last = "icon-last" in styling %}
            {%- set icon_class = "inline-block  align-bottom w-6 h-6 p-1 mx-1 hover:bg-grey-200"  %}
            {%- if has_icon and not icon_is_last %}
                {{display_icon(icon_name, icon_html, class=icon_class)}} 
            {%- endif -%}
                {{title|default('',true)}}
            {%- if has_icon and icon_is_last %}
                {{display_icon(icon_name, icon_html, class=icon_class)}} 
            {%- endif -%}
        {%- else %}
            {{title|default('',true)}}
        {%- endif -%}
    </a>
{% endmacro %}


{% macro display_link_as_href(link, styling=(), attrs=none) %}
    {% if link.is_accessible %}
        {% if "as_button" in link.styling %}
            {{display_link_as_button(link)}}
        {% endif %}
        {% set styling = styling if styling else link.styling %}
        {{display_link(
            title=link.title,
            url=link.url,
            jrl=link.jrl,
            icon_name=link.icon_name,
            icon_html=link.icon_html,
            styling=styling,
            attrs=attrs
        )}}
    {% endif %}
{% endmacro %}

{# DISPLAY BUTTON #}
{% macro display_button(title=none, jrl=none, icon_name=none, icon_html=none, default_icon_name=none, styling=(), attrs=none) %}
    {% set has_icon = icon_name  or icon_html %}
    {% set is_ghost = (has_icon or default_icon_name) and (not title or "ghost" in styling or "ghost-micro" in "styling") %}
    {% set attrs = attrs if attrs else {} %}
    <button type="button" class="
        {%- if is_ghost %}
            {%- if 'ghost-micro' in styling%}
                btn-ghost-micro
            {%- else %}
                btn-ghost
            {%- endif %}
        {%- elif 'micro' in styling %}
            btn-micro
        {%- elif 'short' in styling %}
            btn-short
        {%- else %}
            btn
        {%- endif %}
        {%- if not is_ghost and has_icon %}
        flex items-center
        {%- endif %}
        {%- if 'primary' in styling %}
            btn--primary
        {%- elif 'secondary' in styling %}
            btn--secondary
        {%- elif 'brand' in styling %}
            btn--brand
        {%- elif 'danger' in styling %}
            btn--danger
        {%- endif %} 
        {%- if 'on' in styling %}
            btn--on
        {%- endif %}"
        {%- if jrl %}
        jmb-on:click.prevent="{{jrl}}"
        {%- endif %}
        {%- if is_ghost and title %}
        title="{{title}}"
        {%- endif %}
        {%- if attrs %}
            {%- for k,v in attrs.items() %}
                {%- if v is boolean %} 
                    {%- if v==true %}
                        {{k}} 
                    {%- endif %}
                {%- else %}
                {{k}}="{{v}}"
                {%- endif %}
            {%- endfor %}
        {%- endif %}>
        {%- if is_ghost %}
            {{display_icon(icon_name, icon_html, class="p-1")}} 
        {%- elif has_icon %}
            {%- set icon_is_last = "icon-last" in styling %}
            {%- set icon_class = "w-8 h-8 p-1" if "micro" not in styling else "w-5 h-5 p-1" %}
            {%- if has_icon and not icon_is_last %}
                {{display_icon(icon_name, icon_html, class=icon_class)}} 
            {%- endif -%}
            <div class="grow">
                {{title|default('',true)}}
            </div>
            {%- if has_icon and icon_is_last %}
                {{display_icon(icon_name, icon_html, class=icon_class)}} 
            {%- endif -%}
        {%- else %}
            {{title|default('',true)}}
        {%- endif -%}
    </button>
{% endmacro %}

{# DISPLAY LINK AS BUTTON #}
{% macro display_link_as_button(link, styling=(), attrs=none) %}
    {% if link.is_accessible %}
        {% if "as_href" in link.styling %}
            {{display_link_as_href(link)}}
        {% endif %}
        {% set styling = styling if styling else link.styling %}
        {{display_button(
            title=link.title,
            jrl=link.jrl,
            icon_name=link.icon_name,
            icon_html=link.icon_html,
            styling=styling,
            attrs=attrs
        )}}
    {% endif %}
{% endmacro %}


{# M E N U S #}

{# DISPLAY MENU DROP DOWN #}
{% macro display_menu_dropdown(menu, from_link=false, open_styling=()) %}
    {% if menu.is_accessible %}
        <div class="relative {% if from_link %}inline{% else%}h-8{% endif %}" 
            jmb-on:click.away="if ($scope().opened === '{{menu.id}}'){$scope().opened=null}">
            {% if from_link %}
            {{display_link(
                title=menu.title, 
                icon_name=menu.icon_name if menu.icon_name or menu.icon_html else ("ellipsis-vertical-outline" if not menu.title else none), 
                icon_html=menu.icon_html, 
                styling=open_styling +  ("icon-last",),
                attrs={
                    'jmb-on:click.prevent': 
                        "if ($scope().opened === '{0}'){{$scope().opened = null}}else{{$scope().opened = '{0}'}}".format(menu.id)
                }
            )}}
            {% else %}
            {{display_button(
                title=menu.title, 
                icon_name=menu.icon_name if menu.icon_name or menu.icon_html else "chevron-down-outline", 
                icon_html=menu.icon_html, 
                styling=open_styling + ("icon-last",),
                attrs={
                    'jmb-on:click.prevent': 
                        "if ($scope().opened === '{0}'){{$scope().opened = null}}else{{$scope().opened = '{0}'}}".format(menu.id)
                }
            )}}
            {% endif %}
            <div jmb-cloak 
                jmb-show="$scope().opened === '{{menu.id}}'"
                jmb-on:click.prevent="if($event.target.tagName ==='A'){$scope().opened=null}"
                class="absolute right-0 z-50 -mt-2">
                {# arrow on top of dropdown #}
                <div class="flex justify-end mr-1">
                    <div class="w-6 overflow-hidden">
                        <div class="w-4 h-4 origin-bottom-left transform rotate-45 bg-white border border-grey-200"></div>
                    </div>
                </div>
                {# dropdown #}
                <div class="px-4 py-4 -mt-[1px] bg-white border rounded-sm shadow border-grey-200 whitespace-nowrap flex flex-col gap-2 min-w-[8rem]">
                    {{caller()}}
                </div>
            </div>
        </div>
    {% endif %}
{% endmacro %}

{# DISPLAY SYSTEM MENU #}
{% macro display_system_menu(menu) %}
    <div jmb-scope="{opened:null, active:null, timeout:null}"
            jmb-on:jembe-update-page.camel.window="$scope().active = null;$updateDom();"
            class="flex flex-col gap-2 pt-4 pb-2 pl-4 pr-2 bg-white border-b border-grey-300 sm:bg-transparent sm:border-none sm:flex-row sm:items-center sm:justify-end sm:h-full sm:gap-2 sm:py-0 sm:pr-2 sm:px-0">
        {% set ns = namespace(topMenuId = none) %}
        {% for mi in menu.items recursive %}
            {% if mi.is_accessible %}
                {% if mi.is_menu %}
                    {% if loop.depth == 1 %}
                        <div jmb-on:mouseleave="if ($scope().opened === '{{mi.id}}') {$scope().timeout=setTimeout(function(){$scope().opened=null}, 50)}" 
                             jmb-on:click.away="if ($scope().opened === '{{mi.id}}') {$scope().opened=null}"
                             jmb-on:mouseover="clearTimeout($scope().timeout); $scope().opened = '{{mi.id}}'"
                             class="relative my-4 sm:m-0">
                            <button type="button"
                                jmb-on:focus="$scope().opened='{{mi.id}}'"
                                jmb-bind:class="{'sm:!font-semibold': $scope().active === '{{mi.id}}'}"
                                class="block mb-2 text-sm font-light tracking-wider uppercase focus-visible:outline-none sm:mb-0 text-grey-600 sm:tracking-normal sm:font-normal sm:text-base sm:normal-case sm:hover:underline sm:focus-visible:underline">
                                {{mi.title}}
                            </button>
                            <div jmb-cloak 
                                class="sm:absolute sm:right-0 sm:z-50 sm:-mt-2"
                                jmb-bind:class="{'sm:block': $scope().opened === '{{mi.id}}', 'sm:hidden': $scope().opened !== '{{mi.id}}'}">
                                {# arrow on top of dropdown #}
                                <div class="hidden sm:flex sm:justify-end sm:mr-4">
                                    <div class="w-6 overflow-hidden">
                                        <div class="w-4 h-4 origin-bottom-left transform rotate-45 bg-white border border-grey-200"></div>
                                    </div>
                                </div>
                                {# dropdown #}
                                <div class="pl-4 sm:px-4 sm:py-4 sm:-mt-[1px] sm:bg-white sm:border sm:rounded-sm sm:shadow-md sm:border-grey-200 sm:whitespace-nowrap flex flex-col gap-2 sm:min-w-[8rem]">
                                    {% set ns.topMenuId = mi.id %}
                                    {{loop(mi.items)}}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="pt-2 text-grey-500">
                            {{mi.title}}
                        </div>
                        <div class="pl-2">
                            {{loop(mi.items)}}
                        </div>
                    {% endif %}
                {% else %}
                   {% if loop.depth == 1 %}
                        {% set ns.topMenuId = mi.id %}
                   {% endif %} 
                        {# class="top-menu__link {% if loop.depth > 1 %}top-menu__link--indropdown{% endif %}"> #}
                    <a href="{{mi.url}}" 
                        {% if mi.jrl %}jmb-on:click.prevent="{{mi.jrl}}"{% endif %} 
                        jmb-bind:class="{
                        'font-semibold': 
                            (   
                                {{mi.active_for_exec_names|tojson|forceescape}}.some(function(en){return $jmb.componentsOnPage().includes(en)})
                                || {{mi.active_for_pathnames|tojson|forceescape}}.some(function(pn){return window.location.pathname === pn})
                            ) 
                            {# Add ns.topMenuid to active #}
                            {% if ns.topMenuId is not none -%}
                            && ($scope().active = '{{ns.topMenuId}}')
                            {%- endif %}
                        }"
                        class="block text-grey-600 hover:underline focus-visible:outline-none focus-visible:underline">
                        {{mi.title}} 
                    </a>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div> 
{% endmacro %}

{# DISPLAY MAIN MENU #}
{% macro display_main_menu(menu) %}
    <div jmb-scope="{active:null}"
            jmb-on:jembe-update-page.camel.window="$scope().active = null; $updateDom();"
            class="flex flex-col h-full gap-2 pt-4 pb-2 pl-4 pr-2">
        {% for mi in menu.items recursive %}
            {% if mi.is_accessible %}
                {% if mi.is_menu %}
                    {% if loop.depth == 1 %}
                        <div class="my-4">
                            <button type="button"
                                class="block mb-2 text-sm font-light tracking-wider uppercase focus-visible:outline-none text-grey-600 ">
                                {{mi.title}}
                            </button>
                            <div class="flex flex-col gap-2 pl-4 ">
                                {{loop(mi.items)}}
                            </div>
                        </div>
                    {% else %}
                        <div class="pt-2 text-grey-400">
                            {{mi.title}}
                        </div>
                        <div class="pl-2">
                            {{loop(mi.items)}}
                        </div>
                    {% endif %}
                {% else %}
                    <a href="{{mi.url}}" {% if mi.jrl %}jmb-on:click.prevent="{{mi.jrl}}"{% endif %} 
                        jmb-bind:class="{
                        'font-semibold': 
                            (   
                                {{mi.active_for_exec_names|tojson|forceescape}}.some(function(en){return $jmb.componentsOnPage().includes(en)})
                                || {{mi.active_for_pathnames|tojson|forceescape}}.some(function(pn){return window.location.pathname === pn})
                            ) 
                        }"
                        class="block text-grey-600 hover:underline focus-visible:outline-none focus-visible:underline">
                        {{mi.title}} 
                    </a>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div> 
{% endmacro %}


{# DISPLAY MENU AS BUTTONS #}
{% macro display_menu_as_buttons(menu, aligh_right=false, buttons_styling=())%}
    {% if menu.is_accessible %}
        <div jmb-scope="{opened:null}" class="flex items-center gap-1">
            {% for mi in menu.items recursive %}
                {% if mi.is_accessible %}
                    {% if mi.is_menu %}
                        {% if loop.depth == 1 %}
                            {% call display_menu_dropdown(mi, open_styling=mi.styling + buttons_styling)%}
                                {{loop(mi.items)}}
                            {% endcall %}
                        {% else %}
                            <div class="pt-2 text-right text-grey-400">
                                {{mi.title}}
                            </div>
                            <div class="pl-2">
                                {{loop(mi.items)}}
                            </div>
                        {% endif %}
                    {% else %}
                        {% if loop.depth == 1 %}
                            {{display_link_as_button(mi, mi.styling + buttons_styling)}}
                        {% else %}
                            {{display_link_as_href(mi)}}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div> 
    {% endif %}
{% endmacro %}

{# DISPLAY MENU AS LINKS #}
{% macro display_menu_as_links(menu)%}
    {# size can be micro, short, base, large #}
    {% if menu.is_accessible %}
        <div jmb-scope="{opened:null}" class="flex items-center gap-1">
            {% for mi in menu.items recursive %}
                {% if mi.is_accessible %}
                    {% if mi.is_menu %}
                        {% if loop.depth == 1 %}
                            {% call display_menu_dropdown(mi, from_link=true)%}
                                {{loop(mi.items)}}
                            {% endcall %}
                        {% else %}
                            <div class="pt-2 text-right text-grey-400">
                                {{mi.title}}
                            </div>
                            <div class="pl-2">
                                {{loop(mi.items)}}
                            </div>
                        {% endif %}
                    {% else %}
                        {{display_link_as_href(mi)}}
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div> 
    {% endif %}
{% endmacro %}





{# M O D A L S #}


{#  DISPLAY MODAL #}
{% macro display_modal(component, title=none, menu=none, closable=true, size="base", close_button_title=none)%}
    {# size in small, base, wide, fullscreen #}
    {% set display_header = title is not none or closable %}
    {% set display_footer = menu is not none or (closable and close_button_title is not none)%}

    <div class="fixed inset-0 z-50 bg-opacity-80 bg-grey-900">
        <div class="min-w-[280px] m-auto mt-[5vh]
        {%- if size == 'small' %}
            max-w-[80%] w-[420px]
        {%- elif size == 'base' %}
            max-w-[80%] w-[650px]
        {%- elif size == 'wide' %}
            max-w-[80%] w-4/5
        {%- elif size == 'fullscreen' %}
        {%- endif %}">
            {# header #}
            {% if display_header %}
            <div class="flex items-center justify-between py-1 pl-4 pr-2 text-lg leading-6 rounded-t-sm bg-grey-200">
                <div>{{title|default('', true)}}</div>
                {% if closable %}
                <button jmb-on:click="{%- if component('cancel()').is_accessible %}cancel(){% else %}$jmb.emit('cancel'){% endif -%}" type="button" title="Close" class="btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><title>Close</title><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M368 368L144 144M368 144L144 368"/></svg>
                </button>
                {% endif %}
            </div>
            {% endif %}
            {# content #}
            <div class="p-4 bg-grey-50 {% if not display_header %}rounded-t-sm{% endif %} {% if not display_footer %}rounded-b-sm{% endif %}">
                {{caller()}}
            </div>
            {# footer #}
            {% if display_footer %}
            <div class="p-4 rounded-b-sm bg-grey-50">
                {% if menu is not none  %}
                    {% if menu is string() %}
                    {{menu}}
                    {% else %}
                    {{display_menu_as_buttons(menu, aligh_right=true)}}
                    {% endif %}
                {% elif menu is none and closable and close_button_title %}
                    <div class="flex justify-end">
                        <button jmb-on:click="{%- if component('cancel()').is_accessible %}cancel(){% else %}$jmb.emit('cancel'){% endif -%}" jmb-on:ready="$self.focus()" type="button" class="btn btn-primary">{{close_button_title}}</button>
                    </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
{% endmacro %}




{# L I S T #}


{# LIST CLEAR FILTERS BUTTON #}
{% macro display_list_clear_filters_button(search_filter, choice_filters) %}
    {% if search_filter is not none or choice_filters %}
    <button jmb-on:click.prevent="{% if search_filter %}search='';{% endif %}{% if choice_filters %}choice_filters={};{% endif %}order_by=null;" class="btn-ghost-micro" type="button">
        {{display_icon('trash-outline')}}
    </button>
    {% endif %}
{% endmacro %}

{# LIST SEARCH INPUT #}
{% macro display_list_search_input(search, search_filter) %}
    {% if search_filter is not none %}
        <input jmb-on:input="page=0;search=$self.value;" value="{{search}}" type="search" placeholder="Search..." class="form-input toolbar-input" >
    {% endif %}
{% endmacro %}


{# LIST CHOICE FILTERS #}
{% macro display_list_choice_filters(choice_filters, filters_config, apply_filter, remove_filter) %}
{%- if filters_config %}
    {%- for filter_name, choice_filter in filters_config.items() if not choice_filter.is_grouped  %}
    {%- for choice in choice_filter.choices  %}
    <label class="btn-micro flex justify-center items-center
        {%- if choice_filters and filter_name in choice_filters and choice.value_str in choice_filters[filter_name] %}
        btn--on
        {%- endif %}" title="{{choice.title}}">
        <input type="checkbox" jmb-on:change="
            if($self.checked) {
                jui_apply_choice_filter('{{filter_name}}','{{choice.value_str}}');
            }else{
                jui_remove_choice_filter('{{filter_name}}','{{choice.value_str}}')
            }"  
            value="{{choice.value_str}}"
            {% if choice_filters and filter_name in choice_filters and choice.value_str in choice_filters[filter_name] %}
            checked
            {% endif %}
            class="hidden">
        {{choice.title|truncate(15, true)}}
    </label> 
    {% endfor %} 
    {% endfor %}
    {% if filters_config.values()|selectattr('is_grouped')|list|length > 0 %}
    <div jmb-scope="{opened:false}" jmb-on:click.away="$scope().opened = false;" class="relative">
        {% set ns = namespace(other_selected = false) %}
        <div jmb-show="$scope().opened" jmb-cloak
             class="absolute top-7 min-w-[70px] right-0 shadow rounded-sm overflow-hidden bg-grey-50">
        {% for filter_name, choice_filter in filters_config.items() if choice_filter.is_grouped  %}
        {% for choice in choice_filter.choices  %}
        <label class="btn-micro flex justify-start items-center rounded-none
            {% if choice_filters and filter_name in choice_filters and choice.value_str in choice_filters[filter_name] %}
            btn--on
            {% set ns.other_selected = true %}
            {% endif %}">
            <input type="checkbox" jmb-on:change="
                if($self.checked) {
                    jui_apply_choice_filter('{{filter_name}}','{{choice.value_str}}');
                }else{
                    jui_remove_choice_filter('{{filter_name}}','{{choice.value_str}}')
                };"
                value="{{choice.value_str}}"
                {% if choice_filters and filter_name in choice_filters and choice.value_str in choice_filters[filter_name] %}
                checked
                {% endif %}
                class="hidden">
            {{choice.title}}
        </label> 
        {% endfor %} 
        {% endfor %}
        </div>
        {{display_button(
            "Filters", 
            "$scope().opened = !$scope().opened", 
            icon_name="funnel-outline" if not ns.other_selected else "funnel", 
            styling=("micro","icon-last") if not ns.other_selected else ("micro", "icon-last", "on"), 
            attrs={"title": "Other filters"})
        }}
    </div>
    {% endif %}
{% endif %}
{% endmacro %}


{# LIST ORDER BY IN TOOLBAR #}
{% macro display_list_order_by(order_by, order_by_config) %}
    {% if order_by_config %}
    <div class="relative" jmb-scope="{opened:false}" jmb-on:click.away="$scope().opened = false;">
        {% set ns = namespace(ordered = false) %}
        <div jmb-show="$scope().opened" jmb-cloak
             class="absolute top-7 min-w-[70px] right-0 shadow rounded-sm overflow-hidden bg-grey-50">
        {% for order_name, order_title in order_by_config.items()  %}
        <label class="btn-micro flex justify-between items-center rounded-none whitespace-nowrap
            {% if order_by == order_name  or order_by == '-' + order_name %}
            btn--on
            {% set ns.ordered = true %}
            {% endif %}">
            <input type="checkbox" jmb-on:change="order_by= '{% if not order_by %}{{order_name}}{%elif order_by == order_name %}-{{order_name}}{% else %}{% endif %}'"
                value="{{order_name}}"
                {% if order_by == order_name or order_by == '-' + order_name %} checked {% endif %}
                class="hidden">
                {{order_title}} 
                {%- if order_by == '-' + order_name %}
                {{display_icon('arrow-down-outline', class="w-5 h-5 p-1")}}
                {%- elif order_by == order_name %}
                {{display_icon('arrow-up-outline', class="w-5 h-5 p-1")}}
                {%- else %}
                <div class="w-5 h-5"></div>
                {%- endif %}
        </label> 
        {% endfor %}
        </div>
        {{display_button(
            "Sort", 
            "$scope().opened = !$scope().opened", 
            icon_name="filter-outline" if not ns.ordered else "filter", 
            styling=("micro","icon-last") if not ns.ordered else ("micro", "icon-last", "on"), 
            attrs={"title": "Sort results"})
        }}
    </div>
    {% endif %}
{% endmacro %}



{# LIST PAGINATION #}
{% macro display_list_pagination(page, total_pages, total_records) %}
    <nav class="flex items-center gap-1 flex-nowrap">
        {{display_button(
            jrl="page=page-1",
            styling=("ghost-micro"),
            icon_name="chevron-back-outline",
            attrs={"disabled": page==0}
        )}}
        <div class="text-xs font-light ">
            {{page + 1 if total_pages > 0 else 0}} / {{total_pages}} (rows: {{total_records}})
        </div>
        {{display_button(
            jrl="page=page+1",
            styling=("ghost-micro"),
            icon_name="chevron-forward-outline",
            attrs={"disabled": page==total_pages -1 or total_pages==0}
        )}}
    </nav>
{% endmacro %}


{# TABLE #}
{% macro display_table(records, fields_config, field_values,order_by, order_by_config, record_menu_config=none, get_record_menu=none) %}
    {% if not fields_config and not records %}
    <div class="text-sm text-center text-grey-500">No data found</div>  
    {% else %}
    <table class="w-full border border-t-0 border-grey-400/50">
        <thead class="bg-grey-300/90">
            <tr>
                {% for field_name, field_title in fields_config.items() %}
                {% if field_name in order_by_config %}
                    {% if order_by == field_name %}
                    <th class="font-normal text-primary-900 bg-primary-200/80">
                        <a href="" class="flex items-center justify-between px-2 py-1" jmb-on:click.prevent="order_by='-{{field_name}}'; page=0">
                            {{field_title|capitalize}}
                            {{display_icon('arrow-up-outline', class="w-5 h-5")}}
                        </a>
                    </th>
                    {% elif order_by == "-" + field_name %}
                    <th class="font-normal text-primary-900 bg-primary-200/80">
                        <a href="" class="flex items-center justify-between px-2 py-1" jmb-on:click.prevent="order_by=null; page=0">
                            {{field_title|capitalize}}
                            {{display_icon('arrow-down-outline', class="w-5 h-5")}}
                        </a>
                    </th>
                    {% else %}
                    <th class="font-normal ">
                        <a href="" class="flex items-center justify-between px-2 py-1" jmb-on:click.prevent="order_by='{{field_name}}'; page=0">
                            {{field_title|capitalize}}
                        </a>
                    </th>
                    {% endif %}
                {% else %}
                <th>
                    {{field_title|capitalize}}
                </th>
                {% endif %}
                {% endfor %}
                {% if record_menu_config %}
                <th><span class="flex items-center justify-between px-2 py-1">Actions</span></th>
                {% endif %}
            </tr>
        </thead>
        <tbody class="bg-white">
    {% for record in records  %}
        <tr class="{{loop.cycle('bg-grey-100/80','bg-white')}} hover:bg-primary-100/60">
            {% for field_name in fields_config.keys() %}
            <td class="px-2 py-2">
                {{field_values[field_name](record, field_name)|default("", True)}}
            </td>
            {% endfor %}
            {% if record_menu_config %}
            <td class="px-2 py-2">
                {{display_menu_as_links(get_record_menu(record))}}
            </td> 
            {% endif %}
        </tr>
    {% endfor %}
        </tbody>
    </table>
    {% endif %}
{% endmacro %}